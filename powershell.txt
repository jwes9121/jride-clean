PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "Driver","driver","Requests","incoming","booking","ride request","Accept","Reject","Dispatch" |
>>   Select-Object Path, LineNumber, Line |
>>   Sort-Object Path, LineNumber

Path                                                                                                   LineNumber Line
----                                                                                                   ---------- ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\(authed)\components\TopNav.tsx                                    19         <span className="font-semibold text-lg">J-Ride Dispatch</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\(authed)\components\TopNav.tsx                                    23             href="/dispatch"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\(authed)\components\TopNav.tsx                                    26             Dispatch
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                         1 // app/actions/dispatchActions.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                         4 // It fetches the latest active booking + driver locations from Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                         5 // and returns an object that page.tsx + DriverListPanel expect.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        14     "[dispatchActions] Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        24 type DriverRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        25   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        33 type DriverTownGroup = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        35   drivers: DriverRow[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        38 type DriverStats = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        43   towns: DriverTownGroup[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        47   booking: any | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        48   driverStats: DriverStats;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        52  * Fetch the most recent active booking (assigned / on_trip) together
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        53  * with aggregated driver stats & per-town lists.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        55  * This shape matches what /admin/livetripss/page.tsx + DriverListPanel
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        56  * are expecting: { booking, driverStats }.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        58 export async function getActiveBookingWithDriverLocations(): Promise<LiveTripResult> {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        59   // ---- 1) Active booking (from dispatch_rides_view) ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        60   let booking: any | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        63     const bookingRes = await fetch(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        64       `${SUPABASE_URL}/rest/v1/dispatch_rides_view` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        72     if (bookingRes.ok) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        73       const bookingRows = (await bookingRes.json()) as any[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        74       booking = bookingRows[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        77         "[dispatchActions] Failed to load dispatch_rides_view:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        78         bookingRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        79         await safeText(bookingRes)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        83     console.error("[dispatchActions] Error fetching active booking:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        86   // ---- 2) Driver locations & stats ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        87   let driverRows: DriverRow[] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        90     const driverRes = await fetch(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        91       `${SUPABASE_URL}/rest/v1/driver_locations` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        92         `?select=driver_id,lat,lng,status,town,updated_at`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                        99     if (driverRes.ok) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       100       driverRows = (await driverRes.json()) as DriverRow[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       103         "[dispatchActions] Failed to load driver_locations:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       104         driverRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       105         await safeText(driverRes)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       109     console.error("[dispatchActions] Error fetching driver_locations:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       112   const driverStats = buildDriverStats(driverRows);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       115     booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       116     driverStats,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       120 /** Build totals + per-town groups from raw driver_locations rows */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       121 function buildDriverStats(rows: DriverRow[]): DriverStats {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       127   const grouped: Record<string, DriverRow[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       135   const towns: DriverTownGroup[] = Object.entries(grouped).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       136     ([town, drivers]) => ({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts                                       138       drivers: drivers.sort(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                             6   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                             7   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                             9   has_driver?: boolean;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            25   const [bookingId, setBookingId] = React.useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            26   const [bookingCode, setBookingCode] = React.useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            36   const canUseId = bookingId.trim().length > 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            37   const canUseCode = bookingCode.trim().length > 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            43   }, [bookingId, bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            51         ? `booking_id=${encodeURIComponent(bookingId.trim())}`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            52         : `booking_code=${encodeURIComponent(bookingCode.trim())}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            54       const r = await fetch(`/api/dispatch/status?${qs}`, { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            73     if (!inspect?.booking_id && !inspect?.booking_code) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            78       if (inspect.booking_id) body.booking_id = inspect.booking_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            79       if (inspect.booking_code) body.booking_code = inspect.booking_code;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            81       const r = await fetch("/api/dispatch/status", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                            99   const ready = !!inspect?.has_driver && allowed.length > 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           116             ? "Driver assigned and lifecycle can proceed."
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           117             : "No driver assigned or blocked state. Most lifecycle steps will fail until a ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           127             placeholder="booking id (uuid)"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           128             value={bookingId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           129             onChange={(e) => setBookingId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           133             placeholder="booking code"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           134             value={bookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           135             onChange={(e) => setBookingCode(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           149             <div>has_driver: <span className="font-mono">{String(!!inspect?.has_driver)}</s...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx                                           182               Guardrail: not ready (driver missing or blocked). Assign driver first.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                              11   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                              35   // Accept ISO-ish values, keep permissive
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                              61   return String(t.uuid || t.id || t.booking_code || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                              79     j.bookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             115   const bc = String(t.booking_code || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             125       detail: bc ? `Booking ${bc}` : "",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             130   const driverName = String(t.driver_name || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             131   const driverId = String(t.driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             134     "driver_assigned_at",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             135     "dispatch_assigned_at",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             136     "accepted_at",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             137     "driver_accepted_at",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             144       const who = driverName || driverId ? `Driver: ${driverName || driverId}` : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             292           t.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             295           t.driver_name,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             296           t.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             366           <div style={{ fontWeight: 800 }}>Find a booking</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             369             <div style={{ opacity: 0.8 }}>Search (booking code / id / driver / passenger):<...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             393                 const title = String(t.booking_code || id || "(no id)");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             413                       {t.driver_name ? `Driver: ${t.driver_name}` : t.driver_id ? `Driver I...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             425                   Showing first 80 results only. Narrow the search to find one booking.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             438               Select a booking on the left to view its timeline.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             444                   <span style={mono}>booking_code</span>{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx                                             445                   <b>{String(selectedTrip.booking_code || "") || "—"}</b>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                     17 type Role = "admin" | "dispatcher";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                     22   if (s === "dispatcher") return "dispatcher";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                     67             desc: "Real-time dispatch and tracking view (navigation only).",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                     76             title: "Driver Payouts",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                     77             desc: "Driver payout records and status overview.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                     78             href: "/admin/driver-payouts",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    112             title: "Driver Payout Requests (LGU View)",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    113             desc: "LGU-safe view of driver payout requests.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    114             href: "/admin/reports/driver-payout-requests",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    123             title: "Stuck Drivers",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    124             desc: "Drivers flagged for inactivity or stalled trips.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    125             href: "/admin/ops/stuck-drivers",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    166   // Dispatcher allowed links: ops-only + live + at-risk + audit helper
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    167   const dispatcherAllow = useMemo(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    172         "/admin/ops/stuck-drivers",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    182     // dispatcher: filter down to allowed hrefs and drop empty sections
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    185       const allowedItems = s.items.filter((it) => dispatcherAllow.has(it.href));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    189   }, [role, sections, dispatcherAllow]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    259             <button type="button" style={miniBtn} onClick={() => setRoleHint("dispatcher")}>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\control-center\page.tsx                                    260               Set role: dispatcher
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                     7     const { bookingId, action } = body;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                     9     if (!bookingId || !action) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                    11         { error: "MISSING_FIELDS", message: "bookingId and action required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                    40     // UPDATE BOOKING
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                    42       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                    44       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                    49       console.error("UPDATE_BOOKING_ERROR:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatch-action\route.ts                                    58     console.error("DISPATCH_ACTION_FATAL:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           19 export default function DispatcherVerificationPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           34       alert("Error loading dispatcher verification queue.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           48     const dispatcherId =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           50         ? window.prompt("Enter your dispatcher ID (for log only):")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           52     if (dispatcherId === null) return; // Cancel still allowed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           57         status: "pre_approved_dispatcher",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           63       console.error("dispatcher preApprove error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           71   const reject = async (id: number) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           74         ? window.prompt("Reason for rejection:")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           81         status: "rejected",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           82         reject_reason: reason,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           87       console.error("dispatcher reject error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           88       alert(`Error rejecting: ${error.message}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                           98         Passenger Verification (Dispatcher)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                          139                 onClick={() => reject(r.id)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\dispatcher-verifications\page.tsx                          141                 Reject
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                      7   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                     39 export default function AdminDriverPayoutsPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                     44   const [driverQuery, setDriverQuery] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                     56       const res = await fetch(`/api/admin/driver-payouts?status=${status}&limit=200`, { cac...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                     80       const res = await fetch("/api/admin/driver-payouts", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    115     const q = driverQuery.trim().toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    117     return rows.filter((r) => String(r.driver_id || "").toLowerCase().includes(q));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    118   }, [rows, driverQuery]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    146       <h1 style={{ fontSize: 20, fontWeight: 700 }}>Driver Payouts</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    159           Driver:&nbsp;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    161             value={driverQuery}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    162             onChange={(e) => setDriverQuery(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    163             placeholder="search driver_idâ€¦"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    181               {["id","driver_id","amount","status","requested_at","processed_at","method","...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\driver-payouts\page.tsx                                    194                   <td style={{ padding: 8, borderBottom: "1px solid #eee", fontFamily: "mon...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                             7 type Driver = { id: string; name: string | null; town: string | null; online: boolean };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                             9 export default function DriversAdminPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            10   const [rows, setRows] = useState<Driver[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            17     const { data, error } = await supabase.from("drivers").select();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            19     setRows((data ?? []) as Driver[]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            24   async function toggle(d: Driver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            25     const { data, error } = await supabase.rpc("set_driver_online", { p_driver_id: d.id, p_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            32       <h1 className="text-2xl font-bold">Admin Â· Drivers</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\drivers\page.tsx                                            51           {!rows.length && <tr><td colSpan={4} className="py-6 text-center opacity-60">No d...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                    17     j.bookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   241     const driverKeys = ["driver_payout", "driver_amount", "driver_share", "net_driver", "dr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   244     let gross = 0, platformFee = 0, driverPayout = 0, vendorTotal = 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   245     let grossCount = 0, platformCount = 0, driverCount = 0, vendorCount = 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   262       const dp = pickFirstNumber(t, driverKeys);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   263       if (dp !== null) { driverPayout += dp; driverCount++; }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   281       { metric: "Driver Payout (best-effort)", value: driverPayout, note: driverCount ? `De...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                         7 type DriverLocation = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                         8   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        17   | { ok: true; drivers: DriverLocation[] }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        28 export default function LiveDriversAdminPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        32   const [drivers, setDrivers] = useState<DriverLocation[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        33   const [filteredDrivers, setFilteredDrivers] = useState<DriverLocation[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        41   const [selectedDriverId, setSelectedDriverId] = useState<string | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        43   const fetchDrivers = async () => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        46       const res = await fetch("/api/admin/driver-locations", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        53         console.error("Failed to fetch drivers:", text);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        54         setError("Failed to load driver locations from server.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        62         setError("Failed to load driver locations from API.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        66       const list = data.drivers || [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        67       setDrivers(list);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                        71       setError("Network error while loading driver locations.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       109     fetchDrivers();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       110     const interval = setInterval(fetchDrivers, 10000);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       116     let list = [...drivers];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       132     setFilteredDrivers(list);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       133   }, [drivers, statusFilter, townFilter]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       143     for (const driver of filteredDrivers) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       144       const id = driver.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       147       const lngLat: [number, number] = [driver.lng, driver.lat];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       148       const markerColor = getMarkerColor(driver);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       149       const ageText = formatRelativeTime(driver.updated_at);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       166           setSelectedDriverId(id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       172             <div><strong>Driver:</strong> ${shortId(id)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       174               driver.town
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       175                 ? `<div><strong>Town:</strong> ${driver.town}</div>`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       178             <div><strong>Status:</strong> ${formatStatus(driver.status)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       180               driver.updated_at
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       196     // Remove markers for drivers no longer visible
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       203   }, [filteredDrivers]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       207       drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       213   const selectedDriver = filteredDrivers.find(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       214     (d) => d.driver_id === selectedDriverId
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       217   const handleFocusDriver = (driver: DriverLocation) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       218     setSelectedDriverId(driver.driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       222       center: [driver.lng, driver.lat],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       233             JRide – Live Drivers (Admin)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       236             Real-time view of active driver locations from production Supabase.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       241             Visible drivers:{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       243               {filteredDrivers.length}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       245             / {drivers.length}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       252             onClick={fetchDrivers}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       277                 Loading live driver locations…
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       327             {filteredDrivers.length === 0 ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       329                 No drivers match the current filters.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       332               filteredDrivers.map((d) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       339                     key={d.driver_id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       340                     onClick={() => handleFocusDriver(d)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       342                       selectedDriverId === d.driver_id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       354                           {shortId(d.driver_id)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       375           {selectedDriver && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       378                 Selected Driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       380               <div>Id: {shortId(selectedDriver.driver_id)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       381               <div>Town: {selectedDriver.town || "Unknown"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       382               <div>Status: {formatStatus(selectedDriver.status)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       384                 Last update: {formatTime(selectedDriver.updated_at)} (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       385                 {formatRelativeTime(selectedDriver.updated_at)})
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       397 function getMarkerColor(driver: DriverLocation): string {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       398   const status = (driver.status || "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       399   const ageMs = Date.now() - new Date(driver.updated_at).getTime();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetest\page.tsx                                            3 import LiveDriverMap from "@/components/LiveDriverMap";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetest\page.tsx                                            5 export default function LiveDriverMapTestPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetest\page.tsx                                           10           JRide Live Driver Map — Test
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetest\page.tsx                                           13           Internal test page for validating live driver locations and clusters.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetest\page.tsx                                           18         <LiveDriverMap />
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                   6   bookingId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                   7   onAssigned?: (driverId: string | null, status: string) => Promise<void> | void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                  10 export function AutoAssignButton({ bookingId, onAssigned }: AutoAssignButtonProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                  20         body: JSON.stringify({ booking_id: bookingId }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                  35       const driverId = (json.chosen_driver_id as string) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                  36       const status = (json.booking?.status as string) ?? "in_progress";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\AutoAssignButton.tsx                  39         await onAssigned(driverId, status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                 5 type DriverAssignButtonProps = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                 6   bookingId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                 7   driverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                 9   onAssigned?: (driverId: string) => Promise<void> | void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                12 export function DriverAssignButton({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                13   bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                14   driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                15   label = "Assign this driver",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                17 }: DriverAssignButtonProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                27         body: JSON.stringify({ booking_id: bookingId, driver_id: driverId }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\DriverAssignButton.tsx                43         await onAssigned(driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                    8   bookingId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   12 export function LiveTripEtaCell({ bookingId, status }: LiveTripEtaCellProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   45         // 1) Load pickup & dropoff coordinates from bookings
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   47           .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   49           .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   53           console.error("LiveTripEtaCell bookings fetch error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                  142   }, [bookingId, shouldShowEta, supabase]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ProblemTripAlerts.tsx                  5   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ProblemTripAlerts.tsx                  9   driver_status: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ProblemTripAlerts.tsx                 10   driver_town: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ProblemTripAlerts.tsx                 11   driver_updated_at: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ProblemTripAlerts.tsx                 33             <span className="font-semibold mr-1">{t.booking_code}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\TripStatusButtons.tsx                  6   bookingId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\TripStatusButtons.tsx                 12   bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\TripStatusButtons.tsx                 29         body: JSON.stringify({ booking_id: bookingId, status: nextStatus }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ZoneCapacityView.tsx                   5   online_drivers: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ZoneCapacityView.tsx                  16   const totalDrivers = zones.reduce(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ZoneCapacityView.tsx                  17     (sum, z) => sum + (z.online_drivers ?? 0),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ZoneCapacityView.tsx                  30           {totalTrips} active trip(s) / {totalDrivers} online driver(s)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\ZoneCapacityView.tsx                  41             <span className="text-slate-500">Drivers: {z.online_drivers}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\actions\getLiveTrips.ts                           10   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\actions\getLiveTrips.ts                           43   if (Array.isArray((raw as any).active_bookings)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\actions\getLiveTrips.ts                           44     return (raw as any).active_bookings;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\actions\getLiveTrips.ts                           47   if (Array.isArray((raw as any).bookings)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\actions\getLiveTrips.ts                           48     return (raw as any).bookings;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\actions\getLiveTrips.ts                           98       booking_code: String(b.booking_code),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                    9 type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   11  booking_code: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   13  assigned_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   22  bookings: Booking[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   31  const [bookings, setBookings] = useState<Booking[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   53  setErrorText(`Failed to load pending bookings: ${msg}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   54  setBookings([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   58  setBookings(data.bookings ?? []);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   62  `Server error while fetching pending bookings: ${
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   66  setBookings([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                   90  View pending bookings and assign the nearest online driver using{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  122  Pending Bookings (status = &apos;pending&apos; or &apos;searching&apos;,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  123  no assigned driver)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  140  Booking Code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  146  Assigned Driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  157  {bookings.length === 0 && !loading && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  163  No pending bookings found.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  174  Loading pending bookings...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  180  bookings.map((b, index) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  189  {b.booking_code ?? b.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  195  {b.assigned_driver_id ?? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  229  This page only shows bookings with{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  235  assigned_driver_id IS NULL
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\assign\page.tsx                                  242  assign_nearest_driver_v2()
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              11 export interface Booking {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              13   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              25   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              26   driver_lat?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              27   driver_lng?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              28   driver_status?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              29   driver_town?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              32 interface BookingMapClientProps {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              33   booking?: Booking | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              38 export default function BookingMapClient(props: BookingMapClientProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              39   const { booking, height = 420, onClose } = props;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              44   const driverMarkerRef = useRef<mapboxgl.Marker | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              54     // If there is no booking yet, do nothing.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              55     if (!booking) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              58       console.warn("[BookingMapClient] NEXT_PUBLIC_MAPBOX_TOKEN is missing.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              70       booking.pickup_lng || 121.059,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              71       booking.pickup_lat || 16.811,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              89       if (!booking) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              94       if (driverMarkerRef.current) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              95         driverMarkerRef.current.remove();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              96         driverMarkerRef.current = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             120         .setLngLat([booking.pickup_lng, booking.pickup_lat])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             136         .setLngLat([booking.dropoff_lng, booking.dropoff_lat])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             139       // ----- Driver marker (simple blue dot for now) -----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             141         typeof booking.driver_lat === "number" ? booking.driver_lat : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             143         typeof booking.driver_lng === "number" ? booking.driver_lng : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             145       let driverLat = realLat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             146       let driverLng = realLng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             148       if (driverLat === null || driverLng === null) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             150         driverLat = booking.pickup_lat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             151         driverLng = booking.pickup_lng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             154       console.log("[BookingMapClient] driver marker position", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             155         bookingCode: booking.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             158         driverLat,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             159         driverLng,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             162       if (driverLat !== null && driverLng !== null) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             163         const driverEl = document.createElement("div");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             164         driverEl.style.width = "32px";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             165 driverEl.style.height = "32px";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             166 driverEl.style.backgroundImage = "url('/icons/jride-trike.png')";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             167 driverEl.style.backgroundSize = "contain";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             168 driverEl.style.backgroundRepeat = "no-repeat";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             169 driverEl.style.backgroundPosition = "center";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             172 driverEl.style.backgroundColor = "transparent";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             173 driverEl.style.border = "none";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             174 driverEl.style.borderRadius = "0";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             175 driverEl.style.boxShadow = "none";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             178         driverMarkerRef.current = new mapboxgl.Marker({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             179           element: driverEl,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             182           .setLngLat([driverLng, driverLat])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             186       // Fit bounds to pickup, dropoff, and driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             188       bounds.extend([booking.pickup_lng, booking.pickup_lat]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             189       bounds.extend([booking.dropoff_lng, booking.dropoff_lat]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             190       if (driverLat !== null && driverLng !== null) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             191         bounds.extend([driverLng, driverLat]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             202       if (!booking) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             213       if (booking.status === "on_trip") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             218           originLng = booking.pickup_lng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             219           originLat = booking.pickup_lat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             221         destLng = booking.dropoff_lng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             222         destLat = booking.dropoff_lat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             228           originLng = booking.pickup_lng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             229           originLat = booking.pickup_lat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             231         destLng = booking.pickup_lng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             232         destLat = booking.pickup_lat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             247           console.error("[BookingMapClient] Directions error:", res.status, res.statusText);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             252           console.warn("[BookingMapClient] No route returned from Mapbox.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             298         console.error("[BookingMapClient] Error while adding route:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             307       driverMarkerRef.current = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             311   }, [booking]); // <- booking can be undefined; effect just returns early
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             315     if (!booking) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             317     const pickup = { lat: booking.pickup_lat, lng: booking.pickup_lng };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             318     const dropoff = { lat: booking.dropoff_lat, lng: booking.dropoff_lng };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             321       typeof booking.driver_lat === "number" ? booking.driver_lat : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             323       typeof booking.driver_lng === "number" ? booking.driver_lng : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             325     const driver =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             329       booking.status === "on_trip" ? "on_trip" : "to_pickup";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             336         driver: driver ?? undefined,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             355   }, [booking]); // same guard
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             357   const title = booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             358     ? booking.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             359       ? `JRide ${booking.booking_code}`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             360       : `Booking ${booking.id}`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             363   // If there is still no booking, show a simple placeholder panel (no map)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             364   if (!booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             396             {booking.pickup_label && <span>{booking.pickup_label}</span>}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             398             {booking.dropoff_label && <span>{booking.dropoff_label}</span>}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             405             status={booking.status}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                       7 type DriverLite = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      28   return String(t?.uuid ?? t?.id ?? t?.booking_uuid ?? t?.booking_id ?? t?.bookingCode ?? t...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      35   drivers,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      42   drivers: DriverLite[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      43   onManualAssign: (driverId: string) => void | Promise<void>;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      46   const [manualDriverId, setManualDriverId] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      55   const driverOptions = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      56     const list = (drivers || []).filter(Boolean).map((d: any) => ({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      58       name: String(d.name ?? `Driver ${String(d.id).slice(0, 4)}`),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      68   }, [drivers, zone]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      71     if (!manualDriverId) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      72     await onManualAssign(manualDriverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                      95                 <th className="px-2 py-2 text-left">Driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     113                     <td className="px-2 py-2">{s(t.booking_code ?? t.bookingCode ?? id).sli...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     114                     <td className="px-2 py-2">{s(t.driver_name ?? t.driverName ?? "-")}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     150                 <div className="text-slate-500">Driver wallet</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     151                 <div className="font-semibold">{s(selectedTrip.driver_wallet ?? selectedTri...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     163                   value={manualDriverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     164                   onChange={(e) => setManualDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     167                     {driverOptions.length === 0
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     168                       ? "No drivers in dropdown: driver_locations blocked by RLS or not ava...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     169                       : "Select driver"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     171                   {driverOptions.map((d) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     180                   disabled={!manualDriverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     198                 Dropdown sources: props → suggestions → driver_locations fallback.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                 6   bookingCode?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                 9   // Passed by DriverDetailsModal (optional)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                10   dispatcherName?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                12   assignedDriverId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                16   onAssign?: (driverId: string) => Promise<void>;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                22 export default function DispatchActionPanel({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                23   bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                25   dispatcherName,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                26   assignedDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                35   // ===== Fetch dispatch audit history =====
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                37     if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                43     fetch(`/api/admin/audit?bookingCode=${bookingCode}`)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                50   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                55         Select a trip to see dispatch actions.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                60   const assignDisabled = !canAssign || !!assignedDriverId || !onAssign;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                71       {/* ===== Dispatch actions ===== */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                73         <div className="mb-1 font-semibold text-slate-600">Dispatch actions</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                80               // This panel doesn't pick drivers; suggestions/parent handle actual assignment.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                88               dispatcherName
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx                89                 ? `Dispatcher: ${dispatcherName}`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx               132       {/* ===== Dispatch audit history ===== */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DispatchActionPanel.tsx               136             Recent dispatch activity
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                  6 // Local fallback type: DispatchActionTrip is not exported by ./DispatchActionPanel in this...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                  7 type DispatchActionTrip = any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                  9 import DispatchActionPanel from "./DispatchActionPanel";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 12   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 14   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 15   driver_name?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 16   driver_phone?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 23 type DriverDetailsModalProps = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 29   dispatcherName?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 32 function mapToDispatchTrip(raw: RawTrip | null | undefined): DispatchActionTrip | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 37     booking_code: raw.booking_code ?? raw["bookingCode"] ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 39     driver_id: raw.driver_id ?? raw["driverId"] ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 40     driver_name: raw.driver_name ?? raw["driverName"] ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 41     driver_phone: raw.driver_phone ?? raw["driverPhone"] ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 48 export function DriverDetailsModal(props: DriverDetailsModalProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 51     dispatcherName,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 56   const selectedTrip = mapToDispatchTrip(rawTrip);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 60   const driverLabel =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 61     selectedTrip?.driver_name ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 62     rawTrip?.driver_name ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 63     rawTrip?.["driverName"] ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 64     "Unknown driver";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 84   const bookingLabel =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 85     selectedTrip?.booking_code ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 86     rawTrip?.booking_code ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 87     rawTrip?.["bookingCode"] ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                 98               Driver details
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                101               {driverLabel}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                104               Trip: {bookingLabel} - Town: {townLabel}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                142                 Driver phone
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                145                 {selectedTrip?.driver_phone || "no number"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                158           {/* Dispatch actions panel */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                159           <DispatchActionPanel
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                160             bookingCode={selectedTrip?.booking_code ?? undefined}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                162             dispatcherName={dispatcherName ?? undefined}/>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                188           <span>Dispatch action panel · JRide</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                189           {dispatcherName && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                190             <span>Dispatcher: {dispatcherName}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                198 export default DriverDetailsModal;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                  6 // Local fallback: DispatchActionTrip is not exported by DispatchActionPanel
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                  7 type DispatchActionTrip = any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                  9 import DispatchActionPanel from "./DispatchActionPanel";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 12   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 14   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 15   driver_name?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 16   driver_phone?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 27   dispatcherName?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 30 function mapTrip(raw: RawTrip | null | undefined): DispatchActionTrip | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 35     booking_code: raw.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 37     driver_id: raw.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 38     driver_name: raw.driver_name ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 39     driver_phone: raw.driver_phone ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 46 export default function DriverLiveOverview(props: Props) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 53         ✅ DISPATCH ACTION PANEL ACTIVE
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 56       <DispatchActionPanel
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverLiveOverview.tsx                 58         dispatcherName={props.dispatcherName ?? undefined}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                   3 type ActiveDriver = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                  72 function formatDriverName(d: ActiveDriver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                  73   return d.full_name || d.name || d.callsign || "Unknown driver";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                  76 function getTownName(d: ActiveDriver): string {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                  82 function getStatusLabel(d: ActiveDriver): string {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 137 export default function DriverStatusPanel(props: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 139   const activeDrivers: ActiveDriver[] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 140     props?.activeDrivers || props?.drivers || props?.data || [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 142   if (!activeDrivers || activeDrivers.length === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 145         No active drivers right now.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 155           Drivers (active)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 183       {/* Driver rows */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 185         {activeDrivers.map((d, idx) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverStatusPanel.tsx                 201                     {formatDriverName(d)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               39     let driverNet = 0;    // what driver earns
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               49       const driverTake = pickNum(t, ["driver_earnings", "driver_cut", "driver_net", "driver...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               54       driverNet += n(driverTake);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               58     return { active, completed, gross, platform, driverNet, vendorNet };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               85           <div className="text-[10px] text-slate-500">Driver net</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               86           <div className="text-sm font-semibold">{money(summary.driverNet)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx              106         Uses fields if present: fare_amount, platform_fee/service_fee, driver_cut/driver_ne...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                        7 import DispatchActionPanel from "./DispatchActionPanel";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       83 function getExplicitDriver(trip: any): LngLatTuple | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       85     num(trip.driver_lat) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       86     num(trip.driverLat) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       87     num(trip.driver_latitude);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       89     num(trip.driver_lng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       90     num(trip.driverLng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       91     num(trip.driver_longitude);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                       97  * Fallback: collect all coords and infer a driver position
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      143  * Driver position priority:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      144  * 1) explicit driver_* fields
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      150 function getDriverReal(trip: any): LngLatTuple | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      151   // Prefer explicit driver GPS fields
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      152   const explicit = getExplicitDriver(trip);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      155   // If booking only has pickup/dropoff (no driver GPS yet), do NOT infer driver from them.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      159   const hasAnyDriverGps =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      160     num(trip?.driver_lat) != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      161     num(trip?.driver_lng) != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      162     num(trip?.driverLat) != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      163     num(trip?.driverLng) != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      164     num(trip?.driver_latitude) != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      165     num(trip?.driver_longitude) != null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      167   if (hasPickup && hasDrop && !hasAnyDriverGps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      180  * Display position for the trike icon: slightly south of real driver position
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      183 function getDriverDisplay(real: LngLatTuple | null): LngLatTuple | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      276   bookingCode?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      277   driverName?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      278   driverId?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      279   driverTown?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      295   const driverMarkersRef = useRef<Record<string, mapboxgl.Marker>>({});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      326       // JRIDE_PHASE7A_SAFE_NODRIVER_STUCK_GUARD
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      327       // Only driver-backed trips can be considered 'stuck'.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      328       const _hasDriver =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      329         (raw as any).driver_id != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      330         (raw as any).driverId != null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      331         (Number.isFinite(Number((raw as any).driver_lat)) && Number.isFinite(Number((raw as...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      332         (Number.isFinite(Number((raw as any).driverLat)) && Number.isFinite(Number((raw as ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      334       if (!_hasDriver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      337       const id = String(raw.id ?? raw.bookingCode ?? i);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      339       const driverReal =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      340         getDriverReal(raw) ?? getDropoff(raw) ?? getPickup(raw);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      341       if (!driverReal) continue;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      344         lastPos: driverReal,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      350         const dist = distanceMeters(prev.lastPos, driverReal);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      352           prev.lastPos = driverReal;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      361         prev.lastPos = driverReal;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      371         String((t as any).id ?? (t as any).bookingCode ?? idx)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      396       const id = String(tRaw.id ?? tRaw.bookingCode ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      466       const id = String(tRaw.id ?? tRaw.bookingCode ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      513     const drivers = trips.filter((t: any) =>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      529       for (const d of drivers as any[]) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      530         const driverReal = getDriverReal(d);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      531         if (!driverReal) continue;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      534         const dist = distanceMeters(pickup, driverReal);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      545             tripId: String(p.id ?? p.bookingCode ?? ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      546             bookingCode: p.bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      547             driverName: d.driver_name ?? d.driverName ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      548             driverId: d.driver_id ?? d.driverId ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      549             driverTown: dTown,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      552               ? "Nearest driver but from another town"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      553               : "Nearest available driver",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      566   // ===== SELECTED DRIVER LIVE OVERVIEW =====
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      572           String(t.id ?? t.bookingCode ?? "") === selectedTripId
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      580     const id = String(selectedTrip.id ?? selectedTrip.bookingCode ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      581     const driverName =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      582       selectedTrip.driver_name ?? selectedTrip.driverName ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      587     const driverReal = getDriverReal(selectedTrip);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      593     if (driverReal && pickup) distToPickup = distanceMeters(driverReal, pickup);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      594     if (driverReal && drop) distToDrop = distanceMeters(driverReal, drop);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      596     const bookingCode = selectedTrip.bookingCode ?? id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      598       selectedTrip.driver_last_seen_at ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      605       driverName,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      611       bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      648     const nextDrivers: Record<string, mapboxgl.Marker> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      655       const id = String(raw.id ?? raw.bookingCode ?? i);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      657       const driverReal = getDriverReal(raw);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      661       // Fallback marker when driver GPS is missing:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      662       // show a driver marker at pickup (or dropoff) for active statuses so dispatcher sees...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      663       let driverDisplay = getDriverDisplay(driverReal);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      665       if (!driverDisplay && (statusNorm === "assigned" || statusNorm === "on_the_way" || st...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      667         if (fb) driverDisplay = fb;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      673       // DRIVER marker
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      674       if (driverDisplay) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      675         let marker = driverMarkersRef.current[id];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      699 if (isStuck || isProblem) el.classList.add("jride-marker-blink");marker = new mapboxgl.Mark...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      701           marker.setLngLat(driverDisplay);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      709         nextDrivers[id] = marker;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      789       for (const [id, marker] of Object.entries(driverMarkersRef.current)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      790         if (!nextDrivers[id]) marker.remove();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      807     driverMarkersRef.current = nextDrivers;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      819       (t: any) => String(t.id ?? t.bookingCode ?? "") === selectedTripId
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      823     const driverReal = getDriverReal(raw);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      829 // Pending/assigned: follow pickup (driver not moving yet)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      830 // Otherwise: follow driverReal when available
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      831 // Pending/assigned: follow pickup (driver not moving yet)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      832 // Otherwise: follow driverReal when available
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      836     : (driverReal ?? pickup ?? drop ?? null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      863       const driverReal = getDriverReal(raw);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      869       if (driverReal) coords.push(driverReal);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                      892     // Padding accounts for overlays (top KPIs, left zones, bottom panels, right dispatch)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1031                     Trip {s.bookingCode ?? s.tripId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1036                       {s.driverName ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1037                         (s.driverId ? `Driver ${s.driverId}` : "Nearest driver")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1039                     {s.driverTown ? ` (${s.driverTown})` : null}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1053         {/* DRIVER LIVE OVERVIEW + DISPATCH ACTION PANEL */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1058                 Driver live overview
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1061                 {selectedOverview.bookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1066                 <span className="text-slate-500">Driver</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1068                   {selectedOverview.driverName ?? "Unknown"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1110             <DispatchActionPanel
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1111               bookingCode={selectedOverview?.bookingCode ?? selectedOverview?.id ?? undefined}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1116                       booking_code:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1117                         selectedTrip.bookingCode ?? selectedOverview.bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1120                       driver_id:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1121                         selectedTrip.driver_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1122                         selectedTrip.driverId ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1124                       driver_name:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1125                         selectedTrip.driver_name ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1126                         selectedTrip.driverName ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1127                         selectedOverview.driverName ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1129                       driver_phone:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1130                         selectedTrip.driver_phone ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1131                         selectedTrip.driverPhone ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1149               dispatcherName={undefined}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ProblemTripAlertSounds.tsx             16   bookingCode?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ProblemTripAlertSounds.tsx            104       problemTrips.map((t) => String(t.id ?? t.bookingCode ?? ""))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SelectedBookingPanel.tsx                7   booking: LiveTrip | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SelectedBookingPanel.tsx               10 export default function SelectedBookingPanel({ booking }: Props) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SelectedBookingPanel.tsx               11   if (!booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SelectedBookingPanel.tsx               14         Select a booking to inspect details and follow the trip on the map.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SelectedBookingPanel.tsx               19   const { booking_code, passenger_name, pickup, dropoff } = booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SelectedBookingPanel.tsx               24         <div className="font-semibold text-slate-700">{booking_code}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         13   drivers: AnyObj[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         18   onAssign?: (driverId: string) => void | Promise<void>;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         20   assignedDriverId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         21   assigningDriverId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         62 function getDriverId(d: AnyObj) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         63   return String(d?.driver_id ?? d?.id ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         66 function getDriverTown(d: AnyObj) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         70 function getDriverName(d: AnyObj) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         71   return d?.name ?? d?.driver_name ?? "Driver";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         74 function getDriverCoords(d: AnyObj) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         84   drivers,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         88   assignedDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx         89   assigningDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        100     const sameTown = (drivers || []).filter((d) => normTown(getDriverTown(d)) === tripTown);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        104       const zKey = String(getDriverTown(d) ?? "Unknown");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        117         id: getDriverId(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        118         name: getDriverName(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        119         town: getDriverTown(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        129         const c = getDriverCoords(d);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        136         id: getDriverId(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        137         name: getDriverName(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        138         town: getDriverTown(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        157           id: getDriverId(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        158           name: getDriverName(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        159           town: getDriverTown(d),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        170   }, [drivers, trip, zoneStats, forceAssign]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        180         No eligible drivers from <span className="font-semibold">{String(z || "Unknown")}</...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        194         const isAssigned = !!assignedDriverId && d.id === assignedDriverId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        195         const isAssigning = !!assigningDriverId && d.id === assigningDriverId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        202           (!!assigningDriverId && assigningDriverId !== d.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        204         const label = isAssigning ? "Assigning..." : isAssigned ? "Assigned" : assignedDriv...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        223               title={assignedDriverId ? "One driver per trip. Clicking Assign will REASSIGN...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\StuckTripWatcher.tsx                   60       .map((t) => String(t.id ?? t.bookingCode ?? ""));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx              8   drivers: any[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             22   return String(d?.uuid ?? d?.driver_uuid ?? d?.driver_id ?? d?.id ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             26   return String(d?.name ?? d?.driver_name ?? d?.label ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             29 function normalizeDriverList(list: any[]): { id: string; label: string }[] {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             35       const label = nm ? nm : `Driver ${id.slice(0, 4)}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             41 // Try to extract “Smart Auto-Assign Suggestions” drivers from trip payload
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             42 function extractSuggestionDrivers(trip: any): any[] {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             56     if (c && Array.isArray(c?.drivers) && c.drivers.length) return c.drivers;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             62 export default function TripControlWalletPanel({ trip, drivers, onRefresh }: Props) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             63   const [driverId, setDriverId] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             68   // booking identifier (uuid first, then id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             69   const bookingUuid = trip?.uuid ?? trip?.booking_uuid ?? trip?.booking_id ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             70   const bookingId = trip?.id ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             74   // ---- DRIVER SOURCES (priority) ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             75   // 1) drivers prop (if present)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             76   const propDrivers = useMemo(() => normalizeDriverList(drivers || []), [drivers]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             79   const suggestionDrivers = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             80     const sug = extractSuggestionDrivers(trip);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             81     return normalizeDriverList(sug);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             84   // 3) fallback fetch from driver_locations if both are empty
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             85   const [fetchedDrivers, setFetchedDrivers] = useState<{ id: string; label: string }[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             89     async function fetchDrivers() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             91       if (propDrivers.length || suggestionDrivers.length) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             95           .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx             96           .select("id,uuid,driver_id,driver_uuid,driver_name,name")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            100           if (!cancelled) setUiMsg("No drivers in dropdown: driver_locations blocked by RLS...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            101           console.error("driver_locations fetch error:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            105         const normalized = normalizeDriverList(data || []);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            106         if (!cancelled) setFetchedDrivers(normalized);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            108         console.error("driver_locations fetch exception:", e);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            112     fetchDrivers();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            114   }, [propDrivers.length, suggestionDrivers.length]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            116   const driverOpts = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            117     // Merge unique drivers by id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            118     const all = [...propDrivers, ...suggestionDrivers, ...fetchedDrivers];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            128   }, [propDrivers, suggestionDrivers, fetchedDrivers]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            131   async function assignDriver() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            133     if (!driverId) { setUiMsg("Select a driver first."); return; }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            135     const bid = bookingUuid ?? bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            136     if (!bid) { setUiMsg("Trip missing booking id/uuid."); return; }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            142         { booking_uuid: bid, driver_uuid: driverId, assigned_by: "dispatcher" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            143         { booking_uuid: bid, driver_uuid: driverId },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            144         { booking_id: bid, driver_id: driverId, assigned_by: "dispatcher" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            145         { booking_id: bid, driver_id: driverId },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            146         { p_booking_id: bid, p_driver_id: driverId, p_actor: "dispatcher" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            147         { p_booking_id: bid, p_driver_id: driverId },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            153         const { error } = await supabase.rpc("dispatcher_assign_driver", p as any);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            172     const bidUuid = bookingUuid;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            173     const bidId = bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            179         const { error } = await supabase.from("bookings").update({ status: next }).eq("uuid...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            191         const { error } = await supabase.from("bookings").update({ status: next }).eq("id",...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            203       setUiMsg("Status update failed: missing uuid/id for booking.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            238           <div className="text-[10px] text-slate-500">Driver wallet</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            239           <div className="text-sm font-semibold">{money(trip?.driver_wallet_balance ?? trip...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            250           value={driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            251           onChange={(e) => setDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            253           <option value="">Select driver</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            254           {driverOpts.map((d) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            261           disabled={busy || !canAssign || !driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            262           onClick={assignDriver}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            275         Dropdown sources: props → suggestions → driver_locations fallback.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            30  * This avoids external API errors and is stable for dispatcher view.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEtaPhase.tsx                        4   bookingStatus: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEtaPhase.tsx                        5   driverLat: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEtaPhase.tsx                        6   driverLng: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEtaPhase.tsx                       14   bookingStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEtaPhase.tsx                       15   driverLat,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEtaPhase.tsx                       16   driverLng,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               19     window.dispatchEvent(new CustomEvent(JRIDE_LIVETRIPS_EVT, { detail }));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               37   const bookingCode = String(trip?.booking_code || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               47     if (!bookingCode) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               50       await postJson("/api/dispatch/status", { bookingCode, status: nextStatus });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               52       emitLiveTripsEvt({ bookingCode, status: nextStatus });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               74             Code: <span className="font-mono">{bookingCode || "N/A"}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               88           disabled={!bookingCode || !canMarkOnTheWay}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx               97           disabled={!bookingCode || !canStartTrip}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripLifecycleActions.tsx              106           disabled={!bookingCode || !canComplete}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    34  * bookings has verified_fare, proposed_fare, total_errand_fare, and components:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    42   const code = String(trip?.booking_code ?? trip?.bookingCode ?? "").trim().toUpperCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    45 function computeFareFromBooking(trip: any): number | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    80 type LedgerKind = "driver" | "vendor";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    84   if (kind === "driver") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    86       trip?.driver_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    87       trip?.driverId ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    88       trip?.assigned_driver_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    89       trip?.assignedDriverId ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   116   const fare = useMemo(() => computeFareFromBooking(trip), [trip]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   154 const driverPayout = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   155     const explicit = asNum(trip?.driver_payout ?? trip?.driver_fee ?? trip?.driver_earnings...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   161   const driverWallet = useMemo(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   162     () => trip?.driver_wallet_balance ?? trip?.driver_wallet ?? trip?.driverWallet ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   172   const [kind, setKind] = useState<LedgerKind>("driver");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   177   const driverId = useMemo(() => getId(trip, "driver"), [trip]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   183     const id = kind === "driver" ? driverId : vendorId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   185       setErr(kind === "driver" ? "No driver_id on this trip." : "No vendor_id on this trip.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   234   }, [open, kind, driverId, vendorId]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   238   // Prevent confusing modal when trip has no driver/vendor id (e.g., takeout-like bookings)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   239   if (k === "driver" && !driverId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   240     setErr("No driver_id on this trip.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   265           <div className="text-slate-500">Driver payout</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   266           <div className="font-semibold">{fmtMoney(driverPayout)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   270           <div className="text-slate-500">Driver wallet</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   271           <div className="font-semibold">{fmtMoney(driverWallet)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   274             onClick={() => openLedger("driver")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   275             disabled={!driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   277             title={driverId ? "View driver wallet ledger (read-only)" : "No driver on this ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   307                 {kind === "driver" ? "Driver wallet ledger" : "Vendor wallet ledger"}{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   325                   onClick={() => setKind("driver")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   328                     (kind === "driver" ? "bg-slate-900 text-white" : "bg-white")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   331                   Driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   344                   ID: {kind === "driver" ? (driverId ?? "--") : (vendorId ?? "--")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneCapacity.tsx                       12   active_drivers: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneCapacity.tsx                       88     (sum, z) => sum + (z.active_drivers ?? 0),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneCapacity.tsx                      113               {z.active_drivers}/{z.capacity_limit}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneCapacity.tsx                      131               ? (z.active_drivers / z.capacity_limit) * 100
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneCapacity.tsx                      169                   <span>{z.active_drivers}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                  12   active_drivers: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                  29       z.capacity_limit > 0 ? z.active_drivers / z.capacity_limit : 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                  37         "Very high load. Dispatcher should prioritize trips in this town and remind drivers...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                  88           Ordinance: Drivers cannot be moved between municipalities.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                 102             <div className="text-right">Dispatcher Notes</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                 128                       {a.zone.active_drivers}/{a.zone.capacity_limit} drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                 151         This panel is for monitoring only. It does NOT move drivers between
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ZoneLoadBalancing.tsx                 152         towns. Dispatchers must respect each driver's home municipality: drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchActions.tsx                                5 type DispatchActionsProps = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchActions.tsx                                7   selectedBooking: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchActions.tsx                               10 export function DispatchActions({ selectedBooking }: DispatchActionsProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchActions.tsx                               11   if (!selectedBooking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchActions.tsx                               14         No booking selected.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchActions.tsx                               39 export default DispatchActions;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                    5   BookingStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                    6   BookingRowForRules,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                    7   buildDriverLabel,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                    8   buildDriverMap,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                    9   DriverInfo,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   10   DriverMap,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   12 } from "./dispatchRules";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   14 export type BookingRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   16   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   17   status: BookingStatus;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   18   assigned_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   30   booking: BookingRow;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   31   drivers: DriverInfo[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   34   onAssign: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   35   onReassign: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   36   onCancel: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   37   onMarkOnTheWay: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   38   onStartTrip: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   39   onDropOff: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   40   onViewMap: (booking: BookingRow) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   43 export default function DispatchRow({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   44   booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   45   drivers,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   55   const driversById: DriverMap = useMemo(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   56     () => buildDriverMap(drivers),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   57     [drivers]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   60   const driverLabel = buildDriverLabel(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   61     booking.assigned_driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   62     driversById
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   66     status: booking.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   67     assigned_driver_id: booking.assigned_driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   68     hasPickupCoords: !!(booking.pickup_lat && booking.pickup_lng),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   69     hasDropoffCoords: !!(booking.dropoff_lat && booking.dropoff_lng),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   70   } as BookingRowForRules);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   72   const fromLabel = booking.from_label || "(no pickup label)";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   73   const toLabel = booking.to_label || "(no dropoff label)";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   78         {booking.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   81         <div className="font-semibold">{driverLabel}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   83           {booking.status.replace(/_/g, " ")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                   93         {new Date(booking.created_at).toLocaleString()}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  101             onClick={() => onAssign(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  110             onClick={() => onReassign(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  119             onClick={() => onMarkOnTheWay(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  128             onClick={() => onStartTrip(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  137             onClick={() => onDropOff(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  146             onClick={() => onCancel(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DispatchRow.tsx                                  155             onClick={() => onViewMap(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                   1 export type BookingStatus =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                   4   | "accepted"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  10 export type BookingRowForRules = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  11   status: BookingStatus;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  12   assigned_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  27 export type DriverInfo = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  28   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  35 export type DriverMap = Map<string, DriverInfo>;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  37 export function buildDriverMap(drivers: DriverInfo[]): DriverMap {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  38   const map = new Map<string, DriverInfo>();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  39   for (const d of drivers) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  40     if (d.driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  41       map.set(d.driver_id, d);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  47 export function buildDriverLabel(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  48   assigned_driver_id: string | null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  49   driversById: DriverMap
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  51   if (!assigned_driver_id) return "Unassigned";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  53   const info = driversById.get(assigned_driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  55     return assigned_driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  80   if (info.driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  81     if (main) return `${main} (${info.driver_id})`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  82     return info.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  85   return main || "Unknown driver";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  88 export function getButtonRules(row: BookingRowForRules): ButtonRules {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  89   const { status, assigned_driver_id } = row;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                  91   const isAssigned = !!assigned_driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\dispatchRules.ts                                 119     case "accepted":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                                7 export type Driver = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               17   drivers: Driver[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               27 const STATUS_LABEL: Record<Driver["status"], string> = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               33 export default function DriverListPanel() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               34   const [drivers, setDrivers] = useState<Driver[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               40     async function loadDrivers() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               43         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               46           driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               50           driver_profiles:driver_id (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               61         console.error("Failed to load drivers", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               62         setDrivers([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               66       const mapped: Driver[] = data.map((row: any) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               69           row.driver_profiles?.municipality ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               73           id: row.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               74           name: row.driver_profiles?.full_name || "Unnamed driver",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               76             (row.status as Driver["status"]) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               83       setDrivers(mapped);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               86     loadDrivers();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               95   const total = drivers.length;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               96   const online = drivers.filter((d) => d.status === "online").length;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                               97   const onTrip = drivers.filter((d) => d.status === "on_trip").length;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              102     const byTown: Record<string, Driver[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              103     for (const d of drivers) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              116       drivers: byTown[town].sort((a, b) =>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              142           Loading drivers…
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              164                   {group.drivers.length}{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              165                   {group.drivers.length === 1
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              166                     ? "driver"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              167                     : "drivers"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              171               {group.drivers.map((driver) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              173                   key={driver.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              181                         driver.status === "online" &&
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              183                         driver.status === "offline" &&
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              185                         driver.status === "on_trip" &&
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              192                         {driver.name}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              195                         {STATUS_LABEL[driver.status]}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              201                   {driver.updatedAt && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              205                         driver.updatedAt
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              217             No drivers found.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTrips.tsx                                      9 // Adjust this type to match your "bookings" row if you want,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTrips.tsx                                     11 type Booking = any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTrips.tsx                                     19     // Subscribe to realtime changes on bookings
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTrips.tsx                                     27           table: "bookings",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               26   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               42   driver_id?: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               43   assigned_driver_id?: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               44   driverId?: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               52 type DriverRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               53   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               57   driver_name?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               60   driver_phone?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               75   bookings?: TripRow[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                               81   | "dispatch"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              108 function hasDriver(t: any): boolean {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              109   const v = (t as any)?.driver_id ?? (t as any)?.assigned_driver_id ?? (t as any)?.driverId...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              116   if (s === "assigned" && !hasDriver(t)) return "pending";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              138   return String((t as any)?.uuid ?? (t as any)?.id ?? (t as any)?.booking_code ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              174   if (s === "assigned" && !hasDriver(t)) return "Assigned but no driver linked";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              202 async function callLiveTripsAction(action: "NUDGE_DRIVER" | "REASSIGN_DRIVER" | "AUTO_ASSIG...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              203   const booking_code = (t as any)?.booking_code ?? (t as any)?.bookingCode ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              212         booking_code: (String((t as any).booking_code ?? (t as any).bookingCode ?? "").trim...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              231   const [tripFilter, setTripFilter] = useState<FilterKey>("dispatch");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              242   // Flagged trips are UI-only (no backend). Used for dispatcher follow-up.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              291 const [drivers, setDrivers] = useState<DriverRow[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              292   const [driversDebug, setDriversDebug] = useState<string>("Drivers: not loaded yet");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              293   const [manualDriverId, setManualDriverId] = useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              301   const driversSorted = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              302     const arr = Array.isArray(drivers) ? [...drivers] : [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              308       const an = String(a?.name ?? a?.driver_name ?? "Driver");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              309       const bn = String(b?.name ?? b?.driver_name ?? "Driver");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              313   }, [drivers]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              315   const manualDriverObj = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              316     const mid = String(manualDriverId || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              318     return (driversSorted || []).find((d: any) => String(d?.driver_id ?? d?.id ?? "") === m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              319   }, [driversSorted, manualDriverId]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              321   const manualDriverIsAvailable = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              322     const s = String((manualDriverObj as any)?.status ?? "").trim().toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              324   }, [manualDriverObj]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              346     setAllTrips((j.trips || j.bookings || j.data || []) as any[]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              349   async function loadDrivers() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              351       const r = await fetch("/api/admin/driver_locations", { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              353       const list: DriverRow[] = (Array.isArray(j) ? j : (j?.drivers || j?.data || [])) as a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              354       setDrivers(list);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              355       setDriversDebug(`Drivers: loaded from /api/admin/driver_locations (${list.length})`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              357       setDriversDebug(`Drivers: failed (${String(e?.message || e)})`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              363     loadDrivers().catch(() => {});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              409   async function assignDriver(bookingCode: string, driverId: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              412           if (!bookingCode || !driverId) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              414           await postJson("/api/dispatch/assign", { booking_code: bookingCode, bookingCode, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              423     async function updateTripStatus(bookingCode: string, status: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              424     if (!bookingCode || !status) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              427       await postJson("/api/dispatch/status", { booking_code: bookingCode, bookingCode, stat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              436     async function forceTripStatus(bookingCode: string, status: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              437     if (!bookingCode || !status) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              440       await postJson("/api/dispatch/status", { booking_code: bookingCode, bookingCode, stat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              450       dispatch: 0,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              465       if (isActiveTripStatus(s)) c.dispatch++;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              472     if (tripFilter === "dispatch") return allTrips.filter((t) => isActiveTripStatus(effecti...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              511   function primaryProblemAction(t: TripRow): "NUDGE_DRIVER" | "AUTO_ASSIGN" | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              513     if (reason.indexOf("Assigned but no driver") >= 0) return "AUTO_ASSIGN";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              514     if (reason.indexOf("stale") >= 0) return "NUDGE_DRIVER";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              518   const selectedBookingCode = (selectedTrip as any)?.booking_code || null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              528           <p className="text-sm text-gray-600">Monitor active bookings on the left and foll...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              540         <button className={pillClass(tripFilter === "dispatch")} onClick={() => setFilterAn...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              541           Dispatch <span className="text-xs opacity-80">({counts.dispatch})</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              634                         <div className="font-medium">{(t as any)?.booking_code || "-----"}<...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              666                             onClick={(e) => { e.stopPropagation(); updateTripStatus((t as a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              667                             disabled={!((t as any)?.booking_code) || nextLifecycleStatus(sE...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              674                             onClick={(e) => { e.stopPropagation(); updateTripStatus((t as a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              675                             disabled={!((t as any)?.booking_code) || nextLifecycleStatus(sE...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              682                             onClick={(e) => { e.stopPropagation(); updateTripStatus((t as a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              683                             disabled={!((t as any)?.booking_code) || nextLifecycleStatus(sE...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              691                             onClick={(e) => { e.stopPropagation(); updateTripStatus((t as a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              692                             disabled={!((t as any)?.booking_code) || nextLifecycleStatus(sE...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              701                             onClick={(e) => { e.stopPropagation(); forceTripStatus((t as an...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              716                             forceTripStatus((t as any)?.booking_code, "completed");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              730                                   primary === "NUDGE_DRIVER" ? "bg-black text-white border-...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              738                                     await callLiveTripsAction("NUDGE_DRIVER", t);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              752                                 disabled={!hasDriver(t)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              753                                 title={!hasDriver(t) ? "No driver linked" : "Clear driver a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              756                                   if (!confirm("Reassign this trip? This clears driver link...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              759                                     await callLiveTripsAction("REASSIGN_DRIVER", t);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              775                                 disabled={!canAutoAssign || !!pendingAutoAssignById[String(...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              776                                 title={!canAutoAssign ? "Requires pickup & dropoff coordina...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              780                                     const _id = String((t as any)?.id ?? (t as any)?.bookin...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              814             {driversDebug}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              832                     <div>Code: {(selectedTrip as any)?.booking_code}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              836                         onClick={() => updateTripStatus((selectedTrip as any)?.booking_code...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              837                         disabled={!selectedBookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              840                         onClick={() => updateTripStatus((selectedTrip as any)?.booking_code...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              841                         disabled={!selectedBookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              844                         onClick={() => updateTripStatus((selectedTrip as any)?.booking_code...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              845                         disabled={!selectedBookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              848                         onClick={() => updateTripStatus((selectedTrip as any)?.booking_code...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              849                         disabled={!selectedBookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              859                 <div className="font-semibold">Driver payout</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              863                 <div className="font-semibold">Driver wallet</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              888               <div className="font-semibold mb-2">Assign driver (manual)</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              892                   value={manualDriverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              893                   onChange={(e) => setManualDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              895                   <option value="">Select driver</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              896                   {driversSorted.map((d, idx) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              897                     const id = String((d as any)?.driver_id ?? (d as any)?.id ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              898                     const name = String((d as any)?.name ?? (d as any)?.driver_name ?? "Dri...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              912                   disabled={!selectedBookingCode || !manualDriverId || !manualDriverIsAvail...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              914                     if (!selectedBookingCode) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              915                     if (!manualDriverId) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              917                     if (!manualDriverIsAvailable) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              918                       setLastAction("Select an AVAILABLE driver (others are disabled).");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              925                       await assignDriver(selectedBookingCode, manualDriverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              977               drivers={(drivers || []).map((d: any, idx: number) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              978                 const id = String(d?.id ?? d?.driver_id ?? idx);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              979                 const name = String(d?.name ?? d?.driver_name ?? "Driver");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              980                 const lat = Number(d?.lat ?? d?.latitude ?? d?.driver_lat ?? 0);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              981                 const lng = Number(d?.lng ?? d?.longitude ?? d?.driver_lng ?? 0);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              990                       id: String((selectedTrip as any)?.id ?? (selectedTrip as any)?.uuid ?...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1005               assignedDriverId={String(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1006                 (selectedTrip as any)?.driver_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1007                   (selectedTrip as any)?.assigned_driver_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1008                   (selectedTrip as any)?.driverId ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1011               assigningDriverId={null}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1017               onAssign={async (driverId: string) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1019                 const bookingCode =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1020                   (selectedTrip as any)?.booking_code ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1021                   (selectedTrip as any)?.bookingCode ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1023                 if (!bookingCode) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                             1024                 await assignDriver(bookingCode, driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                 5 type BookingWithExtras = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                15   assigned_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                16   assigned_driver_name: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                17   assigned_driver_phone: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                21   driver_status: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                22   driver_online: boolean;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                23   driver_location_updated_at: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                29   activeBookings: BookingWithExtras[] | null | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                30   recentCompleted: BookingWithExtras[] | null | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                31   selectedBooking: BookingWithExtras | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                32   onSelectBooking: (booking: BookingWithExtras | null) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                35 function StatusBadge({ booking }: { booking: BookingWithExtras }) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                36   const status = booking.status ?? "Unknown";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                61 function DriverBadge({ booking }: { booking: BookingWithExtras }) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                62   if (!booking.assigned_driver_name) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                72       {booking.assigned_driver_name}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                77 function EtaCell({ booking }: { booking: BookingWithExtras }) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                78   if (booking.eta_minutes == null) return <span className="text-[11px] text-slate-400">-</s...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                79   const minutes = Math.max(0, Math.round(booking.eta_minutes));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                88   activeBookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                90   selectedBooking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                91   onSelectBooking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                93   const active: BookingWithExtras[] = Array.isArray(activeBookings)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                94     ? (activeBookings as BookingWithExtras[])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                96   const recent: BookingWithExtras[] = Array.isArray(recentCompleted)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                                97     ? (recentCompleted as BookingWithExtras[])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               128               <th className="px-3 py-2 text-left font-semibold">Driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               145             {active.map((booking) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               146               const isSelected = selectedBooking?.id === booking.id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               150                   key={booking.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               155                   onClick={() => onSelectBooking(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               160                         {booking.code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               163                         {booking.created_at
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               164                           ? new Date(booking.created_at).toLocaleString()
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               172                         {booking.passenger_name ?? "-"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               174                       {booking.passenger_phone && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               176                           {booking.passenger_phone}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               183                       {booking.pickup ?? "-"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               188                       {booking.dropoff ?? "-"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               193                       {booking.zone ?? booking.town ?? "-"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               197                     <DriverBadge booking={booking} />
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               200                     <StatusBadge booking={booking} />
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               203                     <EtaCell booking={booking} />
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               218               {recent.slice(0, 6).map((booking) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               220                   key={booking.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               222                   onClick={() => onSelectBooking(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               225                     selectedBooking?.id === booking.id && "border-emerald-400"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsTable.tsx                               228                   {booking.code} - {booking.passenger_name ?? "Passenger"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          16 type BookingMapClientProps = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          17   bookingId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          18   bookingCode?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          23   driverId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          24   booking?: AnyRecord;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          48 // Map official town colors -> used for driver halo
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          74 export default function BookingMapClient({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          75   booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          77 }: BookingMapClientProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          83   const driverMarkerRef = useRef<mapboxgl.Marker | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          85   const routeIdRef = useRef<string>("jride-booking-route");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          87   // Derive coordinates from booking, with fallbacks to different field names.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          90       toLatLng(booking?.pickup_lat, booking?.pickup_lng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          91       toLatLng(booking?.from_lat, booking?.from_lng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          94   }, [booking]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          98       toLatLng(booking?.dropoff_lat, booking?.dropoff_lng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          99       toLatLng(booking?.to_lat, booking?.to_lng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         102   }, [booking]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         104   const driver = useMemo<LatLng | null>(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         106       toLatLng(booking?.driver_lat, booking?.driver_lng) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         108         booking?.driver?.lat ?? booking?.driver?.latitude,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         109         booking?.driver?.lng ?? booking?.driver?.longitude
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         113   }, [booking]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         115   const driverTown = useMemo<string | null>(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         117       booking?.zone ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         118       booking?.town ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         119       booking?.driver?.town ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         122   }, [booking]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         130       driver ?? pickup ?? dropoff ?? { lat: 16.8003, lng: 121.1153 }; // Kiangan-ish fallback
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         150   }, [driver, pickup, dropoff]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         193       if (driverMarkerRef.current) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         194         driverMarkerRef.current.remove();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         195         driverMarkerRef.current = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         236       // Driver marker (JRide trike + town-colored halo)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         237       if (driver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         238         const colors = getTownColors(driverTown);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         267           .setLngLat([driver.lng, driver.lat])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         270         driverMarkerRef.current = marker;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         271         bounds.extend([driver.lng, driver.lat]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         305             console.error("[BookingMapClient] Directions API failed", res.status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         308           console.error("[BookingMapClient] Directions error", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         357       // ETA pickup: driver -> pickup
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         358       if (driver && pickup) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         363             `${driver.lng},${driver.lat};${pickup.lng},${pickup.lat}` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         377               "[BookingMapClient] Directions API (pickup) failed",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         382           console.error("[BookingMapClient] Directions error (pickup)", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         397       } else if (driver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         399           center: [driver.lng, driver.lat],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         412   }, [pickup, dropoff, driver, driverTown, booking, onEtaUpdate]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                          4 // into the `booking` object expected by BookingMapClient.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                          6 import BookingMapClient, { Booking } from "../BookingMapClient";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         38   let booking: Booking | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         40   // CASE 1: Parent already passes a full booking row
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         41   if (props?.booking && typeof props.booking.pickup_lat === "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         42     booking = props.booking as Booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         45     booking = props as Booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         47     // CASE 3: Parent sends { trip: bookingRow }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         48     booking = props.trip as Booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         50     // CASE 4: Parent sends { selected: bookingRow }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         51     booking = props.selected as Booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         65       booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         66         id: props.bookingId ?? props.id ?? "live-trip",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         67         booking_code: props.bookingCode ?? props.code ?? "LIVE-TRIP",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         78         driver_id: props.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         79         driver_lat: pickLat(props.driver),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         80         driver_lng: pickLng(props.driver),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         81         driver_status: props.driver_status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         82         driver_town: props.driver_town ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         87   // BookingMapClient is fully guarded; if booking is null/undefined
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\LiveTripMapClient.tsx                         89   return <BookingMapClient booking={booking ?? undefined} />;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                             3 const BookingMapClient = dynamic(() => import("./BookingMapClient"), {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                             8   bookingId?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            13   // NEW: assigned driver id (uuid)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            14   driverId?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            28   const bookingId = searchParams?.bookingId ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            29   const driverId = searchParams?.driverId ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            38       <BookingMapClient
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            39         bookingId={bookingId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.component.tsx                            44         driverId={driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                       2 import BookingMapClient from "./BookingMapClient";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      14   const bookingIdParam = searchParams?.bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      15   const bookingId =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      16     typeof bookingIdParam === "string" ? bookingIdParam : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      18   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      21         Missing bookingId in URL. Open this page via the dispatcher "View Map" link.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      29     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      31       "id, booking_code, pickup_lat, pickup_lng, dropoff_lat, dropoff_lng"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      33     .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      37     console.error("BOOKING_MAP_DB_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      40         Failed to load booking data for this map.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      47       <BookingMapClient
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      48         bookingId={data.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\page.tsx                                      49         bookingCode={data.booking_code ?? null}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 21  * Given a town string (from booking zone, pickup / dropoff address, or driver profile),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 43  * Small helper for driver pins - pass whatever you know about the driver:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 44  *  - driverTown (e.g. "Lagawe")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 45  *  - bookingZone (e.g. "JRide Banaue Zone 1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 50 export function getDriverTownColor(opts: {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 51   driverTown?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 52   bookingZone?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 56   const { driverTown, bookingZone, pickupAddress, dropoffAddress } = opts;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 58   if (driverTown) return getTownColorFromString(driverTown);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\townColors.ts                                 59   if (bookingZone) return getTownColorFromString(bookingZone);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\page.local-debug-backup.disabled.tsx               2 import BookingMapClient from "./map/BookingMapClient";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\page.local-debug-backup.disabled.tsx               9         <h1 className="text-lg font-semibold mb-2">Live Trips (Dispatch)</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\page.local-debug-backup.disabled.tsx              11           Local debug layout - booking list panel not wired yet. Focus here is
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\page.local-debug-backup.disabled.tsx              18         <BookingMapClient
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\page.local-debug-backup.disabled.tsx              19           bookingId={null}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                               9   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              11   assigned_driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              42           booking_code: item.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              44           assigned_driver_id: item.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              59   const handleStatusChanged = async (status: string, bookingId: string) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              62         trip.id === bookingId ? { ...trip, status } : trip
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              66         next = next.filter((trip) => trip.id !== bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              73   const handleDriverAssigned = async (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              74     driverId: string | null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              76     bookingId: string
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              80         trip.id === bookingId
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                              81           ? { ...trip, assigned_driver_id: driverId ?? trip.assigned_driver_id, status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             100         including hotline/manual bookings.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             112                 Booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             118                 Assigned Driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             132                   {trip.booking_code || trip.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             138                   {trip.assigned_driver_id || "-"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             142                     bookingId={trip.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             151                     bookingId={trip.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             152                     onAssigned={(driverId, status) =>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\status-test\page.tsx                             153                       handleDriverAssigned(driverId, status, trip.id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\health\page.tsx                                         21     j.bookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\health\page.tsx                                         78       const hasDriver = !!t.driver_id || !!t.driver_name || !!t.assigned_driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\health\page.tsx                                         80       if (status === "requested" && !hasDriver) unassigned++;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\health\page.tsx                                         89       if (truthyFlag(t.stuck) || truthyFlag(t.is_stuck) || truthyFlag(t.driver_stuck) || tr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\health\page.tsx                                        123         <Link href="/admin/ops/stuck-drivers" style={btn}>Open Stuck Drivers</Link>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                      17     j.bookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                      67 function getBookingLabel(t: AnyObj): string {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                      68   return String(t.booking_code || t.code || t.reference || t.id || t.booking_id || "").trim...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                      71 function hasDriver(t: AnyObj): boolean {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                      72   return !!(t.driver_id || t.assigned_driver_id || t.driver_name || t.driver?.id || t.drive...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     101   const label = getBookingLabel(t);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     110     { href: "/admin/ops/stuck-drivers", text: "Stuck Drivers" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     167         truthy(t.driver_stuck) ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     181       // Unassigned too long: requested + no driver + age >= threshold
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     182       if (st === "requested" && !hasDriver(t) && d) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     224               <th style={{ textAlign: "left", padding: "8px 6px", borderBottom: "1px solid ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     313         <div style={{ fontSize: 12, opacity: 0.7, marginTop: 4 }}>Flags: stuck/is_stuck/dri...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\incidents\page.tsx                                     319         <div style={{ fontSize: 12, opacity: 0.7, marginTop: 4 }}>status=requested, no driv...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\stuck-drivers\page.tsx                                   5 export default function StuckDriversPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\stuck-drivers\page.tsx                                   8       <h1 style={{ fontSize: 22, fontWeight: 800, margin: 0 }}>Stuck Drivers (Read-only)</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\ops\stuck-drivers\page.tsx                                  16           <li>Show stuck drivers list (GET-only)</li>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                           8   booking_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                           9   booking_code: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                          13   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                          14   driver_home_town: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                         144                 <th className="border-b px-2 py-2 text-left">Booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                         148                 <th className="border-b px-2 py-2 text-left">Driver home town</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                         166                     {row.booking_code || row.booking_id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\overrides\page.tsx                                         178                     {row.driver_home_town || "-"}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\page.tsx                                                    11         <li><Link className="underline" href="/admin/drivers">Manage Drivers (Online/Offlin...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    10   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    11   driver_name: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    57 export default function DriverPayoutsPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    70     // This query assumes driver_payout_requests has these columns:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    71     // id, driver_id, amount, status, requested_at, processed_at, payout_method, payout_ref
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    74       .from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                    75       .select("id,driver_id,amount,status,requested_at,processed_at,payout_method,payout_ref")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                   141     const { error } = await sb.rpc("driver_admin_approve_payout", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                   161         <h1 className="text-xl font-semibold">Driver Payouts</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                   172             <option value="rejected">rejected</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                   207               <th className="p-2 border-b">driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                   229                     <div className="font-medium">{r.driver_name ?? shortId(r.driver_id)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\page.tsx                                   230                     <div className="text-xs text-gray-500">{r.driver_id}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\reports\page.tsx                            68 export default function DriverPayoutReportsPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\reports\page.tsx                            86     return `/api/admin/driver-payouts/export?${qs.toString()}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\reports\page.tsx                            93       const data = await postJson("/api/admin/driver-payouts/auto-approve", { limit });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\reports\page.tsx                           107       <h1 style={{ fontSize: 22, fontWeight: 700, marginBottom: 16 }}>Driver Payout Reports...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\reports\page.tsx                           124             <option value="rejected">Rejected</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\payouts\drivers\reports\page.tsx                           184           URL: /admin/payouts/drivers/reports
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\page.tsx                                     10         Tracks every driver reassignment (dispute-safe).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                    9   booking_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   10   booking_code: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   11   from_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   12   to_driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   27   const [bookingCode, setBookingCode] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   28   const [fromDriver, setFromDriver] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   29   const [toDriver, setToDriver] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   41       if (bookingCode.trim()) qs.set("booking_code", bookingCode.trim());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   42       if (fromDriver.trim()) qs.set("from_driver_id", fromDriver.trim());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   43       if (toDriver.trim()) qs.set("to_driver_id", toDriver.trim());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   61     if (bookingCode.trim()) qs.set("booking_code", bookingCode.trim());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   62     if (fromDriver.trim()) qs.set("from_driver_id", fromDriver.trim());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   63     if (toDriver.trim()) qs.set("to_driver_id", toDriver.trim());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   81           <div style={{ fontSize: 12, opacity: 0.8 }}>Booking code</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   82           <input value={bookingCode} onChange={(e) => setBookingCode(e.target.value)} place...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   85           <div style={{ fontSize: 12, opacity: 0.8 }}>From driver (uuid)</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   86           <input value={fromDriver} onChange={(e) => setFromDriver(e.target.value)} placeho...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   89           <div style={{ fontSize: 12, opacity: 0.8 }}>To driver (uuid)</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                   90           <input value={toDriver} onChange={(e) => setToDriver(e.target.value)} placeholder...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                  113               <th style={{ padding: 8 }}>booking_code</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                  114               <th style={{ padding: 8 }}>from_driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                  115               <th style={{ padding: 8 }}>to_driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                  124                 <td style={{ padding: 8 }}>{r.booking_code || ""}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                  125                 <td style={{ padding: 8, fontFamily: "monospace" }}>{r.from_driver_id || ""...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reassign-audit\ui\ReassignAuditClient.tsx                  126                 <td style={{ padding: 8, fontFamily: "monospace" }}>{r.to_driver_id}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\driver-payout-requests\page.tsx                      5 export default function DriverPayoutRequestsReportPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\driver-payout-requests\page.tsx                     24   const presetRequests = `/admin/reports/lgu?tab=driver&view=requests`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\driver-payout-requests\page.tsx                     28       <h1 style={{ fontSize: 22, fontWeight: 800, margin: 0 }}>Driver Payout Requests (LGU ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\driver-payout-requests\page.tsx                     30         Read-only report launcher. Opens LGU export view with driver payout requests preset...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\driver-payout-requests\page.tsx                     37             <Link href={presetRequests} style={btn}>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\driver-payout-requests\page.tsx                     38               Open Driver Payout Requests (LGU)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        44 type Tab = "vendor" | "driver";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        46 type DriverView = "daily" | "requests";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        51   if (s === "driver") return "driver";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        60 function safeDriverView(v: any): DriverView | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        63   if (s === "requests") return "requests";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        68   // Accept YYYY-MM only
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        80   const [driverView, setDriverView] = useState<DriverView>("daily");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                        81   const [driverId, setDriverId] = useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       106     const pDriver = String(sp.get("driver_id") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       117     if (pTab === "driver") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       118       const dv = safeDriverView(pView);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       119       if (dv) setDriverView(dv);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       120       if (pDriver) setDriverId(pDriver);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       144         qs.set("view", driverView);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       146         if (driverView === "requests" && driverId) qs.set("driver_id", driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       147         url = "/api/admin/reports/lgu-driver?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       169   }, [tab, vendorView, vendorMonth, vendorId, driverView, driverId]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       191         : `LGU_DRIVER_${driverView.toUpperCase()}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       213       view: tab === "vendor" ? vendorView : driverView,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       215       driver_id: tab === "driver" ? (driverId || null) : null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       250         <button style={btn} onClick={() => setTab("driver")}>Driver</button>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       283             <button style={btn} onClick={() => setDriverView("daily")}>Daily</button>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       284             <button style={btn} onClick={() => setDriverView("requests")}>Payout Requests</...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       286             {driverView === "requests" ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       288                 <span style={{ fontSize: 12, opacity: 0.8 }}>Driver ID:</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       290                   value={driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\lgu\page.tsx                                       291                   onChange={(e) => setDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                               6   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                              24 export default function StuckDriversReportPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                              35       const res = await fetch(`/api/admin/reports/stuck-drivers?days=${d}`, { cache: "no-st...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                              61     return r.filter(x => (x.driver_id || "").toLowerCase().includes(qq));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                              68           <div className="text-lg font-semibold">Stuck Driver Scorecard</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                              70             Ranks drivers by stuck events and currently open stuck alerts.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                              78             placeholder="Search driver uuid..."
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                             109           <div key={r.driver_id} className="rounded border p-3">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                             110             <div className="text-xs text-slate-500">Driver</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                             111             <div className="break-all font-mono text-sm">{r.driver_id}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                             146               <th className="p-2">driver_id</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                             157               <tr key={r.driver_id} className="border-t">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\reports\stuck-drivers\page.tsx                             158                 <td className="p-2 font-mono break-all">{r.driver_id}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\page.tsx                                         9         Flags active trips whose driver location hasn’t updated for ≥ threshold.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                          7   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                          8   booking_uuid: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                          9   booking_code: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         77   async function autoReassign(bookingCode: string, rank: number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         78     const s = await post("/api/admin/reassign/suggest", { bookingCode });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         79     const target = s?.drivers?.[rank];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         80     if (!target?.driver_id) throw new Error("No suggested driver");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         82       bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         83       toDriverId: target.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                         95         Flags active trips whose driver location hasn&apos;t updated for ≥ threshold.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        147                   <div className="text-xs text-slate-500">Booking</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        148                   <div className="text-sm font-semibold">{r.booking_code || "-"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        156               <div className="mt-2 text-xs text-slate-500">Driver</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        157               <div className="font-mono text-sm break-all">{r.driver_id}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        162                   onClick={() => autoReassign(r.booking_code || "", 0)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        163                   disabled={!r.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        169                   onClick={() => autoReassign(r.booking_code || "", 1)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        170                   disabled={!r.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        202               <th className="p-2">booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        204               <th className="p-2">driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        217                   <td className="p-2 font-semibold">{r.booking_code || "-"}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        219                   <td className="p-2 font-mono break-all">{r.driver_id}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        223                     <button className="rounded bg-emerald-600 px-3 py-2 text-xs font-semibo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\stuck-trips\ui\StuckTripsClient.tsx                        226                     <button className="rounded bg-emerald-700 px-3 py-2 text-xs font-semibo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\towns\page.tsx                                              19     const { data, error } = await supabase.rpc("list_dispatch_towns");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                       9   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      10   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      21   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      22   driver_name?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      23   driver_phone?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      67   const candidates = [j.trips, j.bookings, j.data, Array.isArray(j) ? j : null];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      91 function pickBookingCode(t: TripRow): string {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      92   const v = t.booking_code ?? (t as any).bookingCode ?? (t as any).code ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                      97   const v = t.uuid ?? t.id ?? t.booking_id ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     193       const code = pickBookingCode(t);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     214         String(t.driver_name || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     215         String(t.driver_phone || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     216         String(t.driver_id || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     377             placeholder="booking_code, driver, town, reason..."
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     401               {["sla", "mins", "to_breach", "status", "reason", "booking_code", "trip_id", ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     422                 ? `/admin/livetrips?booking_code=${encodeURIComponent(code)}`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     425               const driverLabel =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     426                 (t.driver_name ? String(t.driver_name) : "") ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     427                 (t.driver_phone ? String(t.driver_phone) : "") ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     428                 (t.driver_id ? String(t.driver_id) : "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     464                     {code ? <button style={miniBtn} onClick={() => copyText("booking_code",...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     473                     {driverLabel || "(unassigned)"}{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\trips\at-risk\page.tsx                                     474                     {t.driver_id ? <button style={miniBtn} onClick={() => copyText("driver_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\users\users-manager.tsx                                      4 type Row = { email: string; role: "admin" | "dispatcher" | "user"; updated_at: string };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\users\users-manager.tsx                                     11   const [role, setRole] = React.useState<"admin" | "dispatcher" | "user">("dispatcher");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\users\users-manager.tsx                                     49       setRole("dispatcher");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\users\users-manager.tsx                                     97               <option value="dispatcher">dispatcher</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendor-payouts\page.tsx                                    213             Locked rule: this action updates vendor_payout_requests only. No vendor wallet ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       17   reject_reason?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       30       .in("status", ["pending", "pre_approved_dispatcher"])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       72   const reject = async (id: number) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       81         ? window.prompt("Reason for rejection:")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       88         status: "rejected",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       89         reject_reason: reason,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       94       console.error("admin reject error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                       95       alert(`Error rejecting passenger: ${error.message}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                      143                 onClick={() => reject(r.id)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\verification\page.tsx                                      145                 Reject
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\_diag\auth-env\route.ts                                        7     // NEW names (these are the only ones we will accept)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\active-trips\route.ts                                   10     .from('dispatch_rides_v1')
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\active-trips\route.ts                                   12     .order('driver_updated_at', { ascending: false });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 10     const bookingId = (url.searchParams.get("bookingId") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 11     const bookingCode = (url.searchParams.get("bookingCode") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 13     if (!bookingId && !bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 18       .from("booking_assignment_log")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 19       .select("id, created_at, booking_id, booking_code, from_driver_id, to_driver_id, sour...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 23     if (bookingId) q = q.eq("booking_id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                                 24     else q = q.eq("booking_code", bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                          15   const bookingCode = searchParams.get("bookingCode");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                          17   if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                          19       { ok: false, code: "MISSING_BOOKING", message: "bookingCode required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                          25     .from("dispatch_assign_audit")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                          27     .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                     9 const MAX_DRIVERS = 8;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    11 type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    18 type DriverLocation = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    19   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    40   drivers: DriverLocation[]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    41 ): Promise<{ driver_id: string; duration: number }[]> {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    42   if (!drivers.length) return [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    46     ...drivers.map((d) => `${d.lng},${d.lat}`),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    50   const destinationsIndex = drivers.length; // last coord is pickup
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    52   const url = `https://api.mapbox.com/directions-matrix/v1/mapbox/driving/${allCoords}?sour...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    68   return drivers.map((driver, idx) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    72       driver_id: driver.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    81     const { booking_id } = body as { booking_id: string };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    83     if (!booking_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    85         { success: false, error: "Missing booking_id" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    92     // 1) Load booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    93     const { data: booking, error: bookingError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    94       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    95       .select("id, pickup_lat, pickup_lng, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    96       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    97       .single<Booking>();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    99     if (bookingError || !booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   100       console.error("AUTO_ASSIGN_BOOKING_ERROR", bookingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   102         { success: false, error: "Booking not found" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   108       booking.pickup_lat == null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   109       booking.pickup_lng == null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   112         { success: false, error: "Booking missing pickup coordinates" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   117     // 2) Get online drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   118     const { data: driverLocs, error: driverError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   119       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   120       .select("driver_id, lat, lng, is_online")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   123     if (driverError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   124       console.error("AUTO_ASSIGN_DRIVER_LOC_ERROR", driverError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   126         { success: false, error: "Failed to load driver locations" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   131     const drivers: DriverLocation[] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   132       (driverLocs || [])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   135           driver_id: d.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   140     if (!drivers.length) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   142         { success: false, error: "No online drivers available" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   148     const withDist = drivers.map((d) => ({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   150       km: haversineKm(booking.pickup_lat, booking.pickup_lng, d.lat, d.lng),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   155     const candidates = withDist.slice(0, MAX_DRIVERS);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   159       { lat: booking.pickup_lat, lng: booking.pickup_lng },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   164       driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   169       { driver_id: null, duration: Number.MAX_SAFE_INTEGER }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   172     if (!best.driver_id || !Number.isFinite(best.duration)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   174         { success: false, error: "Could not determine best driver" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   181       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   183         assigned_driver_id: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   187       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   188       .select("id, booking_code, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   194         { success: false, error: "Failed to assign driver" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   202         booking: updated,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   203         chosen_driver_id: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  27 async function finalizeTripSafe(input: { bookingCode?: string; bookingId?: string }) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  30   const code = (input.bookingCode || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  31   const id = (input.bookingId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  36     attempts.push({ booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  37     attempts.push({ p_booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  38     attempts.push({ in_booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  39     attempts.push({ _booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  41     attempts.push({ bookingCode: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  44     attempts.push({ booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  45     attempts.push({ p_booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  46     attempts.push({ in_booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  47     attempts.push({ _booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  49     attempts.push({ bookingId: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  67     const bookingCode = (body?.bookingCode as string | undefined) || undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  68     const bookingId = (body?.bookingId as string | undefined) || undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  70     if (!bookingCode && !bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  71       return bad("MISSING_IDENTIFIER", "bookingCode (or bookingId) is required", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  74     console.log("COMPLETE_TRIP_API_START", { bookingCode: bookingCode || null, bookingId: b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  76     const res = await finalizeTripSafe({ bookingCode, bookingId });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                  82         "Finalize RPC failed. This route does not directly update bookings.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                12     const bookingId: string | undefined = body.bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                16     if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                17       return NextResponse.json({ error: "Missing bookingId" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                33     let driverId: string | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                38         "select_next_available_driver",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                45         driverId = (data as string | null) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                49     // Update booking (DB trigger enforces wallet lock)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                51       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                54         assigned_driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                56       .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                65           { error: "wallet_locked", message: msg, driverId },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                                73     return NextResponse.json({ success: true, driverId });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                                 15   const bookingCode = searchParams.get("bookingCode");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                                 17   if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                                 19       { ok: false, code: "MISSING_BOOKING", message: "bookingCode required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                                 25     .from("dispatch_assign_audit")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                                 27     .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                              10   const { bookingId } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                              12   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                              14       { error: "Missing bookingId" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                              20     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                              22     .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                            10   const { bookingId } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                            12   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                            14       { error: "Missing bookingId" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                            20     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                            22     .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                            10   const { bookingId } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                            12   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                            14       { error: "Missing bookingId" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                            20     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                            22     .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               30     // 1) table/view: driver_locations
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               31     // 2) fallback: drivers (if you store latest coords there)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               35       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               43         .from("drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               52           { ok: false, error: msg, drivers: [], driver_locations: [], data: [] },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               59       { ok: true, drivers: rows, driver_locations: rows, data: rows },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                               64       { ok: false, error: e?.message || String(e), drivers: [], driver_locations: [], data:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                                1 // app/api/admin/driver-locations/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                                2 // Admin view of driver_locations table in Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               23 // GET /api/admin/driver-locations?status=online (status optional)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               30     let url = `${supabaseUrl}/rest/v1/driver_locations?select=*`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               44       console.error("Supabase driver_locations GET error:", data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               49           message: "Failed to load driver_locations from Supabase",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               64     console.error("driver-locations unexpected error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               68         error: "DRIVER_LOCATIONS_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                               69         message: "Unexpected error while fetching driver locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                    21     // If your function is public.admin_auto_approve_driver_payouts(limit int) return json,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                    22     const { data, error } = await sb.rpc("admin_auto_approve_driver_payouts", { p_limit: li...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                           5   if (!rows.length) return "id,driver_id,amount,status,requested_at,processed_at,processed_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                           6   const cols = ["id","driver_id","amount","status","requested_at","processed_at","processed...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                          24   let q = sb.from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                          25     .select("id,driver_id,amount,status,requested_at,processed_at,processed_by,admin_note")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                          41       "Content-Disposition": `attachment; filename="driver_payouts_export.csv"`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                 21   qs.set("select", "id,driver_id,amount,status,requested_at,processed_at,payout_method,payo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                 25   const url = SUPABASE_URL + "/rest/v1/driver_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                 48   qs.set("select", "id,driver_id,amount,status,requested_at,processed_at,payout_method,payo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                 50   const url = SUPABASE_URL + "/rest/v1/driver_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                 81     qs.set("select", "id,driver_id,amount,status,requested_at,processed_at,payout_method,pa...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                 86     const restUrl = SUPABASE_URL + "/rest/v1/driver_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                103   action?: "approve" | "reject" | "mark_paid" | string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                133     else if (action === "reject") targetStatus = "rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                135     else return jsonErr("BAD_REQUEST", "Invalid action (approve|reject|mark_paid)", 400, { ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                                141     if ((targetStatus === "approved" || targetStatus === "rejected") && currentStatus !== "...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                         4   // Temporary stub: no separate drivers table in prod yet.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                         5   // Dispatch UI will fall back to showing assigned_driver_id codes.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                         8       drivers: [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                        11     console.error("DRIVERS_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                        14         error: "DRIVERS_UNEXPECTED_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                        15         message: err?.message ?? "Unexpected error while loading drivers.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  12  * Admin / Dispatcher fare override & verification endpoint.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  16  *   "bookingCode": "JR-2025-0002",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  18  *   "adminId": "dispatcher-richelle",  // optional
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  26     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  31     if (!bookingCode || typeof verifiedFare !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  39       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  46       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  58     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                               4 type ActionName = "NUDGE_DRIVER" | "REASSIGN_DRIVER" | "AUTO_ASSIGN" | "ARCHIVE_TEST_TRIPS";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              42   const booking_code = body?.booking_code ? String(body.booking_code) : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              45   if (!action || !["NUDGE_DRIVER", "REASSIGN_DRIVER", "AUTO_ASSIGN", "ARCHIVE_TEST_TRIPS"]....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              48   if (!booking_code && !trip_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              52   // Load booking row (schema-safe: we inspect returned keys)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              53   const bookingQuery = supabase.from("bookings").select("*").limit(1);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              54   const bookingRes = booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              55     ? await bookingQuery.eq("booking_code", booking_code).maybeSingle()
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              56     : await bookingQuery.eq("id", trip_id).maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              58   if (bookingRes.error) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              59     return NextResponse.json({ ok: false, code: "BOOKING_LOAD_ERROR", error: bookingRes.err...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              61   const b = bookingRes.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              63     return NextResponse.json({ ok: false, code: "BOOKING_NOT_FOUND", booking_code, trip_id ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              83       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              85       .ilike("booking_code", "TEST-%")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              98 if (action === "NUDGE_DRIVER") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                              99     // Non-destructive: just bump updated_at so stale watchers can clear when driver is act...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             100     return NextResponse.json({ ok: true, action, booking_code: b.booking_code ?? booking_co...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             103   if (action === "REASSIGN_DRIVER") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             104     // Clear driver link + reset status to assigned
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             105     if (can("assigned_driver_id")) patch.assigned_driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             106     if (can("driver_id")) patch.driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             110     const upd = await supabase.from("bookings").update(patch).eq("id", b.id).select("*").ma...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             114     return NextResponse.json({ ok: true, action, booking_code: upd.data?.booking_code ?? b....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             124     // Load driver locations (we do best-effort column usage)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             125     const dl = await supabase.from("driver_locations").select("*").limit(500);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             127       return NextResponse.json({ ok: false, code: "DRIVER_LOCATIONS_ERROR", error: dl.error...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             135       const did = r?.driver_id ?? r?.id ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             136       const rlat = num(r?.lat) ?? num(r?.latitude) ?? num(r?.driver_lat) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             137       const rlng = num(r?.lng) ?? num(r?.longitude) ?? num(r?.driver_lng) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             143         best = { driver_id: did, lat: rlat, lng: rlng };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             148       return NextResponse.json({ ok: false, code: "NO_DRIVER_CANDIDATES" }, { status: 404 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             152     if (can("assigned_driver_id")) patch.assigned_driver_id = best.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             153     else if (can("driver_id")) patch.driver_id = best.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             158     const upd = await supabase.from("bookings").update(patch).eq("id", b.id).select("*").ma...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             166       booking_code: upd.data?.booking_code ?? b.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             167       assigned_driver_id: upd.data?.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             168       driver_id: upd.data?.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             169       booking: upd.data,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    183 async function schemaSafeUpdateBooking(admin: any, id: string, initial: Record<string, any>) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    187     const res = await admin.from("bookings").update(payload).eq("id", id).select("id").sing...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    192     const m = msg.match(/Could not find the '([^']+)' column of 'bookings' in the schema ca...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    222   // Only touch active bookings (donâ€™t mutate completed/cancelled history)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    229     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    323     const upd = await schemaSafeUpdateBooking(admin, id, patch);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                           6 type BookingRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                           8   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          10   assigned_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          20 type DriverLocationRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          21   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          31     const bookingId = req.nextUrl.searchParams.get("bookingId");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          33     if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          36           error: "MISSING_BOOKING_ID",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          37           message: "bookingId is required.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          45     // 1) Load the booking with all fields we care about
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          46     const { data: booking, error: bookingError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          47       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          51         booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          53         assigned_driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          63       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          66     if (bookingError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          67       console.error("BOOKING_MAP_DB_ERROR_BOOKING", bookingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          70           error: "BOOKING_MAP_DB_ERROR_BOOKING",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          71           message: bookingError.message,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          77     if (!booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          80           error: "BOOKING_NOT_FOUND",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          81           message: "Booking not found.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          87     const bookingRow = booking as BookingRow;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          89     // 2) Load assigned driver location if present
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          90     let driverLocation: DriverLocationRow | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          92     if (bookingRow.assigned_driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          93       const { data: driverRow, error: driverError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          94         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          95         .select("driver_id, lat, lng, status, town, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          96         .eq("driver_id", bookingRow.assigned_driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                          99       if (driverError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         100         console.error("BOOKING_MAP_DB_ERROR_DRIVER", driverError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         102       } else if (driverRow) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         103         driverLocation = driverRow as DriverLocationRow;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         109         booking: bookingRow,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         110         driverLocation,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         115     console.error("BOOKING_MAP_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         118         error: "BOOKING_MAP_UNEXPECTED_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         119         message: err?.message ?? "Unexpected error while loading booking map.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                      7   driverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     14   fromDriverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     15   toDriverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     42       const { data, error } = await supabase.rpc("admin_nudge_driver", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     44         p_driver_id: body.driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     49         console.error("admin_nudge_driver error:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     51           { error: error.message || "Failed to nudge driver." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     57         { message: "Nudge sent to driver.", data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     65         p_from_driver_id: body.fromDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                     66         p_to_driver_id: body.toDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                    114     console.error("Dispatch actions API fatal error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                    116       { error: "Unexpected error processing dispatch action." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                         5   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                         6   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        21   const booking_code = norm(body.booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        22   const driver_id = norm(body.driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        24   if (!booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        25     return NextResponse.json({ ok: false, code: "MISSING_BOOKING_CODE", message: "Missing b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        27   if (!driver_id || !isUuid(driver_id)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        28     return NextResponse.json({ ok: false, code: "MISSING_DRIVER_ID", message: "Missing/inva...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        31   const br = await supabase.from("bookings").select("*").eq("booking_code", booking_code).m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        34       { ok: false, code: "BOOKING_NOT_FOUND", message: br.error?.message || "Booking not fo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        45       { ok: false, code: "NOT_ASSIGNABLE", message: "Booking is not assignable: " + status,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        50   // avoid overwriting active driver assignment unless it is still requested
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        51   const alreadyHasDriver = !!b.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        52   if (alreadyHasDriver && status && status !== "requested") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        54       { ok: false, code: "ALREADY_ASSIGNED", message: "Booking already has driver and is no...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        60     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        61     .update({ driver_id, status: "assigned" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        68       { ok: false, code: "UPDATE_FAILED", message: upd.error.message, booking_code, driver_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        76     booking_id: String(b.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        77     booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        78     driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                        80     booking: upd.data ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                            66     const t2 = (payload as any).bookings;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           102         .map((t: any) => pick(t, ["booking_code", "bookingCode", "code"]))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           109         .map((t: any) => pick(t, ["id", "uuid", "booking_id", "bookingId"]))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           118         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           129           const bcode = b?.booking_code != null ? String(b.booking_code) : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           136             booking_id: bid || null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           137             booking_code: bcode || null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                           141             driver_id: b?.driver_id ?? (b as any)?.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                              22     // Get bookings with status 'pending' or 'searching' and no assigned driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                              24       "status=in.(pending,searching,arrived)&assigned_driver_id=is.null&order=created_at.asc";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                              25     const url = `${SUPABASE_URL}/rest/v1/bookings?${query}&select=id,booking_code,status,as...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                              66     const bookings = Array.isArray(json) ? json : [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                              71         bookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                         12   // Cancel broken live trips (missing booking_code)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                         15     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                         18     .or("booking_code.is.null,booking_code.eq.")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                         19     .select("id, booking_code, status");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                         45         criteria: { statusIn: ["assigned", "on_the_way", "on_trip"], booking_code_missing: ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                       9  * Returns live trips for the dispatch UI from `dispatch_rides_view`.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                      16       .from("dispatch_rides_view")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                      34         bookings: data ?? [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              28       "id,booking_code,status,assigned_driver_id,created_at,pickup_lat,pickup_lng";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              30     // Pending: pending / searching with no assigned driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              34       "assigned_driver_id=is.null",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              37     const pendingUrl = `${SUPABASE_URL}/rest/v1/bookings?${pendingQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              41       "assigned,driver_accepted,driver_arrived,passenger_onboard,in_transit,dropoff";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              47     const activeUrl = `${SUPABASE_URL}/rest/v1/bookings?${activeQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              58     const completedUrl = `${SUPABASE_URL}/rest/v1/bookings?${completedQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              60     // Drivers for map
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              61     const driverSelect = "driver_id,lat,lng,status,updated_at";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              62     const driverQuery = [
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              63       `select=${driverSelect}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              66     const driversUrl = `${SUPABASE_URL}/rest/v1/driver_locations?${driverQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              68     const [pendingRes, activeRes, completedRes, driversRes] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              73         fetch(driversUrl, { headers: baseHeaders, cache: "no-store" }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              76     const [pendingRaw, activeRaw, completedRaw, driversRaw] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                              81         driversRes.text(),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             127     if (!driversRes.ok) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             129         "[admin/livetrips/summary] Drivers error:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             130         driversRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             131         driversRaw
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             142     const drivers = driversRes.ok
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             143       ? parseJsonArray(driversRaw, "drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                             152         drivers,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        12   "driver_accepted",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        13   "driver_arrived",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        34     const bookingId: string | undefined = body?.bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        37     if (!bookingId || !nextStatus) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        41           message: "bookingId and nextStatus are required",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        57     const url = `${SUPABASE_URL}/rest/v1/bookings?id=eq.${encodeURIComponent(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                        58       bookingId
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                       106       { ok: true, booking: updatedRow },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  10     const { booking_id, driver_id } = body as {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  11       booking_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  12       driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  15     if (!booking_id || !driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  17         { success: false, error: "Missing booking_id or driver_id" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  25       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  27         assigned_driver_id: driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  31       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  32       .select("id, booking_code, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                  44       { success: true, booking: data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                                 20     const { data, error } = await supabase.rpc("admin_reject_payout_v1", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       41     const bookingCode = String(body?.bookingCode || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       42     const toDriverId = String(body?.toDriverId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       46     if (!bookingCode) return NextResponse.json({ error: "bookingCode required" }, { status:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       47     if (!toDriverId) return NextResponse.json({ error: "toDriverId required" }, { status: 4...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       52     // resolve booking id by code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       54       `/rest/v1/bookings?select=id&booking_code=eq.${encodeURIComponent(bookingCode)}&limit=1`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       56     const bookingId = b?.[0]?.id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       57     if (!bookingId) return NextResponse.json({ error: `booking not found: ${bookingCode}` }...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       60     const result = await sbPOST(url, srk, `/rest/v1/rpc/admin_reassign_driver`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       61       p_booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                       62       p_to_driver_id: toDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               35     const bookingCode = String(body?.bookingCode || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               36     if (!bookingCode) return NextResponse.json({ error: "bookingCode required" }, { status:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               41     // Booking info (your schema uses from_label/to_label + pickup_lat/lng)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               42     const bookings = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               43       `/rest/v1/bookings?select=id,booking_code,status,assigned_driver_id,driver_id,pickup_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               45     const b = bookings?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               46     if (!b?.id) return NextResponse.json({ error: `booking not found: ${bookingCode}` }, { ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               48     const currentDriver = b.assigned_driver_id || b.driver_id || null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               53       return NextResponse.json({ error: "booking pickup_lat/pickup_lng missing" }, { status...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               56     // Driver live locations:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               57     // We use mv_driver_live if available, else driver_locations
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               58     // Try mv_driver_live first
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               59     let drivers: any[] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               61       drivers = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               62         `/rest/v1/mv_driver_live?select=driver_id,lat,lng,updated_at,status&limit=2000`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               65       drivers = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               66         `/rest/v1/driver_locations?select=driver_id,lat,lng,updated_at&limit=2000`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               70     // Busy drivers = drivers assigned to any active booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               71     const busyBookings = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               72       `/rest/v1/bookings?select=assigned_driver_id,driver_id,status&id=neq.${encodeURICompo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               75     for (const x of busyBookings || []) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               76       const d = x.assigned_driver_id || x.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               80     const out = (drivers || [])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               82         const driverId = String(d.driver_id || d.id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               85         if (!driverId || !Number.isFinite(lat) || !Number.isFinite(lng)) return null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               86         if (currentDriver && driverId === String(currentDriver)) return null; // exclude cu...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               87         if (busySet.has(driverId)) return null; // exclude busy
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               90           driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                              100       booking: { id: b.id, booking_code: b.booking_code, status: b.status, current_driver: ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                              101       drivers: out,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                              102       excluded_current_driver: currentDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          32     const bookingCode = u.searchParams.get("booking_code");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          33     const fromDriver = u.searchParams.get("from_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          34     const toDriver = u.searchParams.get("to_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          43     if (bookingCode) filters.push(`booking_code=ilike.*${encodeURIComponent(bookingCode)}*`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          44     if (fromDriver)  filters.push(`from_driver_id=eq.${encodeURIComponent(fromDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          45     if (toDriver)    filters.push(`to_driver_id=eq.${encodeURIComponent(toDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          52       `/rest/v1/admin_reassign_audit?select=id,created_at,created_by,booking_id,booking_cod...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          55     const header = ["id","created_at","created_by","booking_id","booking_code","from_driver...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          63         csvEscape(r.booking_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          64         csvEscape(r.booking_code),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          65         csvEscape(r.from_driver_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                          66         csvEscape(r.to_driver_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 26     const bookingCode = u.searchParams.get("booking_code");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 27     const fromDriver = u.searchParams.get("from_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 28     const toDriver = u.searchParams.get("to_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 38     if (bookingCode) filters.push(`booking_code=ilike.*${encodeURIComponent(bookingCode)}*`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 39     if (fromDriver)  filters.push(`from_driver_id=eq.${encodeURIComponent(fromDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 40     if (toDriver)    filters.push(`to_driver_id=eq.${encodeURIComponent(toDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                                 46       `/rest/v1/admin_reassign_audit?select=id,created_at,created_by,booking_id,booking_cod...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               35     const bookingId = u.searchParams.get("bookingId");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               36     const bookingCode = u.searchParams.get("bookingCode");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               42     const bookingSelect = "id,booking_code,pickup_lat,pickup_lng,assigned_driver_id,status";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               44     let booking: any = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               46     if (bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               49         `/rest/v1/bookings?select=${bookingSelect}&limit=1&id=eq.${encodeURIComponent(booki...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               51       booking = rows?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               52     } else if (bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               55         `/rest/v1/bookings?select=${bookingSelect}&limit=1&booking_code=eq.${encodeURICompo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               57       booking = rows?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               59       return NextResponse.json({ error: "Provide bookingId or bookingCode" }, { status: 400...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               62     if (!booking) return NextResponse.json({ error: "Booking not found" }, { status: 404 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               64     const pickLat = Number(booking.pickup_lat);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               65     const pickLng = Number(booking.pickup_lng);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               66     const currentDriver = String(booking.assigned_driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               74       `/rest/v1/driver_locations?select=driver_id,lat,lng,updated_at&order=updated_at.desc&...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               81       const did = String(r.driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               84       // ✅ Exclude the currently assigned driver from suggestions
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               85       if (currentDriver && did === currentDriver) continue;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                               96         driver_id: did,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                              109       booking: {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                              110         id: booking.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                              111         booking_code: booking.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                              114         assigned_driver_id: booking.assigned_driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                              115         status: booking.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          38 function expectedDriverPayout(b: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          39   const dp = n(b?.driver_payout);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          51     message: "POST { mode: 'dry_run'|'apply' } to backfill missing driver credits (expected...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          76     // Pull completed bookings with fields needed to compute expected payout
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          77     const { data: bookings, error: bErr } = await admin
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          78       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          79       .select("id,booking_code,status,driver_id,driver_payout,verified_fare,company_cut")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          84     if (bErr) return json(500, { ok: false, code: "DB_ERROR", stage: "bookings", message: b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          86     const completed = bookings || [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          92     let skipped_no_driver = 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          96       if (!b.driver_id) { skipped_no_driver++; continue; }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          98       const expected = expectedDriverPayout(b);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         101       // Does a credit-like tx already exist for this booking?
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         103         .from("driver_wallet_transactions")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         105         .eq("booking_id", b.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         109         actions.push({ booking_id: b.id, booking_code: b.booking_code, status: "error_tx_lo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         118         .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         120         .eq("driver_id", b.driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         125         actions.push({ booking_id: b.id, booking_code: b.booking_code, status: "error_balan...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         133         booking_id: b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         134         booking_code: b.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         135         driver_id: b.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         139         reason: "reconcile_backfill " + s(b.booking_code || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         148       const { error: insErr } = await admin.from("driver_wallet_transactions").insert({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         149         driver_id: b.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         150         booking_id: b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         173         skipped_no_driver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              52     const { data: bookings, error: bErr } = await admin
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              53       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              54       .select("id,booking_code,status,service_type,vendor_status,driver_id,vendor_id,update...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              59     if (bErr) return json(500, { ok: false, code: "DB_ERROR", stage: "bookings", message: b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              61     const completed = bookings || [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              63     const completedCodes = completed.map((x: any) => x.booking_code).filter(Boolean);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              65     const { data: driverTx, error: dErr } = await admin
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              66       .from("driver_wallet_transactions")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              67       .select("id,driver_id,amount,reason,booking_id,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              68       .in("booking_id", completedIds.length ? completedIds : ["00000000-0000-0000-0000-0000...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              72     if (dErr) return json(500, { ok: false, code: "DB_ERROR", stage: "driver_wallet_transac...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              76       .select("id,vendor_id,booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              77       .in("booking_code", completedCodes.length ? completedCodes : ["__none__"])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              84       .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              85       .select("driver_id,balance,last_tx_at,tx_count")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              90     if (dBalErr) return json(500, { ok: false, code: "DB_ERROR", stage: "driver_wallet_bala...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             103     // Map booking_id -> credit-like driver tx
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             104     const creditTxByBooking: Record<string, any[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             105     for (const t of driverTx || []) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             106       const bid = s((t as any).booking_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             109       if (!creditTxByBooking[bid]) creditTxByBooking[bid] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             110       creditTxByBooking[bid].push(t);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             114     // 1) driver_payout (if > 0)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             116     function expectedDriverPayout(b: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             117       const dp = n(b?.driver_payout);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             125     const missing_driver_credits = completed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             126       .filter((b: any) => !!b.driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             127       .map((b: any) => ({ b, expected: expectedDriverPayout(b) }))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             131         return !creditTxByBooking[bid] || creditTxByBooking[bid].length === 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             134         booking_id: x.b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             135         booking_code: x.b.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             136         driver_id: x.b.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             138         expected_driver_payout: x.expected,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             143     const duplicate_driver_credits = Object.keys(creditTxByBooking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             144       .filter((bid) => (creditTxByBooking[bid]?.length || 0) > 1)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             146         booking_id: bid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             147         count: creditTxByBooking[bid].length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             148         tx: creditTxByBooking[bid].slice(0, 5),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             155       const code = s((t as any).booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             165       !!b.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             170         const code = s(b.booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             175         booking_code: b.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             176         booking_id: b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             190         booking_code: x.code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             199       driver_tx_seen: (driverTx || []).length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             203       missing_driver_credits_count: missing_driver_credits.length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             204       duplicate_driver_credit_tx_count: duplicate_driver_credits.length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             209       negative_driver_balances_count: (dBal || []).length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             216       missing_driver_credits,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             217       duplicate_driver_credits,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             220       negative_driver_balances: dBal || [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             222       note: "Driver missing/duplicate now based on expected payout > 0 and credit-like tx o...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             16     const driverId = s(url.searchParams.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             23       view === "requests"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             24         ? "admin_driver_payout_requests_v1"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             25         : "admin_driver_payout_daily_v1";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             27     // We use select=* and best-effort filtering on driver_id (if exists).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             28     // If the view doesn't contain driver_id, Supabase REST will error.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             29     // To avoid breaking, we only apply driver_id filter when caller provided it AND view l...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             30     // For requests view, driver_id is expected. For daily view, it is likely but not assum...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             38     if (driverId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             39       // Only apply on requests view (safe expectation for payouts request rows).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             40       if (source === "admin_driver_payout_requests_v1") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                             41         qs.set("driver_id", "eq." + driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\stuck-drivers\route.ts                          30     `${url.replace(/\/$/, "")}/rest/v1/admin_stuck_driver_scorecard_v1` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\stuck-drivers\route.ts                          31     `?select=driver_id,stuck_24h,stuck_7d,stuck_30d,open_count,avg_minutes,last_detected_at` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\ack\route.ts                                41       `/rest/v1/driver_stuck_alert_log?id=eq.${encodeURIComponent(String(logId))}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    35       `/rest/v1/driver_stuck_alert_log?select=id,driver_id,first_detected_at,last_detected_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    55       let booking: any = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    57       if (l.booking_uuid) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    60           `/rest/v1/bookings?select=id,booking_code,status,assigned_driver_id,pickup_lat,pi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    62         booking = b?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    63       } else if (l.booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    66           `/rest/v1/bookings?select=id,booking_code,status,assigned_driver_id,pickup_lat,pi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    68         booking = b?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    72       if (l.driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    75           `/rest/v1/driver_locations?select=driver_id,updated_at&limit=1&driver_id=eq.${enc...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    82         driver_id: l.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    83         booking_id: booking?.id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    84         booking_code: booking?.booking_code ?? l.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    85         status: booking?.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                    86         current_driver: booking?.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\snooze\route.ts                             48       `/rest/v1/driver_stuck_alert_log?id=eq.${encodeURIComponent(String(logId))}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             10     const { booking_id, status } = body as {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             11       booking_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             15     if (!booking_id || !status) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             17         { success: false, error: "Missing booking_id or status" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             30       updates.assigned_driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             34       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             36       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             37       .select("id, booking_code, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                             51       { success: true, booking: data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                     27   if (!["admin","dispatcher","user"].includes(newRole)) return NextResponse.json({ error: "...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                                 25   const url = SUPABASE_URL + "/rest/v1/vendor_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                                 45   const url = SUPABASE_URL + "/rest/v1/vendor_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                                 81     const restUrl = SUPABASE_URL + "/rest/v1/vendor_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                            75 async function fetchBalanceSafe(kind: "driver" | "vendor", id: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                            76   const rpcName = kind === "driver"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                            77     ? "admin_get_driver_wallet_balance_v1"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                            81     kind === "driver"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                            82       ? [{ driver_id: id }, { p_driver_id: id }, { in_driver_id: id }, { _driver_id: id }]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                           100     const kind = kindRaw === "driver" || kindRaw === "vendor" ? kindRaw : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                           107     const table = kind === "driver" ? "driver_wallet_transactions" : "vendor_wallet_transac...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                           108     const key = kind === "driver" ? "driver_id" : "vendor_id";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\propose\route.ts                                      7     { ok: false, error: "Bookings propose API is disabled in this build." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                      8   return NextResponse.json({ ok: true, route: "/api/bookings/respond" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                     15     // TODO: implement your booking response logic here (e.g., Supabase update)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                     18     //   await supabase.from("bookings").update({ status: action }).eq("id", id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\route.ts                                              1 // app/api/bookings/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\route.ts                                              7   // check session first — this shows dispatcher-only behavior later
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\route.ts                                             20     message: "bookings endpoint stub",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\debug\supabase\route.ts                                       13       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\debug\supabase\route.ts                                       14       .select("id, driver_id, lat, lng, status, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                       5   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                       6   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      35 async function fetchBookingByIdOrCode(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      37   booking_id?: string | null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      38   booking_code?: string | null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      40   if (booking_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      41     const r = await supabase.from("bookings").select("*").eq("id", booking_id).maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      44   if (booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      45     const r = await supabase.from("bookings").select("*").eq("booking_code", booking_code)....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      48   return { data: null, error: "Missing booking_id or booking_code" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      51 async function bestEffortUpdateBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      53   bookingId: string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      56   const r = await supabase.from("bookings").update(patch).eq("id", bookingId).select("*").m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      61 async function fetchBusyDriverIdsInTown(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      65   // NOTE: we only need driver_id + status; keep select minimal but safe.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      67     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      68     .select("driver_id,status,town")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      71     .not("driver_id", "is", null)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      82     const id = row && row.driver_id ? String(row.driver_id) : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      86   return { ok: true, note: "busy drivers in town: " + busy.size, busy };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      89 async function findNearestOnlineFreeDriverInTown(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      95   const busyRes = await fetchBusyDriverIdsInTown(supabase, town);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      99     .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     106     return { driver_id: null as string | null, note: "driver_locations query failed: " + r....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     110   let best: { driver_id: string; km: number } | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     115     const dId = row.driver_id ? String(row.driver_id) : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     128     if (!best || km < best.km) best = { driver_id: dId, km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     132     let note = "No eligible ONLINE free drivers in town (online_rows=" + rows.length + ", c...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     134     return { driver_id: null as string | null, note };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     137   let note = "Nearest ONLINE free driver selected (km=" + best.km.toFixed(3) + ").";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     139   return { driver_id: best.driver_id, note };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     146   const bookingRes = await fetchBookingByIdOrCode(supabase, body.booking_id ?? null, body.b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     147   if (!bookingRes.data) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     149       { ok: false, code: "BOOKING_NOT_FOUND", message: bookingRes.error || "Booking not fou...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     154   const booking: any = bookingRes.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     157   const lockStatus = String(booking?.status ?? "").trim().toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     164         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     165         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     166         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     173   const curStatus = normStatus(booking.status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     174   const alreadyHasDriver = !!booking.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     176   if (alreadyHasDriver && curStatus && curStatus !== "requested") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     182         message: "Booking already has a driver and is not assignable.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     183         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     184         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     185         driver_id: String(booking.driver_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     186         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     187         booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     193   if (alreadyHasDriver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     195       await bestEffortUpdateBooking(supabase, String(booking.id), { status: "assigned" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     196       const reread = await fetchBookingByIdOrCode(supabase, String(booking.id), null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     197       const b2: any = reread.data ?? booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     202           code: "ALREADY_HAS_DRIVER",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     203           message: "Booking already had driver_id; status normalized to assigned (best-effo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     204           booking_id: String(b2.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     205           booking_code: b2.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     206           driver_id: b2.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     208           booking: b2,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     218         code: "ALREADY_HAS_DRIVER",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     219         message: "Booking already has driver_id.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     220         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     221         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     222         driver_id: booking.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     223         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     224         booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     236         message: "Booking status is not assignable: " + curStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     237         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     238         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     239         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     240         booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     246   const town = (body.town ?? booking.town ?? "").toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     247   const pickup_lat = typeof body.pickup_lat === "number" ? body.pickup_lat : booking.pickup...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     248   const pickup_lng = typeof body.pickup_lng === "number" ? body.pickup_lng : booking.pickup...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     250   const manual_driver_id = (body as any)?.manual_driver_id ?? (body as any)?.driver_id ?? (...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     252   // ----- MANUAL_DRIVER_SELECTED -----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     253   if (manual_driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     254     const dId = String(manual_driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     257       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     258       .select("driver_id,town,status,lat,lng")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     259       .eq("driver_id", dId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     264         { ok: false, code: "DRIVER_NOT_FOUND", message: "Driver not found in driver_locatio...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     273         { ok: false, code: "DRIVER_NOT_ELIGIBLE", message: "Driver not eligible (must be on...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     278     const bTown = String((booking as any)?.town ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     282         { ok: false, code: "DRIVER_TOWN_MISMATCH", message: "Driver town mismatch", booking...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     287     const upd = await bestEffortUpdateBooking(supabase, String(booking.id), { driver_id: dI...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     288     const reread = await fetchBookingByIdOrCode(supabase, String(booking.id), null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     289     const b2: any = reread.data ?? booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     296         booking_id: String(b2.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     297         booking_code: b2.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     298         driver_id: dId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     302         booking: b2,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     314   const pick = await findNearestOnlineFreeDriverInTown(supabase, town, pickup_lat, pickup_l...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     315   if (!pick.driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     317       { ok: false, code: "NO_DRIVER_AVAILABLE", message: "No available driver", note: pick....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     322   const upd = await bestEffortUpdateBooking(supabase, String(booking.id), { driver_id: pick...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     328       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     329       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     330       driver_id: pick.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     334       booking: upd.data ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 23     const bookingId = body.bookingId as string | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 27     if (!bookingId || Number.isNaN(pickupLat) || Number.isNaN(pickupLng)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 34     // 1) Load driver locations
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 35     const { data: driverRows, error: locError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 36       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 37       .select("driver_id, lat, lng, status, updated_at, town");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 40       console.error("driver_locations error", locError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 44     if (!driverRows || driverRows.length === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 46         { error: "NO_DRIVERS" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 51     // 2) Candidates: any driver with coordinates, not explicitly on_trip
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 52     const candidates = driverRows.filter((row: any) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 65         { error: "NO_AVAILABLE_DRIVER" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 89         { error: "NO_DRIVER_FOUND" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 94     // 4) Update booking with assigned driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 96       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 98         assigned_driver_id: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                101       .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                104       console.error("update booking error", updateError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                110       assignedDriverId: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    10   return role === "admin" || role === "dispatcher";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   105     // GET is READ-ONLY and must be accessible for the dispatch console.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   112       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   116           "booking_code",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   119           "driver_id",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   176     const tripType = String(body.service_type || body.trip_type || "dispatch")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   197     const booking_code =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   198       tripType === "takeout" ? genCode("TAKEOUT-UI-") : genCode("JR-UI-DISPATCH-");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   201       booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   219       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   222         "id,booking_code,status,town,driver_id,trip_type,vendor_id,takeout_service_level,pi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                        12   return r === "admin" || r === "dispatcher";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                        27   const booking_id = String(payload.booking_id || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                        30   if (!booking_id) return err("booking_id required");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                        35     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                        37     .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                        43   if (!data) return err("Booking not found", 404);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     19  * Dispatch-safe driver feed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     20  * - One row per driver (latest location)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     47       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     48       .select("driver_id, town, status, lat, lng, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     58     // Deduplicate: keep latest row per driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     60     const drivers: any[] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     63       const id = String((row as any).driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     71       drivers.push({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                     81     return NextResponse.json({ ok: true, drivers });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                81   const candidates = [row.status, row.state, row.availability, row.driver_status, row.drive...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                89 function bestDriverId(row: any): string | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                92   // Prefer explicit driver id fields (schema-flex)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                94     row.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                95     row.driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                96     row.driver_uuid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                                97     row.driverUuid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               162       "dispatch_driver_locations_view",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               163       "driver_locations_view",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               164       "driver_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               165       "dispatch_driver_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               166       "drivers_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               167       "drivers_location",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               168       "driver_location",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               169       "admin_driver_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               173       "my_driver_live",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               174       "dispatch_drivers_live_view",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               175       "drivers_live",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               176       "drivers",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               187         const id = bestDriverId(row);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               210         const id = bestDriverId(row);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               231     const drivers: Record<string, any> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               237       const driver_status = bestStatus(loc) ?? bestStatus(wal) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               246       drivers[id] = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               247         driver_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               257     return NextResponse.json({ ok: true, drivers });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                               260       { ok: false, error: e?.message || "drivers-live failed" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                    7   bookingCode?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                    8   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                    9   bookingId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   14 function pickBookingKey(body: Body): { bookingId: string; bookingCode: string } {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   15   const bookingId = String(body.bookingId ?? body.id ?? body.uuid ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   16   const bookingCode = String(body.bookingCode ?? body.booking_code ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   17   return { bookingId, bookingCode };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   25     const { bookingId, bookingCode } = pickBookingKey(body);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   27     if (!bookingId && !bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   29         { error: "MISSING_BOOKING_IDENTIFIER" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   35     // 1) Try bookingId as bookings.id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   36     // 2) If not found, fallback to bookingCode as bookings.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   37     let booking: any | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   39     if (bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   41         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   42         .select("id, booking_code")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   43         .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   48           { error: "BOOKING_SELECT_ERROR", message: error.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   53       booking = rows?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   56     if (!booking?.id && bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   58         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   59         .select("id, booking_code")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   60         .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   65           { error: "BOOKING_SELECT_ERROR", message: error.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   70       booking = rows?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   73     if (!booking?.id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   75         { error: "BOOKING_NOT_FOUND", bookingId, bookingCode },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   80     // IMPORTANT: Do NOT assume bookings.is_emergency exists.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   83       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   85       .eq("id", booking.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   89         { error: "BOOKING_UPDATE_ERROR", message: upErr.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                   95       { ok: true, action: "emergency", bookingId: booking.id, bookingCode: booking.booking_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         16   const required = String(process.env.DISPATCH_ADMIN_TOKEN || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         17   if (!required) return { ok: false, status: 500, msg: "Missing DISPATCH_ADMIN_TOKEN" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         19   const got = String(req.headers.get("x-dispatch-admin-token") || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         40     const bookingId = String(body.bookingId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         41     if (!bookingId) return jsonError("Missing bookingId", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         66       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         68       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         69       .select("id, booking_code, town, status, from_label, to_label, verified_fare, passeng...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                              12   return r === "admin" || r === "dispatcher";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                              16  * GET /api/dispatch/nearby-drivers?town=Lagawe&limit=20
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                              17  * Returns latest driver locations (name, town, lat/lng, updated_at) for the given town.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                              31     .from("driver_locations_with_town")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                              32     .select("driver_id, name, town, lat, lng, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                        6 type Body = { bookingCode?: string | null; bookingId?: string | null };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       13     const bookingId = String(body.bookingId ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       14     const bookingCode = String(body.bookingCode ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       15     if (!bookingId && !bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       16       return NextResponse.json({ error: "MISSING_BOOKING_IDENTIFIER" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       19     let sel = supabase.from("bookings").select("id, booking_code, updated_at").limit(1);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       20     sel = bookingId ? sel.eq("id", bookingId) : sel.eq("booking_code", bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       23     if (selErr) return NextResponse.json({ error: "BOOKING_SELECT_ERROR", message: selErr.m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       25     const booking = rows?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       26     if (!booking?.id) return NextResponse.json({ error: "BOOKING_NOT_FOUND" }, { status: 40...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       30       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       32       .eq("id", booking.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       34     if (upErr) return NextResponse.json({ error: "BOOKING_UPDATE_ERROR", message: upErr.mes...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                       36     return NextResponse.json({ ok: true, action: "nudge", bookingId: booking.id, bookingCod...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                     1 // app/api/dispatch/overview/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                     2 // Dispatch overview API - reads from dispatch_rides_view in Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    14     console.error("Missing Supabase env vars for dispatch overview");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    25   const url = `${supabaseUrl}/rest/v1/dispatch_rides_view?select=*`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    40       console.error("Supabase dispatch_rides_view error:", data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    45           message: "Failed to load dispatch overview from Supabase",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    60     console.error("Dispatch overview GET error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    64         error: "DISPATCH_OVERVIEW_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                    65         message: "Unexpected error while fetching dispatch overview",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                       5   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                       6   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      58       h?.get?.("x-dispatcher-id") ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      72     booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      73     booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      81     booking_id: entry.booking_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      82     booking_code: entry.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      86     source: entry.source ?? "dispatch/status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                      90   const tables = ["dispatch_audit_log", "audit_log", "status_audit"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     102 async function fetchBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     104   booking_id?: string | null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     105   booking_code?: string | null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     108     if (booking_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     110         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     112         .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     116     if (booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     118         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     120         .eq("booking_code", booking_code)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     124     return { data: null, error: "Missing booking_id or booking_code" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     126     return { data: null, error: e?.message || "Booking lookup failed" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     130 async function tryUpdateBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     132   bookingId: string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     137       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     139       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     145     return { ok: false, data: null, error: e?.message || "Booking update failed" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     149 // Best-effort: keep driver status roughly aligned (non-blocking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     150 function driverStatusForBookingStatus(status: string): string | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     161 async function bestEffortUpdateDriverLocation(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     163   driverId: string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     164   bookingStatus: string
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     166   const mapped = driverStatusForBookingStatus(bookingStatus);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     167   if (!driverId || !mapped) return {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     171       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     173       .eq("driver_id", driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     176       return { warning: "DRIVER_LOCATION_STATUS_UPDATE_ERROR: " + r.error.message };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     180     return { warning: "DRIVER_LOCATION_STATUS_UPDATE_ERROR: " + (e?.message || "Unknown err...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     187  * because you have a DB trigger that credits driver wallet on status -> completed.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     188  * Calling finalize could double-credit driver earnings.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     191  * - apply platform cut via process_booking_wallet_cut(p_booking_id uuid)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     196   booking: any
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     198   const bookingId = booking?.id ? String(booking.id) : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     199   const serviceType = String(booking?.service_type ?? booking?.serviceType ?? "").toLowerCa...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     200   const vendorId = booking?.vendor_id ? String(booking.vendor_id) : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     204   // 1) Apply platform/company cut (driver wallet deduction)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     205   if (bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     207       const r: any = await supabase.rpc("process_booking_wallet_cut", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     208         p_booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     215     warnings.push("WALLET_CUT_SKIPPED_NO_BOOKING_ID");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     237     const bookingId = url.searchParams.get("booking_id") || url.searchParams.get("id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     238     const bookingCode = url.searchParams.get("booking_code") || url.searchParams.get("code");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     240     const bk = await fetchBooking(supabase, bookingId ?? null, bookingCode ?? null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     243         "BOOKING_NOT_FOUND",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     244         bk.error || "Booking not found",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     246         { booking_id: bookingId ?? null, booking_code: bookingCode ?? null }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     250     const booking: any = bk.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     251     const cur = norm(booking.status) || "requested";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     253     const hasDriver = !!booking.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     257       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     258       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     260       has_driver: hasDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     262       booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     273   const booking_id =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     274     rawBody?.booking_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     275     rawBody?.bookingId ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     277     rawBody?.booking?.id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     280   const booking_code =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     281     rawBody?.booking_code ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     282     rawBody?.bookingCode ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     284     rawBody?.booking?.booking_code ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     285     rawBody?.booking?.bookingCode ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     292   if ((!booking_id || String(booking_id).trim() === "") && (!booking_code || String(booking...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     293     return jsonErr("BAD_REQUEST", "Missing booking identifier", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     304   const bk = await fetchBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     306     booking_id ? String(booking_id).trim() : null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     307     booking_code ? String(booking_code).trim() : null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     311     return jsonErr("BOOKING_NOT_FOUND", bk.error || "Booking not found", 404, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     312       booking_id: booking_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     313       booking_code: booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     317   const booking: any = bk.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     318   const cur = norm(booking.status) || "requested";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     320   const hasDriver = !!booking.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     325       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     326       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     332   // Require driver for lifecycle statuses (except requested/cancelled)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     333   if (!hasDriver && target !== "requested" && target !== "cancelled") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     334     return jsonErr("NO_DRIVER", "Cannot set status without driver_id", 409, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     335       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     336       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     339       has_driver: hasDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     341       current_status_raw: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     351       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     352       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     353       status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     354       booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     361       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     362       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     365       has_driver: hasDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     385   let upd = await tryUpdateBooking(supabase, String(booking.id), patch);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     388     upd = await tryUpdateBooking(supabase, String(booking.id), { status: target });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     392     return jsonErr("DISPATCH_STATUS_DB_ERROR", upd.error || "Booking update failed", 500, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     393       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     394       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     400   const updatedBooking = upd.data ?? booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     402   // Driver location sync (non-blocking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     403   const driverId =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     404     updatedBooking?.driver_id ? String(updatedBooking.driver_id) :
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     405     (booking?.driver_id ? String(booking.driver_id) : "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     407   const drv = await bestEffortUpdateDriverLocation(supabase, driverId, target);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     412     booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     413     booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     417     source: "dispatch/status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     423     const w = await bestEffortWalletSyncOnComplete(supabase, updatedBooking);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     440     booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     441     booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     444     booking: updatedBooking ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                        1 // app/api/dispatch/trips/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                        2 // Trip queue API - reads from bookings table in Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                       14     console.error("Missing Supabase env vars for dispatch trips");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                       25   const url = `${supabaseUrl}/rest/v1/bookings?select=*&order=created_at.desc`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                       40       console.error("Supabase bookings error:", data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                       45           message: "Failed to load bookings from Supabase",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                       60     console.error("Dispatch trips GET error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                       64         error: "DISPATCH_TRIPS_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 32 // If DRIVER_PING_SECRET is set, request must include header: x-jride-ping-secret: <secret>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 34   const secret = envAny(["DRIVER_PING_SECRET"]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 41   return json(200, { ok: true, route: "driver/location/ping" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 59     const driver_id = str(body.driver_id ?? body.driverId ?? body.driver_uuid ?? body.drive...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 62     const status = str(body.status ?? body.driver_status ?? body.driverStatus);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 65     if (!driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 66       return json(400, { ok: false, code: "BAD_REQUEST", message: "driver_id is required" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 84     // 1) Try UPSERT by driver_id (best when driver_id has unique constraint)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 85     const upsertPayload = { driver_id, ...patch };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 90         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 91         .upsert(upsertPayload, { onConflict: "driver_id" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                 98       return json(200, { ok: true, driver_id, updated_at: patch.updated_at, mode: "upsert(d...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                101     // 2) Fallback: update existing row by driver_id, else insert with generated id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                103       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                104       .select("id, driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                105       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                111         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                124       return json(200, { ok: true, driver_id, updated_at: patch.updated_at, mode: "update(i...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                132     const insertPayload = { id, driver_id, ...patch };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                135       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                                151     return json(200, { ok: true, driver_id, updated_at: patch.updated_at, mode: "insert(id+...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                20   const v = n(process.env.DRIVER_PAYOUT_MIN);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                29     route: "/api/driver/payout-request",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                31     hint_get: "GET ?driver_id=UUID&limit=20",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                32     hint_post: "POST { driver_id, amount, note? }",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                34       driver_id: searchParams.get("driver_id"),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                38     min_payout_env: process.env.DRIVER_PAYOUT_MIN ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                48   const driver_id = s(body.driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                50   if (!driver_id || driver_id.toUpperCase().includes("REPLACE_DRIVER_UUID") || driver_id.to...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                51     return json(400, { ok: false, code: "BAD_DRIVER_ID", message: "Provide a real driver_id...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                55   if (!driver_id) return json(400, { ok: false, code: "MISSING_DRIVER_ID" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                62     .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                64     .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                74     .from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                                76       driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               20 // GET /api/driver/payout-requests?driver_id=UUID&status=all|pending|approved|paid|rejected...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               27     const driver_id = s(searchParams.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               31     if (!driver_id) return json(400, { ok: false, code: "MISSING_DRIVER_ID" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               34       .from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               35       .select("id,driver_id,amount,status,requested_at,processed_at,payout_method,payout_re...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               36       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                               45     return json(200, { ok: true, driver_id, status, requests: Array.isArray(data) ? data : ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                           1 // app/api/driver/ping/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          11 const PING_TOKEN = process.env.DRIVER_PING_TOKEN ?? "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          13 type Body = { driver_id: string; lat: number; lng: number };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          17     const auth = req.headers.get("x-driver-ping-token") ?? "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          22     const { driver_id, lat, lng } = (await req.json()) as Body;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          23     if (!driver_id || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          24       return NextResponse.json({ status: "error", message: "driver_id, lat, lng required" }...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          27     const resp = await fetch(`${URL}/rest/v1/rpc/set_driver_location`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                          34       body: JSON.stringify({ p_driver_id: driver_id, p_lat: lat, p_lng: lng }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        19 // READ-ONLY driver wallet snapshot
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        20 // GET /api/driver/wallet?driver_id=UUID&tx_limit=30
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        27     const driver_id = s(searchParams.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        30     if (!driver_id) return json(400, { ok: false, code: "MISSING_DRIVER_ID" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        34       .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        35       .select("driver_id,balance")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        36       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        43       .from("driver_wallet_transactions")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        44       .select("id,driver_id,amount,balance_after,reason,booking_id,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        45       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                        53       driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                     16     .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                     17     .select("driver_id, lat, lng, status, town, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                     21     console.error("driver_locations admin fetch error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                     28   return NextResponse.json({ ok: true, drivers: data ?? [] });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                16 // POST /api/driver_locations_test
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                23     const { driverId, lat, lng, status } = body || {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                25     if (!driverId || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                29           got: { driverId, lat, lng, status },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                44       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                46       .eq("driver_id", driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                53     const { error: insErr } = await supabase.from("driver_locations").insert({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                54       driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                88 // GET /api/driver_locations_test
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                93       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                                94       .select("driver_id, lat, lng, status, updated_at");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                               109     return NextResponse.json({ drivers: data }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                      6     const { driver_id, lat, lng, is_available = true } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                      7     if (!driver_id || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                      8       return NextResponse.json({ error: "driver_id, lat, lng required" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                     12       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                     14         { driver_id, lat, lng, is_available, last_seen: new Date().toISOString() },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                     15         { onConflict: "driver_id" }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                         9     const { driverId, lat, lng, status } = body;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                        11     if (!driverId || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                        20       driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                        27       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                        30           driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                        36         { onConflict: "driver_id" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                          14   context: { params: { bookingCode: string } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                          24     const bookingCode = context.params.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                          29     if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                          31         { error: "Missing booking code" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                          44       booking_code: bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                  7   { params }: { params: { bookingCode: string } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 10   const { bookingCode } = params;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 13     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 15     .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 20       { error: error?.message ?? "Booking not found" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 25   // ✅ Type narrowing — from here onward TS knows this is a booking row
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 26   const booking = data as any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 28   const fare_breakdown = booking.fare_breakdown ?? {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 31     id: booking.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 32     booking_code: booking.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 33     passenger_name: booking.passenger_name,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 34     service_type: booking.service_type,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 35     status: booking.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 36     customer_status: booking.customer_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 37     vendor_status: booking.vendor_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 42     driver_payout: Number(booking.driver_payout ?? 0),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 44     created_at: booking.created_at,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 45     updated_at: booking.updated_at,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 46     vendor_driver_arrived_at: booking.vendor_driver_arrived_at,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                                39 async function p2dSnapshotTakeout(admin:any, bookingId:string, vendorId:string, body:any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                                41   if (!bookingId || !vendorId || !itemsIn.length) return { ok:false, inserted:0, subtotal:0...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                                60       booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                                76   const up = await admin.from("bookings").update({ service_type:"takeout", takeout_items_su...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               183 async function snapshotTakeoutOrNull(supabase: any, bookingId: string, body: any): Promise<...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               205       booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               221   const up = await supabase.from("bookings").update({ takeout_items_subtotal: subtotal }).e...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               283     out.message = "Booking is restricted from 8PM to 5AM unless verified.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               362   // Booking must include location and must be inside Ifugao (conservative bbox).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               378       { ok: false, code: "GEO_OUTSIDE_IFUGAO", message: "Booking is only allowed inside Ifu...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               391   const booking_code = isTakeout
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               394     booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               419   const ins = await supabase.from("bookings").insert(payload).select("*").maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               424     const ins2 = await supabase.from("bookings").insert(payload2).select("*").maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               427       return NextResponse.json({ ok: false, code: "BOOKING_INSERT_FAILED", message: ins2.er...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               430     let booking: any = ins2.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               433     await supabase.from("bookings").update({ status: "requested" }).eq("id", String(booking...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               436     // Phase 6H2: CALL DISPATCH ASSIGN (single source of truth, includes busy lock)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               442         const resp = await fetch(`${baseUrl}/api/dispatch/assign`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               445           body: JSON.stringify({ booking_id: String(booking.id) }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               453       assign = { ok: true, skipped: true, reason: "takeout_booking" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               455 /* PHASE2D_SKIP_ASSIGN_FOR_TAKEOUT_END */// re-read booking for final status/driver_id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               456     const reread = await supabase.from("bookings").select("*").eq("id", String(booking.id))...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               457     if (!reread.error && reread.data) booking = reread.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               465         takeoutSnapshot = await snapshotTakeoutOrNull(supabase as any, String(booking.id), ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               469     }return NextResponse.json({ ok: true, env: jrideEnvEcho(), booking_code, booking, assig...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               472   let booking: any = ins.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               474   // Freeze items + compute subtotal + store on booking. Menu edits won't affect history.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               479       const bookingId = String((booking as any)?.id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               481       if (bookingId && vendorId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               483         const takeoutSnapshot = await p2dSnapshotTakeout(supabase as any, bookingId, vendor...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               484         // best-effort (do not fail booking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               485         (booking as any).takeoutSnapshot = takeoutSnapshot;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               498       takeoutSnapshot = await snapshotTakeoutOrNull(supabase as any, String(booking.id), bo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               502   }// Phase 6H2: CALL DISPATCH ASSIGN (single source of truth, includes busy lock)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               506     const resp = await fetch(`${baseUrl}/api/dispatch/assign`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               509       body: JSON.stringify({ booking_id: String(booking.id) }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               517   // re-read booking for final status/driver_id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               518   const reread = await supabase.from("bookings").select("*").eq("id", String(booking.id)).m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               519   if (!reread.error && reread.data) booking = reread.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                               521   return NextResponse.json({ ok: true, env: jrideEnvEcho(), booking_code, booking, assign, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                              8   booking?: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             20     const bookingCode = String(url.searchParams.get("code") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             21     if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             22       return json(400, { ok: false, code: "MISSING_CODE", message: "Missing booking code" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             30       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             32         "id, booking_code, status, driver_id, assigned_driver_id, created_at, updated_at, c...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             34       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             41       return json(404, { ok: false, code: "NOT_FOUND", message: "Booking not found" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                             44     return json(200, { ok: true, booking: b });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                            55     status: "not_submitted" as "not_submitted" | "submitted" | "pending_admin" | "verified"...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                            70   function mapRawStatus(raw: any): "not_submitted" | "submitted" | "pending_admin" | "verif...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                            75     if (u === "pre_approved_dispatcher") return "pending_admin";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                            77     if (u === "rejected") return "rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                            81     if (u.indexOf("reject") >= 0) return "rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                           290         message: "Booking is restricted from 8PM to 5AM unless verified.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                          20 // POST = actually call Supabase RPC to assign the nearest driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                          33     const rpcUrl = `${SUPABASE_URL}/rest/v1/rpc/assign_nearest_driver_v2`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 17     const bookingId = body.bookingId as string | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 19     if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 21         { error: "Missing bookingId in body." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 27       data: booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 28       error: bookingError,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 30       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 32       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 35     if (bookingError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 36       console.error("ASSIGN_API_BOOKING_ERROR", bookingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 38         { error: "Failed to load booking.", details: bookingError.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 43     if (!booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 45         { error: "Booking not found." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 50     const status = (booking.status ?? "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 53         { error: "Cannot assign driver for completed/cancelled trip." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 59       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 64       .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                                 69         { error: "Failed to update booking.", details: updateError.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\complete\route.ts                                       19     const resp = await fetch(`${URL}/rest/v1/rpc/complete_ride_and_free_driver`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           15     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           18     if (!bookingCode || typeof fare !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           26       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           32       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           44     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  41     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  42     const response: "accepted" | "rejected" | undefined = body?.response;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  44     if (!bookingCode || !response) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  51     if (response !== "accepted" && response !== "rejected") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  63     if (response === "accepted") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  64       // keep current driver, proceed as normal
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  65       updates.status = "driver_accepted";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  67       // passenger rejected the fare:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  68       // reset booking and free driver, ready for auto re-assign
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  70       updates.assigned_driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  75       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  77       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  89     if (response === "rejected") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  94     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                           37   const candidates = ["bookings", "rides"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                           74       message: "No suitable rides table found (tried: bookings, rides).",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                    51       .rpc("assign_nearest_driver_to_ride", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                    67     // assigned returns table(ride_id, assigned_driver, status)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                    72       assigned_driver: result?.assigned_driver ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                          7 // allowed statuses we can move to from the dispatch console
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                          8 const ALLOWED_STATUSES = ["driver_accepted", "in_transit", "completed", "cancelled"] as const;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                         20     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                         23     if (!bookingCode || !status) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                         38       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                         43       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                         55     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts              97         "id,booking_code,service_type,vendor_status,customer_status,total_service_fare,plat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts             113       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts             125     // 6) Payout requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts             127       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts             135       console.error("❌ vendor_payout_requests error:", payoutError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts             148       payoutRequests: payoutRows ?? [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            20         "❌ Supabase env vars missing in admin vendor-payout list-requests API"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            33     // 1) Fetch all payout requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            35       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            42       console.error("❌ vendor_payout_requests list error:", requestError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            50       return NextResponse.json({ requests: [] });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            70         console.error("❌ vendor_accounts load for list-requests error:", vendorError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            95     return NextResponse.json({ requests: decorated });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts            97     console.error("❌ admin list-requests API error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts           41       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts           49       console.error("❌ vendor_payout_requests load error:", requestError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts           90         booking_code: null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts          109       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts          121       console.error("❌ vendor_payout_requests update error:", updateError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                  44       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                  48         booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                  60         driver_payout
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 118     const insertBooking: any = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 129     const b = await admin.from("bookings").insert(insertBooking).select("*").single();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 132     const booking = b.data as any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 133     const booking_id = String(booking?.id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 162       snapshotRows.push({ booking_id, menu_item_id: mid, name, price, quantity: qty, snapsh...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 173     const up = await admin.from("bookings").update({ takeout_items_subtotal: subtotal }).eq...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 175       return NextResponse.json({ ok: true, booking_id, booking_code: booking?.booking_code ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                 178     return NextResponse.json({ ok: true, booking_id, booking_code: booking?.booking_code ??...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                        97         "id,booking_code,service_type,vendor_status,customer_status,total_service_fare,plat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                       113       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                       125     // 6) Payout requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                       127       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                       135       console.error("❌ vendor_payout_requests error:", payoutError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                       151       payoutRequests: payoutRows ?? [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                        80       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                        87       console.error("❌ vendor_payout_requests pending check error:", pendingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                       106       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                       117       console.error("❌ vendor_payout_requests insert error:", insertError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                                99           "booking_code",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                               125       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                               138     // 6) Payout requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                               140       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                               149       console.error("❌ Error loading vendor_payout_requests:", requestError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                               162       payoutRequests: requestRows ?? [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                        85       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                        93       console.error("❌ Error checking existing payout requests:", existingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                       109       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                       120       console.error("❌ Error inserting vendor_payout_requests:", insertError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               11   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               57     // If your original file had more logic (joining bookings, ratings, etc.),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                                91       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor\payout-request\route.ts                                91       .from("vendor_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       231   booking_id?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       295     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       305   const itemsByBooking: Record<string, SnapshotItem[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       306   const subtotalByBooking: Record<string, number> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       311       .select("booking_id,menu_item_id,name,price,quantity,snapshot_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       312       .in("booking_id", ids);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       316         const bid = String(r?.booking_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       320           booking_id: bid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       328         if (!itemsByBooking[bid]) itemsByBooking[bid] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       329         itemsByBooking[bid].push(item);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       330         subtotalByBooking[bid] = (subtotalByBooking[bid] || 0) + item.price * item.quantity;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       333       for (const k of Object.keys(itemsByBooking)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       334         itemsByBooking[k].sort((a, b2) => String(a.snapshot_at || "").localeCompare(String(...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       341     const snapItems = itemsByBooking[bid] || null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       345     const computed = subtotalByBooking[bid] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       358       booking_code: r?.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       446 const order_id = String(body?.order_id ?? body?.orderId ?? body?.booking_id ?? body?.bookin...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       451 // Phase 3A bridge: when vendor marks ready (driver_arrived), also move booking.status -> "...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       452 // so it becomes dispatch-visible. Idempotent: only if status is still requested/empty.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       455       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       468     // Bridge rule: vendor ready -> dispatch sees it
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       469     // Only advance if booking hasn't progressed yet.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       472       nextVendor === "driver_arrived" ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       482       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       497       bridgedToDispatch: !!patch.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       518   // Create booking row (schema-safe: auto-drop unknown columns and retry)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       519   async function insertBookingSchemaSafe(initial: Record<string, any>) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       524       const res = await admin!.from("bookings").insert(payload).select("*").single();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       531       const m = msg.match(/Could not find the '([^']+)' column of 'bookings' in the schema ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       591     // bookings has 'town' column (no 'zone' column) â€” keep town only
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       666   const ins = await insertBookingSchemaSafe(createPayload);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       678   const bookingId = String(ins.data?.id ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       679   if (!bookingId) return json(500, { ok: false, error: "CREATE_FAILED", message: "Missing b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       694     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       696     .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       751     // 3) accept coords if caller provided them (future-proof)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       840       // Inline schema-safe update (drop unknown booking columns and retry)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       846           .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       848           .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       860           msg.match(/Could not find the '([^']+)' column of 'bookings' in the schema cache/...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       861           msg.match(/column\s+"([^"]+)"\s+of\s+relation\s+"bookings"\s+does\s+not\s+exist/i);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       914       .eq("booking_id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       929       // Ensure booking subtotal is set (repair only; do not re-snapshot)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       938         await admin!.from("bookings").update({ takeout_items_subtotal: subtotal }).eq("id",...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       953         booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                      1014       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                      1016       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                      1030     order_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  21     const driverId = body.driver_id as string | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  24     if (!driverId || !zoneId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  26         { error: "driver_id and zone_id are required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  33     // Upsert driver row: if exists, update zone/status; if not, create.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  34     const { error } = await supabase.from("drivers").upsert(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  36         id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  38         driver_status: "online",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  44       console.error("assign-driver error:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                  56     console.error("assign-driver unexpected error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\capacity\route.ts                                       25         "zone_id, zone_name, color_hex, capacity_limit, active_drivers, available_slots, st...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      35     // Select drivers to move
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      36     const { data: drivers, error: selError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      37       .from("drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      40       .eq("driver_status", "online")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      51     if (!drivers || drivers.length === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      53         { error: "No online drivers found in source zone" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      58     const ids = drivers.map((d) => d.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                      61       .from("drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\components\NavBar.tsx                                             19           J-Ride Dispatch
C:\Users\jwes9\Desktop\jride-clean-fresh\app\components\NavBar.tsx                                             23           <Link href="/dispatch" className="hover:text-black">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\components\NavBar.tsx                                             24             Dispatch
C:\Users\jwes9\Desktop\jride-clean-fresh\app\components\TopNav.tsx                                             18           J-Ride Dispatch
C:\Users\jwes9\Desktop\jride-clean-fresh\app\components\TopNav.tsx                                             22           <Link href="/dispatch" className="hover:text-black">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\components\TopNav.tsx                                             23             Dispatch
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dash\page.tsx                                                     21             This dashboard is under construction. Use /dispatch for live ops.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                           5 export default function DispatchAssignPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          12               Dispatch – Assign Nearest Driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          15               This page assigns the nearest online driver to the latest
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          16               pending booking using{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          31             online driver to the **oldest** pending booking. The result or
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          46                 No assignment: no_pending_booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          54                 assigned_driver_id is null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          61                 no_online_drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          63               , it means there are pending bookings but no drivers with{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          65                 driver_locations.status = 'online'
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          72                 assigned_driver_id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\assign\page.tsx                                          76                 booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                      4 import type { Booking } from "@/types/booking"; // <- import only
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                      8 export default function BookingDashboard({ title = "Bookings" }: Props) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                      9   const [bookings, setBookings] = useState<Booking[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                     18         const data: Booking[] = []; // replace with real fetch later
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                     19         if (!ignore) setBookings(data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                     21         if (!ignore) setError(e?.message ?? "Failed to load bookings");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                     36           {bookings.length === 0 && <li className="py-2 text-gray-500">No bookings yet.</li>}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingDashboard.tsx                                     37           {bookings.map(b => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                           3 interface BookingFormProps {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                           4   onBookingCreated: (booking: any) => void;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                           7 export default function BookingForm({ onBookingCreated }: BookingFormProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          15     assignedDriver: ''
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          25   const availableDrivers = [
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          50       const booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          55         type: 'dispatcher_booking',
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          56         dispatcherId: localStorage.getItem('dispatcher_id')
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          62       onBookingCreated(booking);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          72         assignedDriver: ''
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          77       console.error('Booking creation failed:', error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          91             <h2 className="text-xl font-semibold text-gray-900">Manual Booking</h2>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          92             <p className="text-sm text-gray-500">Create booking from call/message</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         214           {/* Driver Assignment */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         217               Assign Driver (Optional)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         220               value={formData.assignedDriver}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         221               onChange={(e) => setFormData(prev => ({ ...prev, assignedDriver: e.target.val...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         224               <option value="">Auto-assign nearest driver</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         225               {availableDrivers.map(driver => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         226                 <option key={driver.id} value={driver.id}>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         227                   {driver.name} - {driver.vehicle} ({driver.distance} away)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         258                 Creating Booking...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         263                 Create Booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         290                   assignedDriver: ''
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                        3 interface DispatcherAuthProps {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                        7 export default function DispatcherAuth({ onLogin }: DispatcherAuthProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       11     dispatcherId: ''
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       23       if (credentials.username && credentials.password && credentials.dispatcherId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       24         localStorage.setItem('dispatcher_authenticated', 'true');
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       25         localStorage.setItem('dispatcher_id', credentials.dispatcherId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       26         localStorage.setItem('dispatcher_username', credentials.username);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       46           <h1 className="text-2xl font-bold text-gray-900 mb-2">J-Ride Dispatch</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       47           <p className="text-gray-600">Dispatcher Portal Access</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       82               Dispatcher ID
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       86               value={credentials.dispatcherId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       87               onChange={(e) => setCredentials(prev => ({ ...prev, dispatcherId: e.target.va...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                       89               placeholder="Enter your dispatcher ID"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                      111               'Login to Dispatch Portal'
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                      123                 <li>â€¢ Contact admin for dispatcher credentials</li>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherAuth.tsx                                      124                 <li>â€¢ Use your assigned Dispatcher ID</li>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                         3 interface Driver {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        16 interface DispatcherMapProps {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        17   pendingBookings: any[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        21 export default function DispatcherMap({ pendingBookings, activeTrips }: DispatcherMapProps) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        22   const [drivers, setDrivers] = useState<Driver[]>([
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        61   const [selectedDriver, setSelectedDriver] = useState<Driver | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        64   const filteredDrivers = filterStatus === 'all'
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        65     ? drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        66     : drivers.filter(driver => driver.status === filterStatus);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                        91           <h2 className="text-lg font-semibold text-gray-900">Live Driver Tracking</h2>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       109               {status === 'all' ? 'All Drivers' : getStatusText(status)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       112                   ({drivers.filter(d => d.status === status).length})
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       133         {/* Driver Status Overlay */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       136             <h3 className="text-sm font-medium text-gray-900">Driver Status</h3>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       145               <span className="font-medium">{drivers.filter(d => d.status === 'available')....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       152               <span className="font-medium">{drivers.filter(d => d.status === 'on-trip').le...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       159               <span className="font-medium">{drivers.filter(d => d.status === 'offline').le...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       165       {/* Driver List */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       168           <h3 className="text-sm font-medium text-gray-900">Drivers ({filteredDrivers.lengt...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       172           {filteredDrivers.map((driver) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       174               key={driver.id}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       175               onClick={() => setSelectedDriver(driver)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       184                     <div className={`absolute -bottom-1 -right-1 w-4 h-4 ${getStatusColor(d...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       187                     <p className="font-medium text-gray-900 text-sm">{driver.name}</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       188                     <p className="text-xs text-gray-500">{driver.vehicle}</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       195                     <span className="text-xs font-medium">{driver.rating}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       197                   <p className="text-xs text-gray-500">{driver.trips_today} trips</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       205       {/* Driver Detail Modal */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       206       {selectedDriver && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       211                 <h3 className="text-lg font-semibold">Driver Details</h3>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       213                   onClick={() => setSelectedDriver(null)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       226                     <p className="font-medium text-gray-900">{selectedDriver.name}</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       227                     <p className="text-sm text-gray-500">{selectedDriver.vehicle}</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       229                       selectedDriver.status === 'available' ? 'bg-green-100 text-green-700' :
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       230                       selectedDriver.status === 'on-trip' ? 'bg-yellow-100 text-yellow-700' :
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       233                       <div className={`w-2 h-2 ${getStatusColor(selectedDriver.status)} rou...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       234                       {getStatusText(selectedDriver.status)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       245                     <p className="text-lg font-bold text-gray-900">{selectedDriver.rating}</p>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       252                     <p className="text-lg font-bold text-gray-900">{selectedDriver.trips_to...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       258                     setSelectedDriver(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       259                     // Navigate to booking form with pre-selected driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       262                   disabled={selectedDriver.status !== 'available'}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatcherMap.tsx                                       264                   {selectedDriver.status === 'available' ? 'Assign Booking' : 'Driver Not A...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                22   driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                27   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                36 export default function DispatchPageComponent() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                85     const { data, error } = await supabase.rpc("select_nearest_driver", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               109       driver_id: assignNearest ? nearest?.driver_id ?? null : null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               124       <h1 className="text-2xl font-semibold">Dispatch</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               199           {/* Nearest driver */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               201             <div className="text-sm font-medium">Nearest driver (same town)</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               230                   placeholder="Driver last update window"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               246                 Freshness = minutes since driver last location update. Radius = search dist...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               256               <div className="mt-3 text-xs text-gray-500">No driver selected.</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               301                     <div className="text-xs text-gray-500">{r.driver_id ?? "unassigned"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 15 type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 17   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 74   /* JRIDE_UI_DRIVER_HEALTH_HELPERS_START */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 90   // Canonical derived state for dispatch display.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 91   // Booking status wins (busy), otherwise use last-seen + live status.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 92   function deriveDriverState(bookingStatusRaw: any, liveStatusRaw: any, lastSeenIso?: strin...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 93     const bs = normStatus(String(bookingStatusRaw ?? ""));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                106   /* JRIDE_UI_DRIVER_HEALTH_HELPERS_END */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                187 function isLguComplete(b: Booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                259 export default function DispatchPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                260   const [rows, setRows] = useState<Booking[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                265   const [dispatcherName, setDispatcherName] = useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                267   /* JRIDE_UI_DRIVER_HEALTH_STATE_START */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                268   const [driverLiveMap, setDriverLiveMap] = useState<Record<string, any>>({});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                269   /* JRIDE_UI_DRIVER_HEALTH_STATE_END */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                275   const [qBooking, setQBooking] = useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                282     setQBooking("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                293   const LS_KEY_SEARCH_V2 = "JRIDE_DISPATCH_SEARCH_V2";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                296   const lowWalletDrivers = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                298       const m: any = (driverLiveMap as any) || {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                322             id: String((d as any).id || (d as any).driver_id || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                323             driver_name: String((d as any).driver_name || "Driver"),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                325             driver_status: String((d as any).driver_status || (d as any).status || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                345   }, [driverLiveMap]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                347   const lowWalletCount = lowWalletDrivers.length;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                359       if (typeof j.qBooking === "string") setQBooking(j.qBooking);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                375         qBooking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                382   }, [searchQ, qBooking, qPhone, qStatus, qTown]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                432   const [fixTarget, setFixTarget] = useState<Booking | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                444       const saved = localStorage.getItem("JRIDE_DISPATCHER_NAME");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                445       if (saved) setDispatcherName(saved);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                446       const tok = localStorage.getItem("JRIDE_DISPATCH_ADMIN_TOKEN");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                455       localStorage.setItem("JRIDE_DISPATCHER_NAME", dispatcherName);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                457   }, [dispatcherName]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                463       localStorage.setItem("JRIDE_DISPATCH_ADMIN_TOKEN", fixToken);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                468     const r = await fetch("/api/dispatch/bookings", { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                475   const r = await fetch("/api/dispatch/status?log=1", { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                480 // Driver live telemetry (read-only; optional)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                481 async function loadDriversLive() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                483     const r = await fetch("/api/dispatch/drivers-live", { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                485     if (j?.ok && j?.drivers && typeof j.drivers === "object") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                486       setDriverLiveMap(j.drivers);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                494       loadDriversLive().catch(() => {});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                498       loadDriversLive().catch(() => {});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                503   function keyOf(b: Booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                504     return String(b.booking_code || b.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                511   async function setStatus(b: Booking, nextStatus: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                517       if (dispatcherName && dispatcherName.trim()) headers["x-dispatcher-name"] = dispatche...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                519       const j = await postJson("/api/dispatch/status", { bookingId: String(b.id), status: n...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                534       const msg = String(e?.message || "REJECTED");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                535       setAck(key, { state: "err", at: Date.now(), msg: "REJECT: " + msg, httpStatus: e?.htt...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                546       loadDriversLive().catch(() => {});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                570   function buildLguRows(input: Booking[]) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                589         Booking_code: b.booking_code || "N/A",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                592         Dispatcher: dispatcherName?.trim() ? dispatcherName.trim() : "N/A",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                605     "Booking_code",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                608     "Dispatcher",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                698     const filename = `dispatch-actions-${stamp}.csv`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                703       booking: a.bookingCode || a.bookingId || "",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                705       driverId: a.driverId || "",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                715     const cols = ["at","type","booking","nextStatus","driverId","result","code","message","...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                719   function openFixer(b: Booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                732       setFixMsg("Missing token. Set DISPATCH_ADMIN_TOKEN on Vercel and paste it here.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                737       bookingId: fixTarget.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                750       await postJson("/api/dispatch/lgu", payload, { "x-dispatch-admin-token": fixToken.tri...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                767   const [focusBookingId, setFocusBookingId] = useState<string | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                786   // === Search V2 (hooks-safe): filter ONLY the bookings table (LGU exports stay based on ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                799   function getBookingCode(b: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                800     return String(b?.booking_code ?? b?.bookingCode ?? b?.id ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                818   function isLowWalletByDriver(d: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                828     const bookingNeedle = normTxt(qBooking);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                836     if (!bookingNeedle && !phoneNeedle && !statusNeedle && !townNeedle && !free) return base;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                839       const code = getBookingCode(b);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                844             // Money Phase 1: optional low-wallet filter (driver locked / below minimum)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                846         const driverId = String(b?.driver_id ?? b?.assigned_driver_id ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                847         const d = driverId ? (driverLiveMap as any)?.[driverId] : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                848         if (!isLowWalletByDriver(d)) return false;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                851       if (bookingNeedle && !includesCI(code, bookingNeedle)) return false;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                880   }, [rowsUi, qBooking, qPhone, qStatus, qTown, searchQ]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                887     if (!focusBookingId) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                889       const el = document.querySelector('[data-booking-id="' + focusBookingId + '"]');
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                892   }, [focusBookingId]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                899     setFocusBookingId(String((b).id || (b).uuid || (b).booking_code || ""));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                908             <span className="font-semibold">Dispatcher:</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                909             <span className="font-mono">{dispatcherName?.trim() ? dispatcherName.trim() : "...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                958           <h1 className="text-xl font-semibold">Dispatch</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                970             <span className="text-xs text-slate-600">Dispatcher</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                972               value={dispatcherName}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                973               onChange={(e) => setDispatcherName(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                981                 placeholder="booking / phone / status / town"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                988                   value={qBooking}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                989                   onChange={(e) => setQBooking(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                990                   placeholder="booking code"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1079                       Low-wallet drivers <span className="text-xs text-slate-500">({lowWall...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1082                       Based on live driver telemetry (wallet_balance &lt; min_wallet_requir...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1090                           <th className="py-1 pr-2">Driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1100                         {lowWalletDrivers.slice(0, 20).map((d: any) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1111                                 <span className="font-medium">{d.driver_name}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1115                               <td className="py-1 pr-2">{d.driver_status || "-"}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1233           <div className="p-3 border-b font-semibold">Bookings</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1239                   <th className="p-2">Booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1241                   <th className="p-2">Driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1250                       No rows from /api/dispatch/bookings
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1284   const code = String((b as any).booking_code || (b as any).id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1288       <span className="font-mono">{highlightText(code, qBooking || searchQ)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1293         title="Copy booking code"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1328                             const driverId = String((b as any).driver_id || (b as any).assi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1329                             if (!driverId) return <span className="text-slate-400 text-xs">...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1331                             const d: any = (driverLiveMap as any)?.[driverId] || null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1333                             const state = deriveDriverState((b as any).status, d?.driver_st...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1359                                   const low = isLowWalletByDriver(d);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1474                     <div className="font-mono text-[11px]">{String(a.bookingCode || a.booki...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1478                     {String(a.type || "status")} ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¢ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ã...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1499               Booking: <span className="font-mono">{fixTarget?.booking_code || fixTarget?.i...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1503               <div className="text-xs text-slate-600">Admin token (Vercel env: DISPATCH_ADM...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                                5 type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               15   driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               19 export default function DispatchPage(): JSX.Element {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               20   const [rows, setRows] = React.useState<Booking[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               31   const [assignDriverId, setAssignDriverId] = React.useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               36       const res = await fetch("/api/dispatch/bookings", { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               44   async function createBooking() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               54       const res = await fetch("/api/dispatch/bookings", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               65   async function assign(booking_id: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               66     if (!assignDriverId) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               68       const res = await fetch("/api/dispatch/assign", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               70         body: JSON.stringify({ booking_id, driver_id: assignDriverId }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               74       setRows((prev) => prev.map((b) => (b.id === booking_id ? data.row : b)));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               75       setAssignDriverId("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               79   async function setStatus(booking_id: string, status: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               81       const res = await fetch("/api/dispatch/status", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               83         body: JSON.stringify({ booking_id, status }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               87       setRows((prev) => prev.map((b) => (b.id === booking_id ? data.row : b)));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               95       <h1 className="text-2xl font-semibold">Dispatch Panel</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               98         <h2 className="font-medium">New Booking</h2>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                              106         <button onClick={createBooking} className="px-4 py-2 rounded-xl border shadow">Crea...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                              119                 <th className="py-2">Driver</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                              130                     <td className="py-2">{b.driver_id ? b.driver_id : "-"}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                              133                         placeholder="driver_id"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                              134                         value={assignDriverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                              135                         onChange={(e)=>setAssignDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                            6   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                            7   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           22 export default function DriverActionsPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           23   const [bookingId, setBookingId] = React.useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           24   const [bookingCode, setBookingCode] = React.useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           29   const canUseId = bookingId.trim().length > 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           30   const canUseCode = bookingCode.trim().length > 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           35   }, [bookingId, bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           42         ? `booking_id=${encodeURIComponent(bookingId.trim())}`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           43         : `booking_code=${encodeURIComponent(bookingCode.trim())}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           44       const r = await fetch(`/api/dispatch/status?${qs}`, { cache: "no-store" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           57     if (!inspect?.booking_id && !inspect?.booking_code) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           62       if (inspect.booking_id) body.booking_id = inspect.booking_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           63       if (inspect.booking_code) body.booking_code = inspect.booking_code;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           65       const r = await fetch("/api/dispatch/status", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                           92           <h1 className="text-2xl font-semibold">Driver Actions</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                          106           placeholder="booking id (uuid)"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                          107           value={bookingId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                          108           onChange={(e) => setBookingId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                          112           placeholder="booking code"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                          113           value={bookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\actions\page.tsx                                          114           onChange={(e) => setBookingCode(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                               5   startDriverTracking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                               6   stopDriverTracking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                               8 } from "@/lib/driver-tracking";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                              10 export default function DriverLivePage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                              19       const result: UpsertResult = await startDriverTracking(town);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                              24           "Please sign in as a JRide driver first. Live tracking requires an authenticated ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                              44       const result: UpsertResult = await stopDriverTracking(town);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\live\page.tsx                                              60       <h1 className="text-xl font-semibold mb-2">JRide Driver Live</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                       5   startDriverTracking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                       6   stopDriverTracking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                       8 } from "@/lib/driver-tracking";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                       9 import { supabase } from "@/lib/supabaseDriverClient";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      11 export default function DriverLiveTrackingPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      14   const [statusMsg, setStatusMsg] = useState("Checking driver session…");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      22           "Please sign in as a JRide driver first. Live tracking requires an authenticated ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      34       window.location.href = "/driver/login";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      40       const result: UpsertResult = await startDriverTracking(town);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      55       const result: UpsertResult = await stopDriverTracking(town);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                      76         JRide Driver Live Tracking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                     108             href="/driver/login"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\livetracking\page.tsx                                     111             Go to Driver Login
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\login\page.tsx                                              4 import { supabase } from "@/lib/supabaseDriverClient";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\login\page.tsx                                              6 export default function DriverLoginPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\login\page.tsx                                             25       console.error("Driver login error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\login\page.tsx                                             34       window.location.href = "/driver/livetracking";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\login\page.tsx                                             40       <h1 className="text-xl font-semibold mb-4">JRide Driver Login</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\login\page.tsx                                             42         Sign in with your assigned JRide driver account. After login, you will
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   14   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   19   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   23   can_accept_new_jobs: boolean | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   36 export default function DriverDashboard() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   37   // Put your test driver UUID here (from drivers table)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   38   const [driverId, setDriverId] = useState<string>(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   43   // PHASE13-D_DRIVER_GEO_GATE
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                   54   function promptDriverGeoFromClick() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  110   const driverGeoOk = geoPermission === "granted" && geoInsideIfugao === true;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  119     if (!driverId) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  126         .eq("driver_id", driverId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  135         .from("driver_wallet_status_view")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  137         .eq("driver_id", driverId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  143       // Payout history for this driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  145         .from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  149         .eq("driver_id", driverId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  159       .channel("driver_rides_" + driverId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  166           filter: `driver_id=eq.${driverId}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  184   }, [driverId]); // keep dependency minimal
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  187     wallet && wallet.can_accept_new_jobs === false ? true : false;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  190     if (!driverId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  191       alert("Set driver UUID first.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  206         await fetch("/api/driver/heartbeat", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  210             driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  249       <h1 className="text-xl font-semibold">JRide • Driver</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  250       {/* PHASE13-D_DRIVER_GEO_GATE_UI_PANEL */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  252         <div className="font-medium text-amber-900">Driver location check</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  260           onClick={() => promptDriverGeoFromClick()}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  265       {/* END PHASE13-D_DRIVER_GEO_GATE_UI_PANEL */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  267 {/* Driver config + shift controls */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  269         <label className="text-sm">Driver UUID</label>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  272           value={driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  273           onChange={(e) => setDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  309           Sends GPS → <code>/api/driver/heartbeat</code> → live on map.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  328               {wallet.can_accept_new_jobs
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  329                 ? "You can accept new jobs."
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  330                 : "You cannot accept new jobs until you top up your JRide wallet."}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  335             No wallet record yet for this driver.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\page.tsx                                                  380             No payout records yet for this driver.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\payouts\page.tsx                                            7       <h1 className="text-xl font-semibold mb-3">Driver Payouts</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                          6 export default function DriverPostTripClient() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                         10   // total fare passed in the URL, e.g. /driver/post-trip?total=85
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                         19   //   driverTakeHome: number,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                         47             ₱{breakdown.driverTakeHome}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                         54         onClick={() => router.push("/driver")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\page.tsx                                          5 import DriverPostTripClient from "./DriverPostTripClient";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\page.tsx                                         10       <DriverPostTripClient />
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                     5 export default function DriverHeartbeatPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                     6   const [driverId, setDriverId] = useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    24     if (!driverId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    25       setLastStatus("Enter your Driver ID first.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    36           const res = await fetch("/api/driver-heartbeat", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    40               driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    82       <h1 className="text-xl font-semibold">JRide — Driver Test Heartbeat</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    84       <label className="block text-sm">Driver ID (UUID from the Drivers table)</label>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    88         value={driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\test-heartbeat\page.tsx                                    89         onChange={(e) => setDriverId(e.target.value.trim())}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                             7   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            11   booking_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            17   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            36 export default function DriverWalletPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            37   const [driverId, setDriverId] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            38   const [status, setStatus] = useState<"all" | "pending" | "approved" | "paid" | "rejected"...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            48     // TEMP: self-service via query param until driver auth is wired
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            50     const d = s(sp.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            51     if (d) setDriverId(d);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            55     const d = s(driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            56     if (!d) { setMsg("Provide driver_id in the box (or URL ?driver_id=UUID)."); return; }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            61       const w = await fetch(`/api/driver/wallet?driver_id=${encodeURIComponent(d)}&tx_limit...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            65       const p = await fetch(`/api/driver/payout-requests?driver_id=${encodeURIComponent(d)}...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            71       setReqs(Array.isArray(pj.requests) ? pj.requests : []);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            80   useEffect(() => { if (driverId) loadAll(); }, [status]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            91       <h1 style={{ fontSize: 20, fontWeight: 800, margin: 0 }}>Driver Wallet (Read-only)</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            93         Self-service view. Locked: no mutations. For now, driver_id is provided via URL or ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                            99           value={driverId}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           100           onChange={(e) => setDriverId(e.target.value)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           101           placeholder="driver_id UUID (or use ?driver_id=...)"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           109           <option value="rejected">rejected</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           129             /driver/wallet?driver_id=YOUR_UUID
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           132             Phase 10B can wire this to driver session so no query param is needed.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           144                   {["id", "created_at", "amount", "balance_after", "reason", "booking_id"]....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           157                     <td style={{ padding: 8, borderBottom: "1px solid #f3f4f6", fontFamily:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           193                   <tr><td colSpan={8} style={{ padding: 10, opacity: 0.7 }}>No payout reque...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\wallet\page.tsx                                           203         Locked rule: this page is read-only and intended for driver self-service. It does n...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 284     const ref = safeStr(pickFirst(r, ["booking_code", "code", "ref", "reference", "id"]), E...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 999                     Note: Booking page prefill requires /ride to read ?from=&to= (next step...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 137               href="https://dispatch.jride.net"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 140               Dispatcher Portal
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 161             href="https://dispatch.jride.net"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 167             <h3 className="text-xl font-bold text-gray-900 mb-3">For Dispatchers</h3>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 168             <p className="text-gray-600 mb-6">Manage bookings, track drivers, and handle op...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 177           <p className="text-gray-600 mb-6">Join thousands of satisfied passengers and driv...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 186               href="https://dispatch.jride.net"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 189               Dispatcher Portal
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 193             Bookmark: <strong>app.jride.net</strong> (App) â€¢ <strong>dispatch.jride.net</...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                      6 type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                      8   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     18   driver_payout: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     21   vendor_driver_arrived_at: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     28   | { status: "loaded"; booking: Booking };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     33   const bookingCode = (params?.bookingCode as string) ?? "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     38     if (!bookingCode) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     46           `/api/orders/${encodeURIComponent(bookingCode)}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     55         const json = (await res.json()) as { booking: Booking };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     57           setState({ status: "loaded", booking: json.booking });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     76   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     82   const renderStatusChip = (booking: Booking) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     83     const s = booking.customer_status || booking.vendor_status || "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     90     } else if (s === "driver_arrived") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    135   const booking = state.booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    146               {booking.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    150             {renderStatusChip(booking)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    170             <span className="font-medium">driver arrived</span> and{" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    182               <span>{formatPeso(booking.base_fee)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    186               <span>{formatPeso(booking.distance_fare)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    190               <span>{formatPeso(booking.waiting_fee)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    194               <span>{formatPeso(booking.extra_stop_fee)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    199               <span>{formatPeso(booking.total_bill)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\page.tsx                                                           9       <h1 className="text-xl font-semibold mb-4">J-Ride Dispatch</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\page.tsx                                                          30           <a href="/dispatch">Go to Dispatch Dashboard</a>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\page.tsx                                                          41           <a href="/api/bookings" target="_blank">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\page.tsx                                                          42             API: /api/bookings
C:\Users\jwes9\Desktop\jride-clean-fresh\app\passenger\page.tsx                                                68           <Card id="ride" title="Book Ride" desc="Go to ride booking" />
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\success\page.tsx                                           1 export default function RequestSuccessPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\success\page.tsx                                           6         Your booking request has been sent. A driver/dispatcher will review it.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     22   if (st === "requested") return "We're looking for a nearby driver.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     23   if (st === "assigned") return "A driver has accepted your request.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     24   if (st === "on_the_way") return "Driver is heading to your pickup point.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     25   if (st === "arrived") return "Driver has arrived. Please proceed.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     34   if (!st || st === "requested") return "Most pickups take a few minutes. Please wait while...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     35   if (st === "assigned") return "Driver assignment is confirmed. Please prepare at your pic...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     48   if (u.indexOf("CAN_BOOK_BLOCKED") >= 0) return "Booking is temporarily unavailable.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     49   if (u.indexOf("GEO_BLOCKED") >= 0) return "Booking is restricted outside the service area.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     50   if (u.indexOf("BOOKING_POLL_FAILED") >= 0 || u.indexOf("BOOKING_POLL_ERROR") >= 0) return...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     51   if (u.indexOf("CAN_BOOK_INFO_FAILED") >= 0 || u.indexOf("CAN_BOOK_INFO_ERROR") >= 0) retu...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     52   if (u.indexOf("BOOK_FAILED") >= 0) return "Booking failed. Please try again.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     57 /* ===== PHASE P3: Booking block reason clarity (UI-only) ===== */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     65       body: "Please verify your account before booking a ride.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     71       title: "Booking unavailable at this time",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     72       body: "Bookings are limited during night hours.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     85       title: "Booking temporarily unavailable",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                     86       body: "We're unable to process bookings right now.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    158       body: "Please verify your account before booking a ride.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    164       title: "Booking unavailable at this time",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    165       body: "Bookings may be limited during night hours.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    178       title: "Booking temporarily unavailable",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    179       body: "We're unable to process bookings right now.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    190     return { ok: false, title: "Sign in required", body: "Please sign in before booking a r...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    196   return { ok: true, title: "Ready to book", body: "You can proceed to request a driver." };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    256     if (st === "requested") return "We're looking for a nearby driver.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    257     if (st === "assigned") return "A driver has accepted your request.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    258     if (st === "on_the_way") return "Driver is heading to your pickup point.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    259     if (st === "arrived") return "Driver has arrived. Please proceed.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    268     if (!st || st === "requested") return "Most pickups take a few minutes. Please wait whi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    269     if (st === "assigned") return "Driver assignment is confirmed. Please prepare at your p...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    275     // UI-only guardrail: no ÃƒÂ¢Ã¢â€šÂ¬Ã…â€œcancel/clearÃƒÂ¢Ã¢â€šÂ¬Ã‚Â once driver is alr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    283     if (u.indexOf("CAN_BOOK_BLOCKED") >= 0) return "Booking is temporarily unavailable.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    284     if (u.indexOf("GEO_BLOCKED") >= 0) return "Booking is restricted outside the service ar...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    285     if (u.indexOf("BOOKING_POLL_FAILED") >= 0 || u.indexOf("BOOKING_POLL_ERROR") >= 0) retu...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    286     if (u.indexOf("CAN_BOOK_INFO_FAILED") >= 0 || u.indexOf("CAN_BOOK_INFO_ERROR") >= 0) re...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    287     if (u.indexOf("BOOK_FAILED") >= 0) return "Booking failed. Please try again.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    387   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    393 type BookingRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    395   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    396   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    402   booking_code?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    405   booking?: BookingRow | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    437   if (s === "submitted") return "Submitted (dispatcher review)";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    440   if (s === "rejected") return "Rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    447   if (note.indexOf("pre_approved_dispatcher") >= 0) return "Pending admin approval";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    448   if (note.indexOf("dispatcher") >= 0) return "Pending admin approval";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    449   if (note) return "Submitted (dispatcher review)";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    507   // Accepts: /ride?from=<pickup>&to=<dropoff>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    536   const [liveDriverId, setLiveDriverId] = React.useState<string>("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    545   // Signup/Login allowed anywhere; booking/actions blocked unless:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    557   // Allows booking if (geo ok) OR (local code present). Backend validates the code.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    580     return "Booking blocked";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    585       return "To book a ride, allow location access. Login/signup works anywhere, but booki...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    588       return "Booking is only available inside Ifugao. You may login/signup anywhere, but b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1462     // GET /api/public/passenger/booking?code=BOOKING_CODE
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1476         const url = "/api/public/passenger/booking?code=" + encodeURIComponent(activeCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1484           setLiveErr("BOOKING_POLL_FAILED: " + msg);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1488         const b = (j.booking || (j.data && j.data.booking) || (j.payload && j.payload.booki...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1491         const did = String((b && b.driver_id) ? b.driver_id : (j.driver_id || "")) || "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1494         setLiveDriverId(did);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1503         setLiveErr("BOOKING_POLL_ERROR: " + String(e?.message || e));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1556   const bookingSubmitted = !!activeCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1560   // Phase 13: booking allowed if (geo ok) OR (local verification code present)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1568     !bookingSubmitted &&
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1574     if (canCode || canMsg) return "Booking blocked";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1575     return "Booking blocked";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1582       return "Your account is not verified. Ride booking is restricted during night gate ho...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1607     lines.push("Notes: " + (nightGate ? "Night gate is ON and booking is blocked while unve...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1659       // PHASE13_UI_GEO_GATE (UI-only): block booking until location is granted + inside If...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1697       // 2) Create booking (no debug flags)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1766       if (bj.booking_code) lines.push("booking_code: " + bj.booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1767       if (bj.booking && bj.booking.id) lines.push("booking_id: " + String(bj.booking.id));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1768       if (bj.booking && bj.booking.status) lines.push("status: " + String(bj.booking.status));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1769       if (bj.booking && bj.booking.driver_id) lines.push("driver_id: " + String(bj.booking....
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1773         if (bj.assign.driver_id) lines.push("assign.driver_id: " + String(bj.assign.driver_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1784         const b: any = (bj && ((bj as any).booking || bj)) as any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1805       // 3) Start live polling after booking (if we have a booking_code)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1806       const code = norm((bj.booking && bj.booking.booking_code) ? bj.booking.booking_code :...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1809         setLiveStatus(String((bj.booking && bj.booking.status) ? bj.booking.status : ""));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1810         setLiveDriverId(String((bj.booking && bj.booking.driver_id) ? bj.booking.driver_id ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1837             const driver: string = "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1929                         <div className="text-xs opacity-70">Driver</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1930                         <div className="font-mono text-xs">{driver || "(none)"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2142               className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy || ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2149               className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy || ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2164               className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy || ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2166               disabled={busy || bookingSubmitted}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2179               className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy || ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2185               disabled={busy || bookingSubmitted}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2193               Fare is proposed by drivers. You can accept to proceed or reject to request a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2202               className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy || ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2253                   className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2261                   className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2270               className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy || ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2321                   className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2329                   className={"w-full rounded-xl border border-black/10 px-3 py-2 " + ((busy...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2420             title={bookingSubmitted ? "Booking already submitted. Press Clear to book again...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2422             {busy ? "Booking..." : (bookingSubmitted ? "Booking submitted" : "Submit bookin...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2432               setLiveDriverId("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2477                 title={p1IsNonCancellable(p5OverrideStatus(liveStatus)) ? "You can't cancel...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2482                   setLiveDriverId("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2533                 const driver: string =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2534                   (typeof liveDriverId !== "undefined" && liveDriverId) ? String(liveDriver...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2550                   (driver ? ("Driver: " + driver + "\n") : "") +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2614                         <div className="text-xs opacity-70">Driver</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2615                         <div className="font-mono text-xs">{driver || "(none)"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2711                 const driver = String(liveDriverId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2718                   (driver ? ("Driver: " + driver + "\n") : "") +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2759                             setLiveDriverId("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2764                           title="Clear receipt and start a new booking"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2783                         <div className="text-xs opacity-70">Driver</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2784                         <div className="font-mono text-xs">{driver || "(none)"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2807                   <div className="text-xs opacity-70">Driver</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2808                   <div className="font-mono text-xs">{liveDriverId || "(none)"}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2828                 Polling: /api/public/passenger/booking?code=...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\book\page.tsx                                               30         alert(`✅ Assigned\nDriver: ${js.driver_id}${js.distance_meters ? ` (~${Math.round(j...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\book\page.tsx                                               32         alert(`ℹ️ ${js.message || "No driver available"}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                      6   id: string; status: string; driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                      9 type DriverLoc = { driver_id: string; lat: number; lng: number };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     15   const [driver, setDriver] = useState<DriverLoc | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     38     if (!ride?.driver_id) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     39     const ch = sb.channel("track_driver_" + ride.driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     41         { event: "*", schema: "public", table: "driver_locations", filter: `driver_id=eq.${...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     44           if (d?.lat && d?.lng) setDriver({ driver_id: d.driver_id, lat: d.lat, lng: d.lng });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     48   }, [ride?.driver_id, sb]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     55       <div>Driver: <b>{ride?.driver_id ?? "(unassigned)"}</b></div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     56       {driver ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     57         <div className="text-sm">Driver location: {driver.lat.toFixed(5)}, {driver.lng.toFi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\rider\track\[rideId]\page.tsx                                     59         <div className="text-sm opacity-70">Waiting for driver location…</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                            19 export default function AdminPayoutRequestsPage() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                            32         "/api/takeout/admin/vendor-payout/list-requests"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                            37         throw new Error(json.error || "Failed to load payout requests.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                            40       const mapped: PayoutRequestRow[] = (json.requests ?? []).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                            57       console.error("Failed to load payout requests:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                            58       setError(err?.message || "Failed to load payout requests.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                           114             Takeout – Admin Vendor Payout Requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                           117             Global queue of vendor payout requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                           135         <div>Loading payout requests...</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payout-requests\page.tsx                           138           There are no payout requests yet.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                         33   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                         45   booking_code: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                         86   const [payoutRequests, setPayoutRequests] = useState<PayoutRequest[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        138           booking_code: o.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        152             booking_code: t.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        161         const prRows: PayoutRequest[] = (json.payoutRequests ?? []).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        173         setPayoutRequests(prRows);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        246       // Reload data to refresh wallet + requests
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        253         const prRows: PayoutRequest[] = (reloadJson.payoutRequests ?? []).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        265         setPayoutRequests(prRows);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        462                 <th className="p-2">Booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        473                   <td className="p-2">{o.booking_code}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        506                 <th className="p-2">Booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        516                   <td className="p-2">{t.booking_code ?? "-"}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        527         <h2 className="text-lg font-semibold mb-2">Payout Requests</h2>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        528         {payoutRequests.length === 0 ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        530             No payout requests for this vendor.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        545               {payoutRequests.map((r) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             23   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             32   vendor_driver_arrived_at?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             39   driver_payout?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             54   params: { bookingCode: string };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             59   accepted: "Order accepted",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             69   "accepted",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            107     case "accepted":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            108     case "order_accepted":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            109       return "accepted";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            115     case "driver_arrived":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            142   const bookingCode = decodeURIComponent(params.bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            199       const res = await fetch(`/api/orders/${encodeURIComponent(bookingCode)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            205       const newOrder: Order = (data.booking ?? data.order ?? data) as Order;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            226   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            229     if (!bookingCode) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            236         .channel(`takeout-order-${bookingCode}`)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            242             table: "bookings",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            243             filter: `booking_code=eq.${bookingCode}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            264   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            272   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            280         `/takeout/orders/${encodeURIComponent(bookingCode)}/receipt`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            285   }, [normalizedStatus, bookingCode, router]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            308           ? `/takeout/orders/${encodeURIComponent(bookingCode)}/track`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            309           : `/takeout/orders/${encodeURIComponent(bookingCode)}/receipt`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            338               {bookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            347                         bookingCode
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     15   booking_code?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     23   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     34   params: { bookingCode: string };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     53 function buildReceiptUrl(bookingCode: string): string {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     55     return `/takeout/orders/${encodeURIComponent(bookingCode)}/receipt`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     58     bookingCode
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     63   const bookingCode = decodeURIComponent(params.bookingCode || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     79     if (!bookingCode) return;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     90           `/api/orders/${encodeURIComponent(bookingCode)}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    105         const o: Order = (body.booking ?? body.order ?? body) as Order;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    120               (r) => r.booking_code === bookingCode
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    158   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    194         `/api/orders/${encodeURIComponent(bookingCode)}/rating`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    231       const url = buildReceiptUrl(bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    291                   {order.booking_code ?? bookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       15   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       27   params: { bookingCode: string };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       38   const bookingCode = decodeURIComponent(params.bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       50         const res = await fetch(`/api/orders/${encodeURIComponent(bookingCode)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       55         const o: Order = (data.booking ?? data.order ?? data) as Order;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       66   }, [bookingCode]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                      113             Order code: {bookingCode}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                      124             as we wire driver GPS for takeout.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                            8   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                           20   driver_payout?: number | string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                           60   "order_accepted",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                           65   "driver_arrived",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                          174                   order.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                          180                     {order.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                          222                   order.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                          228                     {order.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\page.tsx                                                  43   const res = await fetch(url, { method: "GET", headers: { Accept: "application/json" } });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\page.tsx                                                 292       // Snapshot payload (menu) ÃƒÂ¢Ã¢â€šÂ¬Ã¢â‚¬Â Phase 2D will lock this into bookings l...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\page.tsx                                                 329         j?.order_id || j?.orderId || j?.booking_id || j?.bookingId || j?.id || "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                    26   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                    38   booking_code: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                    76   const [payoutRequests, setPayoutRequests] = useState<PayoutRequest[]>([]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   125           booking_code: o.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   139             booking_code: t.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   148         const prRows: PayoutRequest[] = (json.payoutRequests ?? []).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   160         setPayoutRequests(prRows);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   263         const prRows: PayoutRequest[] = (reloadJson.payoutRequests ?? []).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   275         setPayoutRequests(prRows);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   446                 <th className="p-2">Booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   457                   <td className="p-2">{o.booking_code}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   490                 <th className="p-2">Booking</th>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   500                   <td className="p-2">{t.booking_code ?? "-"}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   511         <h2 className="text-lg font-semibold mb-2">Payout Requests</h2>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   512         {payoutRequests.length === 0 ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   514             You have no payout requests yet.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   528               {payoutRequests.map((r) => (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payouts\page.tsx                                    7   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payouts\page.tsx                                   16   driver_payout: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                   11   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                   20   driver_payout: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                  219         "booking_code",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                  256           escapeCsvField(o.booking_code || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                  503                           {order.booking_code}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                  529                               order.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\test\live-location-map\page.tsx                                   11   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\test\live-location-map\page.tsx                                  146         <div>Driver: JRIDE-PROD-001</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\types\booking.ts                                                   1 export type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                             7 type VendorOrderStatus = "preparing" | "driver_arrived" | "picked_up" | "completed";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                            11   bookingCode: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                            31   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           136   const VENDOR_FLOW_UI = ["preparing", "driver_arrived", "picked_up", "completed"] as const;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           199       const pos = await new Promise<GeolocationPosition>((resolve, reject) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           200         navigator.geolocation.getCurrentPosition(resolve, reject, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           257         { method: "GET", headers: { Accept: "application/json" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           270         bookingCode: normText(o.booking_code),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           308       case "driver_arrived":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           379         headers: { Accept: "application/json" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           573                           <td className="px-3 py-2 font-semibold text-slate-900">{o.booking...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           599     onClick={() => handleStatusUpdate(o, "driver_arrived")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           606                               {o.status === "driver_arrived" && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\vendor-orders\page.tsx                                           648                         <span className="font-semibold text-slate-900">{o.bookingCode}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                    9   reject_reason: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                   53         .select("id,status,reject_reason,id_photo_url,selfie_photo_url")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  158     setMessage("Verification submitted. Dispatcher will review first, then Admin will verif...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  164         return "Submitted (waiting for dispatcher review)";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  165       case "pre_approved_dispatcher":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  169       case "rejected":
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  170         return "REJECTED - check reason and re-submit";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  202         {current?.status === "rejected" && current.reject_reason && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  204             Reason: {current.reject_reason}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  239             <option value="Driver's License">Driver&apos;s License</option>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  262             accept="image/*"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\verify\page.tsx                                                  280             accept="image/*"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  138   const canAcceptBookings = () => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  148   const showBookingLocked = () => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  195              user.user_type === 'driver' ? 'Driver Account' : 'Vendor Account'}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  203               <span className="text-sm">âš  Low Wallet Balance, please top-up to continue a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  208         {showBookingLocked() && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  212               <span className="text-sm">ðŸš« Booking locked. Minimum â‚±100 balance require...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  224           {(user.user_type === 'driver' || user.user_type === 'vendor') && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  381               {user.user_type === 'driver' ? 'Driver' : 'Vendor'} Requirements
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  385               <li>â€¢ Minimum balance to accept bookings: â‚±100</li>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\wallet\page.tsx                                                  397               <li>â€¢ No booking limits</li>


PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app\api -Recurse -File -Include *.ts |
>>   Select-String -SimpleMatch -Pattern "driver","quote","fare","matrix","approve","accept","reject","cancel","assign","booking","status" |
>>   Select-Object Path, LineNumber, Line |
>>   Sort-Object Path, LineNumber

Path                                                                                                 LineNumber Line
----                                                                                                 ---------- ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\_diag\auth-env\route.ts                                      7     // NEW names (these are the only ones we will accept)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\active-trips\route.ts                                 12     .order('driver_updated_at', { ascending: false });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\active-trips\route.ts                                 16     return Response.json({ error }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               10     const bookingId = (url.searchParams.get("bookingId") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               11     const bookingCode = (url.searchParams.get("bookingCode") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               13     if (!bookingId && !bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               14       return NextResponse.json({ logs: [] }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               18       .from("booking_assignment_log")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               19       .select("id, created_at, booking_id, booking_code, from_driver_id, to_driver_id, source...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               23     if (bookingId) q = q.eq("booking_id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               24     else q = q.eq("booking_code", bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               29       console.error("ADMIN_ASSIGNMENT_LOG_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               30       return NextResponse.json({ error: "ADMIN_ASSIGNMENT_LOG_ERROR", message: error.message,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               33     return NextResponse.json({ logs: data ?? [] }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               35     console.error("ADMIN_ASSIGNMENT_LOG_UNEXPECTED", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               37       { error: "ADMIN_ASSIGNMENT_LOG_UNEXPECTED", message: err?.message ?? "Unexpected error"...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\assignment-log\route.ts                               38       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        15   const bookingCode = searchParams.get("bookingCode");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        17   if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        19       { ok: false, code: "MISSING_BOOKING", message: "bookingCode required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        20       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        25     .from("dispatch_assign_audit")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        27     .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\audit\route.ts                                        34       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   9 const MAX_DRIVERS = 8;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  11 type Booking = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  15   status: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  18 type DriverLocation = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  19   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  40   drivers: DriverLocation[]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  41 ): Promise<{ driver_id: string; duration: number }[]> {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  42   if (!drivers.length) return [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  44   // Mapbox matrix: coord0;coord1;...;pickup
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  46     ...drivers.map((d) => `${d.lng},${d.lat}`),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  50   const destinationsIndex = drivers.length; // last coord is pickup
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  52   const url = `https://api.mapbox.com/directions-matrix/v1/mapbox/driving/${allCoords}?source...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  58     console.error("MAPBOX_MATRIX_ERROR", res.status, await res.text());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  68   return drivers.map((driver, idx) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  72       driver_id: driver.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  81     const { booking_id } = body as { booking_id: string };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  83     if (!booking_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  85         { success: false, error: "Missing booking_id" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  86         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  92     // 1) Load booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  93     const { data: booking, error: bookingError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  94       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  95       .select("id, pickup_lat, pickup_lng, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  96       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  97       .single<Booking>();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                  99     if (bookingError || !booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 100       console.error("AUTO_ASSIGN_BOOKING_ERROR", bookingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 102         { success: false, error: "Booking not found" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 103         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 108       booking.pickup_lat == null ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 109       booking.pickup_lng == null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 112         { success: false, error: "Booking missing pickup coordinates" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 113         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 117     // 2) Get online drivers
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 118     const { data: driverLocs, error: driverError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 119       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 120       .select("driver_id, lat, lng, is_online")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 123     if (driverError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 124       console.error("AUTO_ASSIGN_DRIVER_LOC_ERROR", driverError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 126         { success: false, error: "Failed to load driver locations" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 127         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 131     const drivers: DriverLocation[] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 132       (driverLocs || [])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 135           driver_id: d.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 140     if (!drivers.length) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 142         { success: false, error: "No online drivers available" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 143         { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 148     const withDist = drivers.map((d) => ({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 150       km: haversineKm(booking.pickup_lat, booking.pickup_lng, d.lat, d.lng),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 155     const candidates = withDist.slice(0, MAX_DRIVERS);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 159       { lat: booking.pickup_lat, lng: booking.pickup_lng },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 164       driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 169       { driver_id: null, duration: Number.MAX_SAFE_INTEGER }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 172     if (!best.driver_id || !Number.isFinite(best.duration)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 174         { success: false, error: "Could not determine best driver" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 175         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 179     // 5) Assign and move to in_progress
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 181       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 183         assigned_driver_id: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 184         status: "in_progress",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 187       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 188       .select("id, booking_code, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 192       console.error("AUTO_ASSIGN_UPDATE_ERROR", updateError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 194         { success: false, error: "Failed to assign driver" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 195         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 202         booking: updated,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 203         chosen_driver_id: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 206       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 209     console.error("AUTO_ASSIGN_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                 212       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                13 function bad(code: string, message: string, status = 400, extra: any = {}) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                16     { status, headers: { "Cache-Control": "no-store" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                27 async function finalizeTripSafe(input: { bookingCode?: string; bookingId?: string }) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                30   const code = (input.bookingCode || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                31   const id = (input.bookingId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                36     attempts.push({ booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                37     attempts.push({ p_booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                38     attempts.push({ in_booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                39     attempts.push({ _booking_code: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                41     attempts.push({ bookingCode: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                44     attempts.push({ booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                45     attempts.push({ p_booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                46     attempts.push({ in_booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                47     attempts.push({ _booking_id: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                49     attempts.push({ bookingId: id });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                67     const bookingCode = (body?.bookingCode as string | undefined) || undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                68     const bookingId = (body?.bookingId as string | undefined) || undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                70     if (!bookingCode && !bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                71       return bad("MISSING_IDENTIFIER", "bookingCode (or bookingId) is required", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                74     console.log("COMPLETE_TRIP_API_START", { bookingCode: bookingCode || null, bookingId: boo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                76     const res = await finalizeTripSafe({ bookingCode, bookingId });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\complete-trip\route.ts                                82         "Finalize RPC failed. This route does not directly update bookings.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\debug-livetrips\route.ts                              20         { status: 500 },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\debug-livetrips\route.ts                              30       { status: 200 },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\debug-livetrips\route.ts                              36       { status: 500 },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              12     const bookingId: string | undefined = body.bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              16     if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              17       return NextResponse.json({ error: "Missing bookingId" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              24       console.error("ASSIGN_ROUTE: Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY env.");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              27         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              33     let driverId: string | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              35     // Try auto-assign only if we have coordinates
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              38         "select_next_available_driver",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              43         console.error("ASSIGN_ROUTE RPC ERROR:", rpcError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              45         driverId = (data as string | null) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              49     // Update booking (DB trigger enforces wallet lock)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              51       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              53         status: "assigned",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              54         assigned_driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              56       .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              60       console.error("ASSIGN_ROUTE UPDATE ERROR:", updateError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              65           { error: "wallet_locked", message: msg, driverId },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              66           { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              70       return NextResponse.json({ error: msg }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              73     return NextResponse.json({ success: true, driverId });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              75     console.error("ASSIGN_ROUTE FATAL ERROR:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\assign\route.ts                              78       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               15   const bookingCode = searchParams.get("bookingCode");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               17   if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               19       { ok: false, code: "MISSING_BOOKING", message: "bookingCode required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               20       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               25     .from("dispatch_assign_audit")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               27     .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\audit\route.ts                               34       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            10   const { bookingId } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            12   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            14       { error: "Missing bookingId" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            15       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            20     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            21     .update({ status: "completed" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            22     .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\drop-off\route.ts                            26     return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          10   const { bookingId } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          12   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          14       { error: "Missing bookingId" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          15       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          20     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          21     .update({ status: "on_the_way" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          22     .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\on-the-way\route.ts                          26     return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          10   const { bookingId } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          12   if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          14       { error: "Missing bookingId" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          15       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          20     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          21     .update({ status: "on_trip" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          22     .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\dispatch\start-trip\route.ts                          26     return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             30     // 1) table/view: driver_locations
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             31     // 2) fallback: drivers (if you store latest coords there)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             35       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             43         .from("drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             52           { ok: false, error: msg, drivers: [], driver_locations: [], data: [] },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             53           { status: 500, headers: { "Cache-Control": "no-store" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             59       { ok: true, drivers: rows, driver_locations: rows, data: rows },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             60       { status: 200, headers: { "Cache-Control": "no-store" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             64       { ok: false, error: e?.message || String(e), drivers: [], driver_locations: [], data: [...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver_locations\route.ts                             65       { status: 500, headers: { "Cache-Control": "no-store" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                              1 // app/api/admin/driver-locations/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                              2 // Admin view of driver_locations table in Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             23 // GET /api/admin/driver-locations?status=online (status optional)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             28     const status = searchParams.get("status");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             30     let url = `${supabaseUrl}/rest/v1/driver_locations?select=*`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             31     if (status) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             32       url += `&status=eq.${encodeURIComponent(status)}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             44       console.error("Supabase driver_locations GET error:", data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             49           message: "Failed to load driver_locations from Supabase",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             52         { status: res.status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             61       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             64     console.error("driver-locations unexpected error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             68         error: "DRIVER_LOCATIONS_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             69         message: "Unexpected error while fetching driver locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-locations\route.ts                             71       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  21     // If your function is public.admin_auto_approve_driver_payouts(limit int) return json, u...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  22     const { data, error } = await sb.rpc("admin_auto_approve_driver_payouts", { p_limit: limi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  28           message: "Auto-approve failed on server.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  31         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  39     const approved = Number(r.approved_count || r.approved || 0);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  47     if (checked === 0 && approved === 0 && skippedIns === 0 && skippedOther === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  48       message = "Nothing to auto-approve (no pending payouts).";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  49     } else if (approved === 0 && skippedIns > 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  52       message = `Auto-approve complete. Approved ${approved}. Skipped insufficient ${skippedI...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  61       approved_count: approved,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  67       { ok: false, message: e?.message || "Auto-approve failed (unexpected)." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\auto-approve\route.ts                  68       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                         5   if (!rows.length) return "id,driver_id,amount,status,requested_at,processed_at,processed_by...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                         6   const cols = ["id","driver_id","amount","status","requested_at","processed_at","processed_b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        21   const status = searchParams.get("status");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        24   let q = sb.from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        25     .select("id,driver_id,amount,status,requested_at,processed_at,processed_by,admin_note")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        31   if (status && status !== "all") q = q.eq("status", status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        34   if (error) return NextResponse.json({ error: error.message }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        38     status: 200,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\export\route.ts                        41       "Content-Disposition": `attachment; filename="driver_payouts_export.csv"`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               11 function jsonOk(body: any, status = 200) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               12   return NextResponse.json(body, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               15 function jsonErr(code: string, message: string, status: number, extra?: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               16   return NextResponse.json({ ok: false, code, message, ...(extra || {}) }, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               21   qs.set("select", "id,driver_id,amount,status,requested_at,processed_at,payout_method,payout...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               25   const url = SUPABASE_URL + "/rest/v1/driver_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               32   if (!res.ok) return { ok: false, status: res.status, text };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               48   qs.set("select", "id,driver_id,amount,status,requested_at,processed_at,payout_method,payout...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               50   const url = SUPABASE_URL + "/rest/v1/driver_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               64   if (!res.ok) return { ok: false, status: res.status, text };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               74     const status = (url.searchParams.get("status") || "pending").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               81     qs.set("select", "id,driver_id,amount,status,requested_at,processed_at,payout_method,payo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               84     if (status && status !== "all") qs.set("status", "eq." + status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               86     const restUrl = SUPABASE_URL + "/rest/v1/driver_payout_requests?" + qs.toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               93     if (!res.ok) return NextResponse.json({ error: text }, { status: res.status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               95     return new NextResponse(text, { status: 200, headers: { "Content-Type": "application/json...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                               97     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              103   action?: "approve" | "reject" | "mark_paid" | string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              129     const currentStatus = String(cur.row.status || "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              131     let targetStatus: string | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              132     if (action === "approve") targetStatus = "approved";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              133     else if (action === "reject") targetStatus = "rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              134     else if (action === "mark_paid") targetStatus = "paid";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              135     else return jsonErr("BAD_REQUEST", "Invalid action (approve|reject|mark_paid)", 400, { ac...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              137     if (currentStatus === targetStatus) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              138       return jsonOk({ ok: true, changed: false, idempotent: true, id, status: currentStatus, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              141     if ((targetStatus === "approved" || targetStatus === "rejected") && currentStatus !== "pe...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              144         "Cannot " + targetStatus + " when status is " + currentStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              146         { id, current_status: currentStatus, target_status: targetStatus }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              150     if (targetStatus === "paid" && !(currentStatus === "approved" || currentStatus === "pendi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              153         "Cannot mark_paid when status is " + currentStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              155         { id, current_status: currentStatus, target_status: targetStatus }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              160       status: targetStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\driver-payouts\route.ts                              171     return jsonOk({ ok: true, changed: true, id, status: targetStatus, row: upd.row });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                       4   // Temporary stub: no separate drivers table in prod yet.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                       5   // Dispatch UI will fall back to showing assigned_driver_id codes.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                       8       drivers: [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                      11     console.error("DRIVERS_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                      14         error: "DRIVERS_UNEXPECTED_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                      15         message: err?.message ?? "Unexpected error while loading drivers.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\drivers\route.ts                                      17       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                12  * Admin / Dispatcher fare override & verification endpoint.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                16  *   "bookingCode": "JR-2025-0002",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                17  *   "verifiedFare": 75,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                19  *   "reason": "Corrected per fare matrix" // optional
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                26     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                27     const verifiedFare: number | undefined = body?.verifiedFare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                31     if (!bookingCode || typeof verifiedFare !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                34         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                39       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                41         verified_fare: verifiedFare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                46       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                51       console.error("FARE_OVERRIDE_UPDATE_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                54         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                58     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                60     console.error("FARE_OVERRIDE_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                63       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                             4 type ActionName = "NUDGE_DRIVER" | "REASSIGN_DRIVER" | "AUTO_ASSIGN" | "ARCHIVE_TEST_TRIPS";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            38     return NextResponse.json({ ok: false, code: "BAD_JSON" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            42   const booking_code = body?.booking_code ? String(body.booking_code) : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            45   if (!action || !["NUDGE_DRIVER", "REASSIGN_DRIVER", "AUTO_ASSIGN", "ARCHIVE_TEST_TRIPS"].in...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            46     return NextResponse.json({ ok: false, code: "BAD_ACTION", action }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            48   if (!booking_code && !trip_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            49     return NextResponse.json({ ok: false, code: "MISSING_ID" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            52   // Load booking row (schema-safe: we inspect returned keys)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            53   const bookingQuery = supabase.from("bookings").select("*").limit(1);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            54   const bookingRes = booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            55     ? await bookingQuery.eq("booking_code", booking_code).maybeSingle()
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            56     : await bookingQuery.eq("id", trip_id).maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            58   if (bookingRes.error) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            59     return NextResponse.json({ ok: false, code: "BOOKING_LOAD_ERROR", error: bookingRes.error...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            61   const b = bookingRes.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            63     return NextResponse.json({ ok: false, code: "BOOKING_NOT_FOUND", booking_code, trip_id },...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            75     // Bulk cleanup: archive TEST-% trips still in active statuses.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            77     const active = ["pending", "assigned", "on_the_way", "arrived", "enroute", "on_trip"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            79     const patch2: Record<string, any> = { status: "completed" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            83       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            85       .ilike("booking_code", "TEST-%")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            86       .in("status", active);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            94       return NextResponse.json({ ok: false, code: "ARCHIVE_FAILED", message: error.message },...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            98 if (action === "NUDGE_DRIVER") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                            99     // Non-destructive: just bump updated_at so stale watchers can clear when driver is actua...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           100     return NextResponse.json({ ok: true, action, booking_code: b.booking_code ?? booking_code...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           103   if (action === "REASSIGN_DRIVER") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           104     // Clear driver link + reset status to assigned
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           105     if (can("assigned_driver_id")) patch.assigned_driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           106     if (can("driver_id")) patch.driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           108     if (can("status")) patch.status = "assigned";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           110     const upd = await supabase.from("bookings").update(patch).eq("id", b.id).select("*").mayb...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           112       return NextResponse.json({ ok: false, code: "UPDATE_FAILED", error: upd.error.message }...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           114     return NextResponse.json({ ok: true, action, booking_code: upd.data?.booking_code ?? b.bo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           117   if (action === "AUTO_ASSIGN") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           121       return NextResponse.json({ ok: false, code: "MISSING_PICKUP_COORDS" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           124     // Load driver locations (we do best-effort column usage)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           125     const dl = await supabase.from("driver_locations").select("*").limit(500);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           127       return NextResponse.json({ ok: false, code: "DRIVER_LOCATIONS_ERROR", error: dl.error.m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           135       const did = r?.driver_id ?? r?.id ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           136       const rlat = num(r?.lat) ?? num(r?.latitude) ?? num(r?.driver_lat) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           137       const rlng = num(r?.lng) ?? num(r?.longitude) ?? num(r?.driver_lng) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           143         best = { driver_id: did, lat: rlat, lng: rlng };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           148       return NextResponse.json({ ok: false, code: "NO_DRIVER_CANDIDATES" }, { status: 404 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           151     // Apply assignment (use whichever column exists)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           152     if (can("assigned_driver_id")) patch.assigned_driver_id = best.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           153     else if (can("driver_id")) patch.driver_id = best.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           155     // Ensure status assigned
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           156     if (can("status")) patch.status = "assigned";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           158     const upd = await supabase.from("bookings").update(patch).eq("id", b.id).select("*").mayb...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           160       return NextResponse.json({ ok: false, code: "ASSIGN_FAILED", error: upd.error.message }...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           166       booking_code: upd.data?.booking_code ?? b.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           167       assigned_driver_id: upd.data?.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           168       driver_id: upd.data?.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           169       booking: upd.data,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\actions\route.ts                           173   return NextResponse.json({ ok: false, code: "UNREACHABLE" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    8 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                    9   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  183 async function schemaSafeUpdateBooking(admin: any, id: string, initial: Record<string, any>) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  187     const res = await admin.from("bookings").update(payload).eq("id", id).select("id").single();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  192     const m = msg.match(/Could not find the '([^']+)' column of 'bookings' in the schema cach...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  222   // Only touch active bookings (donâ€™t mutate completed/cancelled history)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  223   const ACTIVE = ["pending", "assigned", "on_the_way", "arrived", "enroute", "on_trip", "requ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  229     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  231     .in("status", ACTIVE)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\backfill-takeout\route.ts                  323     const upd = await schemaSafeUpdateBooking(admin, id, patch);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         6 type BookingRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         8   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                         9   status: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        10   assigned_driver_id: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        20 type DriverLocationRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        21   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        24   status?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        31     const bookingId = req.nextUrl.searchParams.get("bookingId");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        33     if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        36           error: "MISSING_BOOKING_ID",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        37           message: "bookingId is required.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        39         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        45     // 1) Load the booking with all fields we care about
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        46     const { data: booking, error: bookingError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        47       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        51         booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        52         status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        53         assigned_driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        63       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        66     if (bookingError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        67       console.error("BOOKING_MAP_DB_ERROR_BOOKING", bookingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        70           error: "BOOKING_MAP_DB_ERROR_BOOKING",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        71           message: bookingError.message,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        73         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        77     if (!booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        80           error: "BOOKING_NOT_FOUND",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        81           message: "Booking not found.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        83         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        87     const bookingRow = booking as BookingRow;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        89     // 2) Load assigned driver location if present
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        90     let driverLocation: DriverLocationRow | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        92     if (bookingRow.assigned_driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        93       const { data: driverRow, error: driverError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        94         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        95         .select("driver_id, lat, lng, status, town, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        96         .eq("driver_id", bookingRow.assigned_driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                        99       if (driverError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       100         console.error("BOOKING_MAP_DB_ERROR_DRIVER", driverError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       102       } else if (driverRow) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       103         driverLocation = driverRow as DriverLocationRow;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       109         booking: bookingRow,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       110         driverLocation,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       112       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       115     console.error("BOOKING_MAP_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       118         error: "BOOKING_MAP_UNEXPECTED_ERROR",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       119         message: err?.message ?? "Unexpected error while loading booking map.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\booking-map\route.ts                       121       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                    7   driverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   11 type ReassignBody = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   12   action: "reassign";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   14   fromDriverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   15   toDriverId: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   25 type Body = NudgeBody | ReassignBody | EmergencyBody;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   36       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   42       const { data, error } = await supabase.rpc("admin_nudge_driver", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   44         p_driver_id: body.driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   49         console.error("admin_nudge_driver error:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   51           { error: error.message || "Failed to nudge driver." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   52           { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   57         { message: "Nudge sent to driver.", data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   58         { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   62     if (body.action === "reassign") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   63       const { data, error } = await supabase.rpc("admin_reassign_trip", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   65         p_from_driver_id: body.fromDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   66         p_to_driver_id: body.toDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   71         console.error("admin_reassign_trip error:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   73           { error: error.message || "Failed to reassign trip." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   74           { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   79         { message: "Trip reassign saved.", data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   80         { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                   94           { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                  105         { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                  111       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\dispatch-actions\route.ts                  117       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                       5   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                       6   driver_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      21   const booking_code = norm(body.booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      22   const driver_id = norm(body.driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      24   if (!booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      25     return NextResponse.json({ ok: false, code: "MISSING_BOOKING_CODE", message: "Missing boo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      27   if (!driver_id || !isUuid(driver_id)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      28     return NextResponse.json({ ok: false, code: "MISSING_DRIVER_ID", message: "Missing/invali...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      31   const br = await supabase.from("bookings").select("*").eq("booking_code", booking_code).may...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      34       { ok: false, code: "BOOKING_NOT_FOUND", message: br.error?.message || "Booking not foun...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      35       { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      40   const status = norm(b.status).toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      43   if (status === "completed" || status === "cancelled") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      45       { ok: false, code: "NOT_ASSIGNABLE", message: "Booking is not assignable: " + status, b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      46       { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      50   // avoid overwriting active driver assignment unless it is still requested
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      51   const alreadyHasDriver = !!b.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      52   if (alreadyHasDriver && status && status !== "requested") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      54       { ok: false, code: "ALREADY_ASSIGNED", message: "Booking already has driver and is not ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      55       { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      60     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      61     .update({ driver_id, status: "assigned" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      68       { ok: false, code: "UPDATE_FAILED", message: upd.error.message, booking_code, driver_id },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      69       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      75     assigned: true,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      76     booking_id: String(b.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      77     booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      78     driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      79     status: "assigned",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\manual-assign\route.ts                      80     booking: upd.data ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                          34 function bad(message: string, code: string, status = 400, extra: any = {}) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                          37     { status, headers: { "Cache-Control": "no-store" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                          41 function ok(payload: any, status = 200) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                          43     status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                          66     const t2 = (payload as any).bookings;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         102         .map((t: any) => pick(t, ["booking_code", "bookingCode", "code"]))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         109         .map((t: any) => pick(t, ["id", "uuid", "booking_id", "bookingId"]))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         114     const ACTIVE_STATUSES = ["requested", "assigned", "on_the_way", "arrived", "enroute", "on...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         118         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         120         .in("status", ACTIVE_STATUSES)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         129           const bcode = b?.booking_code != null ? String(b.booking_code) : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         136             booking_id: bid || null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         137             booking_code: bcode || null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         138             status: b?.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         141             driver_id: b?.driver_id ?? (b as any)?.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         169         ? { ...(rpcData as any), trips, __debug: debug ? { injected_active_statuses: ACTIVE_S...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\page-data\route.ts                         170         : { trips, __debug: debug ? { injected_active_statuses: ACTIVE_STATUSES } : undefined };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            18         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            22     // Get bookings with status 'pending' or 'searching' and no assigned driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            24       "status=in.(pending,searching,arrived)&assigned_driver_id=is.null&order=created_at.asc";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            25     const url = `${SUPABASE_URL}/rest/v1/bookings?${query}&select=id,booking_code,status,assi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            53         res.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            59           status: res.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            62         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            66     const bookings = Array.isArray(json) ? json : [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            71         bookings,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            73       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\pending\route.ts                            82       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       12   // Cancel broken live trips (missing booking_code)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       13   // NOTE: Only update status to avoid assuming optional columns exist.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       15     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       16     .update({ status: "cancelled" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       17     .in("status", ["assigned", "on_the_way", "on_trip"])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       18     .or("booking_code.is.null,booking_code.eq.")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       19     .select("id, booking_code, status");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       31     return NextResponse.json({ ok: false, error: error.message }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\purge-broken\route.ts                       45         criteria: { statusIn: ["assigned", "on_the_way", "on_trip"], booking_code_missing: tr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                    28         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                    34         bookings: data ?? [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                    36       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\route.ts                                    45       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            18         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            28       "id,booking_code,status,assigned_driver_id,created_at,pickup_lat,pickup_lng";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            30     // Pending: pending / searching with no assigned driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            33       "status=in.(pending,searching,arrived)",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            34       "assigned_driver_id=is.null",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            37     const pendingUrl = `${SUPABASE_URL}/rest/v1/bookings?${pendingQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            40     const activeStatuses =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            41       "assigned,driver_accepted,driver_arrived,passenger_onboard,in_transit,dropoff";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            44       `status=in.(${activeStatuses})`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            47     const activeUrl = `${SUPABASE_URL}/rest/v1/bookings?${activeQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            54       "status=eq.completed",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            58     const completedUrl = `${SUPABASE_URL}/rest/v1/bookings?${completedQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            60     // Drivers for map
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            61     const driverSelect = "driver_id,lat,lng,status,updated_at";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            62     const driverQuery = [
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            63       `select=${driverSelect}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            66     const driversUrl = `${SUPABASE_URL}/rest/v1/driver_locations?${driverQuery}`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            68     const [pendingRes, activeRes, completedRes, driversRes] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            73         fetch(driversUrl, { headers: baseHeaders, cache: "no-store" }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            76     const [pendingRaw, activeRaw, completedRaw, driversRaw] =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                            81         driversRes.text(),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           109         pendingRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           116         activeRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           123         completedRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           127     if (!driversRes.ok) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           129         "[admin/livetrips/summary] Drivers error:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           130         driversRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           131         driversRaw
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           142     const drivers = driversRes.ok
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           143       ? parseJsonArray(driversRaw, "drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           152         drivers,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           154       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\summary\route.ts                           163       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                       7 // All statuses we allow updates to
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                       8 const ALLOWED_STATUSES = [
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      11   "assigned",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      12   "driver_accepted",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      13   "driver_arrived",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      24         "[admin/livetrips/update-status] Missing SUPABASE_URL or SUPABASE_ANON_KEY env vars"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      28         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      34     const bookingId: string | undefined = body?.bookingId;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      35     const nextStatus: string | undefined = body?.nextStatus;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      37     if (!bookingId || !nextStatus) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      41           message: "bookingId and nextStatus are required",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      43         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      47     if (!ALLOWED_STATUSES.includes(nextStatus)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      50           error: "INVALID_STATUS",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      51           message: `nextStatus must be one of: ${ALLOWED_STATUSES.join(", ")}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      53         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      57     const url = `${SUPABASE_URL}/rest/v1/bookings?id=eq.${encodeURIComponent(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      58       bookingId
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      69       body: JSON.stringify({ status: nextStatus }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      79         "[admin/livetrips/update-status] Failed to parse Supabase response JSON:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      88         "[admin/livetrips/update-status] Supabase error:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      89         res.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      95           status: res.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                      98         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                     106       { ok: true, booking: updatedRow },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                     107       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                     110     console.error("[admin/livetrips/update-status] SERVER ERROR:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\livetrips\update-status\route.ts                     116       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                10     const { booking_id, driver_id } = body as {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                11       booking_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                12       driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                15     if (!booking_id || !driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                17         { success: false, error: "Missing booking_id or driver_id" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                18         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                25       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                27         assigned_driver_id: driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                28         status: "in_progress",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                31       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                32       .select("id, booking_code, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                36       console.error("MANUAL_ASSIGN_DB_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                39         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                44       { success: true, booking: data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                45       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                48     console.error("MANUAL_ASSIGN_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\manual-assign\route.ts                                51       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\approve\route.ts                              11     if (!requestId) return NextResponse.json({ error: "Missing requestId" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\approve\route.ts                              16       return NextResponse.json({ error: "Missing SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY" },...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\approve\route.ts                              27       return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\approve\route.ts                              31       return NextResponse.json({ ok: false, ...data }, { status: 409 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\approve\route.ts                              36     return NextResponse.json({ error: e?.message ?? "Unexpected error" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                               11     if (!requestId) return NextResponse.json({ error: "Missing requestId" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                               16       return NextResponse.json({ error: "Missing SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY" },...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                               20     const { data, error } = await supabase.rpc("admin_reject_payout_v1", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                               27       return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                               31       return NextResponse.json({ ok: false, ...data }, { status: 409 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\payouts\reject\route.ts                               36     return NextResponse.json({ error: e?.message ?? "Unexpected error" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     41     const bookingCode = String(body?.bookingCode || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     42     const toDriverId = String(body?.toDriverId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     43     const reason = String(body?.reason || "auto_reassign").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     46     if (!bookingCode) return NextResponse.json({ error: "bookingCode required" }, { status: 4...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     47     if (!toDriverId) return NextResponse.json({ error: "toDriverId required" }, { status: 400...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     52     // resolve booking id by code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     54       `/rest/v1/bookings?select=id&booking_code=eq.${encodeURIComponent(bookingCode)}&limit=1`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     56     const bookingId = b?.[0]?.id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     57     if (!bookingId) return NextResponse.json({ error: `booking not found: ${bookingCode}` }, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     60     const result = await sbPOST(url, srk, `/rest/v1/rpc/admin_reassign_driver`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     61       p_booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     62       p_to_driver_id: toDriverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\route.ts                                     69     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             35     const bookingCode = String(body?.bookingCode || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             36     if (!bookingCode) return NextResponse.json({ error: "bookingCode required" }, { status: 4...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             41     // Booking info (your schema uses from_label/to_label + pickup_lat/lng)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             42     const bookings = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             43       `/rest/v1/bookings?select=id,booking_code,status,assigned_driver_id,driver_id,pickup_la...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             45     const b = bookings?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             46     if (!b?.id) return NextResponse.json({ error: `booking not found: ${bookingCode}` }, { st...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             48     const currentDriver = b.assigned_driver_id || b.driver_id || null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             53       return NextResponse.json({ error: "booking pickup_lat/pickup_lng missing" }, { status: ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             56     // Driver live locations:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             57     // We use mv_driver_live if available, else driver_locations
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             58     // Try mv_driver_live first
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             59     let drivers: any[] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             61       drivers = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             62         `/rest/v1/mv_driver_live?select=driver_id,lat,lng,updated_at,status&limit=2000`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             65       drivers = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             66         `/rest/v1/driver_locations?select=driver_id,lat,lng,updated_at&limit=2000`
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             70     // Busy drivers = drivers assigned to any active booking
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             71     const busyBookings = await sbGET(url, srk,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             72       `/rest/v1/bookings?select=assigned_driver_id,driver_id,status&id=neq.${encodeURICompone...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             75     for (const x of busyBookings || []) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             76       const d = x.assigned_driver_id || x.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             80     const out = (drivers || [])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             82         const driverId = String(d.driver_id || d.id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             85         if (!driverId || !Number.isFinite(lat) || !Number.isFinite(lng)) return null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             86         if (currentDriver && driverId === String(currentDriver)) return null; // exclude curr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             87         if (busySet.has(driverId)) return null; // exclude busy
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                             90           driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                            100       booking: { id: b.id, booking_code: b.booking_code, status: b.status, current_driver: cu...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                            101       drivers: out,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                            102       excluded_current_driver: currentDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                            106     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        32     const bookingCode = u.searchParams.get("booking_code");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        33     const fromDriver = u.searchParams.get("from_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        34     const toDriver = u.searchParams.get("to_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        43     if (bookingCode) filters.push(`booking_code=ilike.*${encodeURIComponent(bookingCode)}*`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        44     if (fromDriver)  filters.push(`from_driver_id=eq.${encodeURIComponent(fromDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        45     if (toDriver)    filters.push(`to_driver_id=eq.${encodeURIComponent(toDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        52       `/rest/v1/admin_reassign_audit?select=id,created_at,created_by,booking_id,booking_code,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        55     const header = ["id","created_at","created_by","booking_id","booking_code","from_driver_i...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        63         csvEscape(r.booking_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        64         csvEscape(r.booking_code),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        65         csvEscape(r.from_driver_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        66         csvEscape(r.to_driver_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        75         "Content-Disposition": `attachment; filename="reassign_audit.csv"`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\export\route.ts                        79     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               26     const bookingCode = u.searchParams.get("booking_code");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               27     const fromDriver = u.searchParams.get("from_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               28     const toDriver = u.searchParams.get("to_driver_id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               38     if (bookingCode) filters.push(`booking_code=ilike.*${encodeURIComponent(bookingCode)}*`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               39     if (fromDriver)  filters.push(`from_driver_id=eq.${encodeURIComponent(fromDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               40     if (toDriver)    filters.push(`to_driver_id=eq.${encodeURIComponent(toDriver)}`);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               46       `/rest/v1/admin_reassign_audit?select=id,created_at,created_by,booking_id,booking_code,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-audit\route.ts                               51     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             35     const bookingId = u.searchParams.get("bookingId");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             36     const bookingCode = u.searchParams.get("bookingCode");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             42     const bookingSelect = "id,booking_code,pickup_lat,pickup_lng,assigned_driver_id,status";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             44     let booking: any = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             46     if (bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             49         `/rest/v1/bookings?select=${bookingSelect}&limit=1&id=eq.${encodeURIComponent(booking...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             51       booking = rows?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             52     } else if (bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             55         `/rest/v1/bookings?select=${bookingSelect}&limit=1&booking_code=eq.${encodeURICompone...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             57       booking = rows?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             59       return NextResponse.json({ error: "Provide bookingId or bookingCode" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             62     if (!booking) return NextResponse.json({ error: "Booking not found" }, { status: 404 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             64     const pickLat = Number(booking.pickup_lat);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             65     const pickLng = Number(booking.pickup_lng);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             66     const currentDriver = String(booking.assigned_driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             69       return NextResponse.json({ error: "Missing pickup_lat/pickup_lng" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             74       `/rest/v1/driver_locations?select=driver_id,lat,lng,updated_at&order=updated_at.desc&li...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             81       const did = String(r.driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             84       // ✅ Exclude the currently assigned driver from suggestions
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             85       if (currentDriver && did === currentDriver) continue;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                             96         driver_id: did,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                            109       booking: {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                            110         id: booking.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                            111         booking_code: booking.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                            114         assigned_driver_id: booking.assigned_driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                            115         status: booking.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign-suggest\route.ts                            122     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                         7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        38 function expectedDriverPayout(b: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        39   const dp = n(b?.driver_payout);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        41   const vf = n(b?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        51     message: "POST { mode: 'dry_run'|'apply' } to backfill missing driver credits (expected p...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        76     // Pull completed bookings with fields needed to compute expected payout
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        77     const { data: bookings, error: bErr } = await admin
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        78       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        79       .select("id,booking_code,status,driver_id,driver_payout,verified_fare,company_cut")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        80       .eq("status", "completed")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        84     if (bErr) return json(500, { ok: false, code: "DB_ERROR", stage: "bookings", message: bEr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        86     const completed = bookings || [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        92     let skipped_no_driver = 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        96       if (!b.driver_id) { skipped_no_driver++; continue; }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                        98       const expected = expectedDriverPayout(b);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       101       // Does a credit-like tx already exist for this booking?
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       103         .from("driver_wallet_transactions")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       105         .eq("booking_id", b.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       109         actions.push({ booking_id: b.id, booking_code: b.booking_code, status: "error_tx_look...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       118         .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       120         .eq("driver_id", b.driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       125         actions.push({ booking_id: b.id, booking_code: b.booking_code, status: "error_balance...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       133         booking_id: b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       134         booking_code: b.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       135         driver_id: b.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       139         reason: "reconcile_backfill " + s(b.booking_code || ""),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       143         actions.push({ ...planned, status: "would_insert" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       148       const { error: insErr } = await admin.from("driver_wallet_transactions").insert({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       149         driver_id: b.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       150         booking_id: b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       159         actions.push({ ...planned, status: "insert_failed", error: insErr.message });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       162         actions.push({ ...planned, status: "inserted" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                       173         skipped_no_driver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            52     const { data: bookings, error: bErr } = await admin
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            53       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            54       .select("id,booking_code,status,service_type,vendor_status,driver_id,vendor_id,updated_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            55       .eq("status", "completed")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            59     if (bErr) return json(500, { ok: false, code: "DB_ERROR", stage: "bookings", message: bEr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            61     const completed = bookings || [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            63     const completedCodes = completed.map((x: any) => x.booking_code).filter(Boolean);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            65     const { data: driverTx, error: dErr } = await admin
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            66       .from("driver_wallet_transactions")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            67       .select("id,driver_id,amount,reason,booking_id,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            68       .in("booking_id", completedIds.length ? completedIds : ["00000000-0000-0000-0000-000000...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            72     if (dErr) return json(500, { ok: false, code: "DB_ERROR", stage: "driver_wallet_transacti...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            76       .select("id,vendor_id,booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            77       .in("booking_code", completedCodes.length ? completedCodes : ["__none__"])
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            84       .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            85       .select("driver_id,balance,last_tx_at,tx_count")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                            90     if (dBalErr) return json(500, { ok: false, code: "DB_ERROR", stage: "driver_wallet_balanc...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           103     // Map booking_id -> credit-like driver tx
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           104     const creditTxByBooking: Record<string, any[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           105     for (const t of driverTx || []) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           106       const bid = s((t as any).booking_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           109       if (!creditTxByBooking[bid]) creditTxByBooking[bid] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           110       creditTxByBooking[bid].push(t);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           114     // 1) driver_payout (if > 0)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           115     // 2) else max(verified_fare - company_cut, 0)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           116     function expectedDriverPayout(b: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           117       const dp = n(b?.driver_payout);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           119       const vf = n(b?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           125     const missing_driver_credits = completed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           126       .filter((b: any) => !!b.driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           127       .map((b: any) => ({ b, expected: expectedDriverPayout(b) }))
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           131         return !creditTxByBooking[bid] || creditTxByBooking[bid].length === 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           134         booking_id: x.b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           135         booking_code: x.b.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           136         driver_id: x.b.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           138         expected_driver_payout: x.expected,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           143     const duplicate_driver_credits = Object.keys(creditTxByBooking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           144       .filter((bid) => (creditTxByBooking[bid]?.length || 0) > 1)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           146         booking_id: bid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           147         count: creditTxByBooking[bid].length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           148         tx: creditTxByBooking[bid].slice(0, 5),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           152     // Vendor: only completed takeout vendor_status=completed, require earning kind
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           155       const code = s((t as any).booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           163       s(b.vendor_status).toLowerCase() === "completed" &&
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           165       !!b.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           170         const code = s(b.booking_code);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           175         booking_code: b.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           176         booking_id: b.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           178         vendor_status: b.vendor_status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           190         booking_code: x.code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           199       driver_tx_seen: (driverTx || []).length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           203       missing_driver_credits_count: missing_driver_credits.length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           204       duplicate_driver_credit_tx_count: duplicate_driver_credits.length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           209       negative_driver_balances_count: (dBal || []).length,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           216       missing_driver_credits,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           217       duplicate_driver_credits,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           220       negative_driver_balances: dBal || [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                           222       note: "Driver missing/duplicate now based on expected payout > 0 and credit-like tx onl...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           16     const driverId = s(url.searchParams.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           24         ? "admin_driver_payout_requests_v1"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           25         : "admin_driver_payout_daily_v1";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           27     // We use select=* and best-effort filtering on driver_id (if exists).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           28     // If the view doesn't contain driver_id, Supabase REST will error.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           29     // To avoid breaking, we only apply driver_id filter when caller provided it AND view lik...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           30     // For requests view, driver_id is expected. For daily view, it is likely but not assumed...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           38     if (driverId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           40       if (source === "admin_driver_payout_requests_v1") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           41         qs.set("driver_id", "eq." + driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           56         { status: res.status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           60     return new NextResponse(text, { status: 200, headers: { "Content-Type": "application/json...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-driver\route.ts                           62     return NextResponse.json({ ok: false, code: "SERVER_ERROR", message: e?.message || String...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-vendor\route.ts                           51         { status: res.status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-vendor\route.ts                           55     return new NextResponse(text, { status: 200, headers: { "Content-Type": "application/json...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\lgu-vendor\route.ts                           57     return NextResponse.json({ ok: false, code: "SERVER_ERROR", message: e?.message || String...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\stuck-drivers\route.ts                        20       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\stuck-drivers\route.ts                        30     `${url.replace(/\/$/, "")}/rest/v1/admin_stuck_driver_scorecard_v1` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\stuck-drivers\route.ts                        31     `?select=driver_id,stuck_24h,stuck_7d,stuck_30d,open_count,avg_minutes,last_detected_at` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reports\stuck-drivers\route.ts                        44     return NextResponse.json({ error: text }, { status: r.status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\ack\route.ts                              32       return NextResponse.json({ error: "logId is required" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\ack\route.ts                              41       `/rest/v1/driver_stuck_alert_log?id=eq.${encodeURIComponent(String(logId))}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\ack\route.ts                              47     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  35       `/rest/v1/driver_stuck_alert_log?select=id,driver_id,first_detected_at,last_detected_at...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  55       let booking: any = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  57       if (l.booking_uuid) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  60           `/rest/v1/bookings?select=id,booking_code,status,assigned_driver_id,pickup_lat,pick...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  62         booking = b?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  63       } else if (l.booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  66           `/rest/v1/bookings?select=id,booking_code,status,assigned_driver_id,pickup_lat,pick...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  68         booking = b?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  72       if (l.driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  75           `/rest/v1/driver_locations?select=driver_id,updated_at&limit=1&driver_id=eq.${encod...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  82         driver_id: l.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  83         booking_id: booking?.id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  84         booking_code: booking?.booking_code ?? l.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  85         status: booking?.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                  86         current_driver: booking?.assigned_driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\route.ts                                 102     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\snooze\route.ts                           34       return NextResponse.json({ error: "logId is required" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\snooze\route.ts                           37       return NextResponse.json({ error: "minutes must be between 1 and 1440" }, { status: 400...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\snooze\route.ts                           48       `/rest/v1/driver_stuck_alert_log?id=eq.${encodeURIComponent(String(logId))}`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\stuck-trips\snooze\route.ts                           54     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           10     const { booking_id, status } = body as {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           11       booking_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           12       status: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           15     if (!booking_id || !status) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           17         { success: false, error: "Missing booking_id or status" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           18         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           25       status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           29     if (status === "completed") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           30       updates.assigned_driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           34       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           36       .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           37       .select("id, booking_code, status, assigned_driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           41       console.error("UPDATE_TRIP_STATUS_DB_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           44         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           48     console.log("UPDATE_TRIP_STATUS_OK", data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           51       { success: true, booking: data },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           52       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           55     console.error("UPDATE_TRIP_STATUS_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\update-trip-status\route.ts                           58       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                    5 function forbid() { return NextResponse.json({ error: "Forbidden" }, { status: 403 }); }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                   14   if (error) return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                   26   if (!email || !/^[^@]+@[^@]+\.[^@]+$/.test(email)) return NextResponse.json({ error: "Valid...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                   27   if (!["admin","dispatcher","user"].includes(newRole)) return NextResponse.json({ error: "ro...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                   31   if (error) return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                   42   if (!email) return NextResponse.json({ error: "email required" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\user-roles\route.ts                                   46   if (error) return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-menu-items\route.ts                             6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-menu-items\route.ts                             7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               11 function jsonOk(body: any, status = 200) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               12   return NextResponse.json(body, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               15 function jsonErr(code: string, message: string, status: number, extra?: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               16   return NextResponse.json({ ok: false, code, message, ...(extra || {}) }, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               21   qs.set("select", "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,reviewed...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               32   if (!res.ok) return { ok: false, status: res.status, text };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               43   qs.set("select", "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,reviewed...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               59   if (!res.ok) return { ok: false, status: res.status, text };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               69     const status = (url.searchParams.get("status") || "pending").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               76     qs.set("select", "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,review...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               79     if (status && status !== "all") qs.set("status", "eq." + status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               88     if (!res.ok) return NextResponse.json({ error: text }, { status: res.status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               90     return new NextResponse(text, { status: 200, headers: { "Content-Type": "application/json...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                               92     return NextResponse.json({ error: e?.message || String(e) }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              125     const currentStatus = String(cur.row.status || "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              128     if (currentStatus === "paid") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              129       return jsonOk({ ok: true, changed: false, idempotent: true, id, status: currentStatus, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              132     // Only allow pending -> paid (safest, avoids unknown status constraints)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              133     if (currentStatus !== "pending") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              134       return jsonErr("INVALID_STATE", "Cannot mark_paid when status is " + currentStatus, 409, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              136         current_status: currentStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              137         target_status: "paid",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              143       status: "paid",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts\route.ts                              153     return jsonOk({ ok: true, changed: true, id, status: "paid", row: upd.row });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts-summary\route.ts                       55         { status: res.status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts-summary\route.ts                       60     return new NextResponse(text, { status: 200, headers: { "Content-Type": "application/json...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendor-payouts-summary\route.ts                       62     return NextResponse.json({ ok: false, code: "SERVER_ERROR", message: e?.message || String...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendors\route.ts                                      18       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendors\route.ts                                      28     return NextResponse.json({ ok: false, error: "DB_ERROR", message: error.message }, { stat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\vendors\route.ts                                      31   return NextResponse.json({ ok: true, vendors: data || [] }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          12 function bad(message: string, code: string, status = 400, extra: any = {}) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          15     { status, headers: { "Cache-Control": "no-store" } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          75 async function fetchBalanceSafe(kind: "driver" | "vendor", id: string) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          76   const rpcName = kind === "driver"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          77     ? "admin_get_driver_wallet_balance_v1"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          81     kind === "driver"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                          82       ? [{ driver_id: id }, { p_driver_id: id }, { in_driver_id: id }, { _driver_id: id }]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                         100     const kind = kindRaw === "driver" || kindRaw === "vendor" ? kindRaw : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                         107     const table = kind === "driver" ? "driver_wallet_transactions" : "vendor_wallet_transacti...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\wallet\transactions\route.ts                         108     const key = kind === "driver" ? "driver_id" : "vendor_id";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\zone-capacity\route.ts                                20         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\zone-capacity\route.ts                                29       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\propose\route.ts                                    7     { ok: false, error: "Bookings propose API is disabled in this build." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\propose\route.ts                                    8     { status: 501 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                    8   return NextResponse.json({ ok: true, route: "/api/bookings/respond" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                   15     // TODO: implement your booking response logic here (e.g., Supabase update)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                   18     //   await supabase.from("bookings").update({ status: action }).eq("id", id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\respond\route.ts                                   24       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\route.ts                                            1 // app/api/bookings/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\route.ts                                           13       { status: 401 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\bookings\route.ts                                           20     message: "bookings endpoint stub",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\debug\supabase\route.ts                                     13       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\debug\supabase\route.ts                                     14       .select("id, driver_id, lat, lng, status, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     4 type AssignReq = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     5   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     6   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    12 const BUSY_STATUSES = ["assigned", "arrived", "on_the_way", "enroute", "on_trip"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    31 function normStatus(v: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    35 async function fetchBookingByIdOrCode(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    37   booking_id?: string | null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    38   booking_code?: string | null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    40   if (booking_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    41     const r = await supabase.from("bookings").select("*").eq("id", booking_id).maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    44   if (booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    45     const r = await supabase.from("bookings").select("*").eq("booking_code", booking_code).ma...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    48   return { data: null, error: "Missing booking_id or booking_code" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    51 async function bestEffortUpdateBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    53   bookingId: string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    56   const r = await supabase.from("bookings").update(patch).eq("id", bookingId).select("*").may...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    61 async function fetchBusyDriverIdsInTown(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    65   // NOTE: we only need driver_id + status; keep select minimal but safe.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    67     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    68     .select("driver_id,status,town")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    70     .in("status", BUSY_STATUSES)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    71     .not("driver_id", "is", null)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    82     const id = row && row.driver_id ? String(row.driver_id) : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    86   return { ok: true, note: "busy drivers in town: " + busy.size, busy };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    89 async function findNearestOnlineFreeDriverInTown(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    95   const busyRes = await fetchBusyDriverIdsInTown(supabase, town);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                    99     .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   102     .eq("status", "online")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   106     return { driver_id: null as string | null, note: "driver_locations query failed: " + r.er...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   110   let best: { driver_id: string; km: number } | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   115     const dId = row.driver_id ? String(row.driver_id) : "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   128     if (!best || km < best.km) best = { driver_id: dId, km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   132     let note = "No eligible ONLINE free drivers in town (online_rows=" + rows.length + ", coo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   134     return { driver_id: null as string | null, note };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   137   let note = "Nearest ONLINE free driver selected (km=" + best.km.toFixed(3) + ").";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   139   return { driver_id: best.driver_id, note };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   144   const body = (await req.json().catch(() => ({}))) as AssignReq;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   146   const bookingRes = await fetchBookingByIdOrCode(supabase, body.booking_id ?? null, body.boo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   147   if (!bookingRes.data) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   149       { ok: false, code: "BOOKING_NOT_FOUND", message: bookingRes.error || "Booking not found...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   150       { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   154   const booking: any = bookingRes.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   156   // PHASE 3L: lock completed / cancelled trips (no further assignment allowed)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   157   const lockStatus = String(booking?.status ?? "").trim().toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   158   if (lockStatus === "completed" || lockStatus === "cancelled") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   163         message: "Trip already " + lockStatus + " (assignment disabled)",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   164         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   165         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   166         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   168       { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   173   const curStatus = normStatus(booking.status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   174   const alreadyHasDriver = !!booking.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   176   if (alreadyHasDriver && curStatus && curStatus !== "requested") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   180         assigned: false,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   181         code: "ALREADY_ASSIGNED",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   182         message: "Booking already has a driver and is not assignable.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   183         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   184         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   185         driver_id: String(booking.driver_id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   186         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   187         booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   189       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   193   if (alreadyHasDriver) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   194     if (!curStatus || curStatus === "requested") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   195       await bestEffortUpdateBooking(supabase, String(booking.id), { status: "assigned" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   196       const reread = await fetchBookingByIdOrCode(supabase, String(booking.id), null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   197       const b2: any = reread.data ?? booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   201           assigned: true,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   202           code: "ALREADY_HAS_DRIVER",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   203           message: "Booking already had driver_id; status normalized to assigned (best-effort...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   204           booking_id: String(b2.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   205           booking_code: b2.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   206           driver_id: b2.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   207           status: b2.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   208           booking: b2,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   210         { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   217         assigned: true,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   218         code: "ALREADY_HAS_DRIVER",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   219         message: "Booking already has driver_id.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   220         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   221         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   222         driver_id: booking.driver_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   223         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   224         booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   226       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   230   if (curStatus && curStatus !== "requested") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   234         assigned: false,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   235         code: "NOT_ASSIGNABLE",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   236         message: "Booking status is not assignable: " + curStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   237         booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   238         booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   239         status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   240         booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   242       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   246   const town = (body.town ?? booking.town ?? "").toString();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   247   const pickup_lat = typeof body.pickup_lat === "number" ? body.pickup_lat : booking.pickup_lat;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   248   const pickup_lng = typeof body.pickup_lng === "number" ? body.pickup_lng : booking.pickup_lng;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   250   const manual_driver_id = (body as any)?.manual_driver_id ?? (body as any)?.driver_id ?? (bo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   252   // ----- MANUAL_DRIVER_SELECTED -----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   253   if (manual_driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   254     const dId = String(manual_driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   257       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   258       .select("driver_id,town,status,lat,lng")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   259       .eq("driver_id", dId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   264         { ok: false, code: "DRIVER_NOT_FOUND", message: "Driver not found in driver_locations...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   265         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   269     const dStatus = String((dr.data as any)?.status ?? "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   270     const eligible = (dStatus === "online" || dStatus === "available");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   273         { ok: false, code: "DRIVER_NOT_ELIGIBLE", message: "Driver not eligible (must be onli...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   274         { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   278     const bTown = String((booking as any)?.town ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   282         { ok: false, code: "DRIVER_TOWN_MISMATCH", message: "Driver town mismatch", booking_t...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   283         { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   287     const upd = await bestEffortUpdateBooking(supabase, String(booking.id), { driver_id: dId,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   288     const reread = await fetchBookingByIdOrCode(supabase, String(booking.id), null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   289     const b2: any = reread.data ?? booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   294         assigned: true,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   295         code: "MANUAL_ASSIGNED",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   296         booking_id: String(b2.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   297         booking_code: b2.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   298         driver_id: dId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   299         status: b2.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   302         booking: b2,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   304       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   308   if (!town) return NextResponse.json({ ok: false, code: "MISSING_TOWN", message: "Missing to...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   310     return NextResponse.json({ ok: false, code: "MISSING_PICKUP_COORDS", message: "Missing pi...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   314   const pick = await findNearestOnlineFreeDriverInTown(supabase, town, pickup_lat, pickup_lng);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   315   if (!pick.driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   317       { ok: false, code: "NO_DRIVER_AVAILABLE", message: "No available driver", note: pick.no...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   318       { status: 409 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   322   const upd = await bestEffortUpdateBooking(supabase, String(booking.id), { driver_id: pick.d...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   327       assigned: true,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   328       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   329       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   330       driver_id: pick.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   334       booking: upd.data ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                   336     { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               23     const bookingId = body.bookingId as string | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               27     if (!bookingId || Number.isNaN(pickupLat) || Number.isNaN(pickupLng)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               30         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               34     // 1) Load driver locations
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               35     const { data: driverRows, error: locError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               36       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               37       .select("driver_id, lat, lng, status, updated_at, town");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               40       console.error("driver_locations error", locError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               44     if (!driverRows || driverRows.length === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               46         { error: "NO_DRIVERS" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               47         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               51     // 2) Candidates: any driver with coordinates, not explicitly on_trip
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               52     const candidates = driverRows.filter((row: any) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               55       const statusText = String(row.status ?? "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               58       if (statusText === "on_trip") return false;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               65         { error: "NO_AVAILABLE_DRIVER" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               66         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               89         { error: "NO_DRIVER_FOUND" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               90         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               94     // 4) Update booking with assigned driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               96       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               98         assigned_driver_id: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                               99         status: "assigned",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                              101       .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                              104       console.error("update booking error", updateError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                              110       assignedDriverId: best.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                              114     console.error("auto-assign error", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                              117       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   5 function jsonError(msg: string, status = 400) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   6   return NextResponse.json({ ok: false, error: msg }, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  66   const p = safeJsonParse(row?.passenger_fare_response);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  81 function computeFare(row: any): number | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  82   const verified = asNum(row?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  85   const proposed = asNum(row?.proposed_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  88   const totalErrand = asNum(row?.total_errand_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  92   const distFare = asNum(row?.distance_fare) || 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                  96   const sum = base + distFare + wait + extraStop;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 106     // (Status log is already accessible; keeping this consistent.)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 112       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 116           "booking_code",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 118           "status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 119           "driver_id",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 130           "verified_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 131           "proposed_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 132           "total_errand_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 134           "distance_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 137           "passenger_fare_response",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 149       const fare = computeFare(r);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 156         fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 197     const booking_code =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 201       booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 202       status: "new",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 219       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                 222         "id,booking_code,status,town,driver_id,trip_type,vendor_id,takeout_service_level,pick...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                       6   return NextResponse.json({ error: msg }, { status: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                      27   const booking_id = String(payload.booking_id || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                      30   if (!booking_id) return err("booking_id required");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                      35     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                      37     .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\update-town\route.ts                      43   if (!data) return err("Booking not found", 404);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   19  * Dispatch-safe driver feed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   20  * - One row per driver (latest location)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   21  * - Online/available only (if status exists)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   40         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   47       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   48       .select("driver_id, town, status, lat, lng, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   54         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   58     // Deduplicate: keep latest row per driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   60     const drivers: any[] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   63       const id = String((row as any).driver_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   68       const st = String((row as any).status ?? "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   71       drivers.push({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   74         status: (row as any).status ?? "online",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   81     return NextResponse.json({ ok: true, drivers });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers\route.ts                                   85       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              79 function bestStatus(row: any): string | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              81   const candidates = [row.status, row.state, row.availability, row.driver_status, row.driverS...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              89 function bestDriverId(row: any): string | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              92   // Prefer explicit driver id fields (schema-flex)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              94     row.driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              95     row.driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              96     row.driver_uuid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                              97     row.driverUuid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             154         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             162       "dispatch_driver_locations_view",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             163       "driver_locations_view",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             164       "driver_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             165       "dispatch_driver_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             166       "drivers_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             167       "drivers_location",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             168       "driver_location",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             169       "admin_driver_locations",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             173       "my_driver_live",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             174       "dispatch_drivers_live_view",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             175       "drivers_live",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             176       "drivers",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             187         const id = bestDriverId(row);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             210         const id = bestDriverId(row);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             231     const drivers: Record<string, any> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             237       const driver_status = bestStatus(loc) ?? bestStatus(wal) ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             246       drivers[id] = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             247         driver_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             257     return NextResponse.json({ ok: true, drivers });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             260       { ok: false, error: e?.message || "drivers-live failed" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\drivers-live\route.ts                             261       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                  7   bookingCode?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                  8   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                  9   bookingId?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 14 function pickBookingKey(body: Body): { bookingId: string; bookingCode: string } {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 15   const bookingId = String(body.bookingId ?? body.id ?? body.uuid ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 16   const bookingCode = String(body.bookingCode ?? body.booking_code ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 17   return { bookingId, bookingCode };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 25     const { bookingId, bookingCode } = pickBookingKey(body);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 27     if (!bookingId && !bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 29         { error: "MISSING_BOOKING_IDENTIFIER" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 30         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 35     // 1) Try bookingId as bookings.id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 36     // 2) If not found, fallback to bookingCode as bookings.booking_code
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 37     let booking: any | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 39     if (bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 41         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 42         .select("id, booking_code")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 43         .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 48           { error: "BOOKING_SELECT_ERROR", message: error.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 49           { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 53       booking = rows?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 56     if (!booking?.id && bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 58         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 59         .select("id, booking_code")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 60         .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 65           { error: "BOOKING_SELECT_ERROR", message: error.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 66           { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 70       booking = rows?.[0] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 73     if (!booking?.id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 75         { error: "BOOKING_NOT_FOUND", bookingId, bookingCode },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 76         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 80     // IMPORTANT: Do NOT assume bookings.is_emergency exists.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 83       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 85       .eq("id", booking.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 89         { error: "BOOKING_UPDATE_ERROR", message: upErr.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 90         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 95       { ok: true, action: "emergency", bookingId: booking.id, bookingCode: booking.booking_co...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                 96       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\emergency\route.ts                                101       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                        4 function jsonError(msg: string, status = 400) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                        5   return NextResponse.json({ ok: false, error: msg }, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       17   if (!required) return { ok: false, status: 500, msg: "Missing DISPATCH_ADMIN_TOKEN" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       20   if (!got || got !== required) return { ok: false, status: 403, msg: "Forbidden" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       22   return { ok: true, status: 200, msg: "OK" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       35     if (!a.ok) return jsonError(a.msg, a.status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       40     const bookingId = String(body.bookingId || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       41     if (!bookingId) return jsonError("Missing bookingId", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       45     const verified_fare = asNum(body.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       49     // passenger_fare_response is stored as json/text in your schema; we write a minimal JSON...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       51     let passenger_fare_response: any = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       53       passenger_fare_response = { distance_km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       59     if (verified_fare !== null) patch.verified_fare = verified_fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       60     if (passenger_fare_response !== null) patch.passenger_fare_response = passenger_fare_resp...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       66       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       68       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                       69       .select("id, booking_code, town, status, from_label, to_label, verified_fare, passenger...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                             6   return NextResponse.json({ error: msg }, { status: code });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                            16  * GET /api/dispatch/nearby-drivers?town=Lagawe&limit=20
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                            17  * Returns latest driver locations (name, town, lat/lng, updated_at) for the given town.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                            31     .from("driver_locations_with_town")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nearby-drivers\route.ts                            32     .select("driver_id, name, town, lat, lng, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                      6 type Body = { bookingCode?: string | null; bookingId?: string | null };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     13     const bookingId = String(body.bookingId ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     14     const bookingCode = String(body.bookingCode ?? "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     15     if (!bookingId && !bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     16       return NextResponse.json({ error: "MISSING_BOOKING_IDENTIFIER" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     19     let sel = supabase.from("bookings").select("id, booking_code, updated_at").limit(1);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     20     sel = bookingId ? sel.eq("id", bookingId) : sel.eq("booking_code", bookingCode);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     23     if (selErr) return NextResponse.json({ error: "BOOKING_SELECT_ERROR", message: selErr.mes...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     25     const booking = rows?.[0];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     26     if (!booking?.id) return NextResponse.json({ error: "BOOKING_NOT_FOUND" }, { status: 404 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     30       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     32       .eq("id", booking.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     34     if (upErr) return NextResponse.json({ error: "BOOKING_UPDATE_ERROR", message: upErr.messa...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     36     return NextResponse.json({ ok: true, action: "nudge", bookingId: booking.id, bookingCode:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\nudge\route.ts                                     38     return NextResponse.json({ error: "NUDGE_UNEXPECTED", message: e?.message ?? "Unexpected ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                  21       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                  48         { status: res.status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                  57       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\overview\route.ts                                  67       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     4 type StatusReq = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     5   booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     6   booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                     7   status?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    14   "assigned",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    20   "cancelled",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    24   requested: ["assigned", "cancelled"],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    25   assigned: ["on_the_way", "arrived", "enroute", "cancelled"],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    26   on_the_way: ["arrived", "enroute", "cancelled"],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    27   arrived: ["on_trip", "completed", "cancelled"],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    28   enroute: ["arrived", "on_trip", "completed", "cancelled"],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    29   on_trip: ["completed", "cancelled"],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    31   cancelled: [],
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    43 function jsonOk(body: any, status = 200) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    44   return NextResponse.json(body, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    47 function jsonErr(code: string, message: string, status: number, extra?: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    49     Object.assign({ ok: false, code, message }, extra || {}),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    50     { status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    72     booking_id?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    73     booking_code?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    74     from_status?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    75     to_status?: string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    81     booking_id: entry.booking_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    82     booking_code: entry.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    83     from_status: entry.from_status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    84     to_status: entry.to_status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    86     source: entry.source ?? "dispatch/status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                    90   const tables = ["dispatch_audit_log", "audit_log", "status_audit"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   102 async function fetchBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   104   booking_id?: string | null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   105   booking_code?: string | null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   108     if (booking_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   110         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   112         .eq("id", booking_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   116     if (booking_code) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   118         .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   120         .eq("booking_code", booking_code)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   124     return { data: null, error: "Missing booking_id or booking_code" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   126     return { data: null, error: e?.message || "Booking lookup failed" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   130 async function tryUpdateBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   132   bookingId: string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   137       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   139       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   145     return { ok: false, data: null, error: e?.message || "Booking update failed" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   149 // Best-effort: keep driver status roughly aligned (non-blocking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   150 function driverStatusForBookingStatus(status: string): string | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   151   const s = norm(status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   152   if (s === "assigned") return "assigned";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   157   if (s === "cancelled") return "available";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   161 async function bestEffortUpdateDriverLocation(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   163   driverId: string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   164   bookingStatus: string
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   166   const mapped = driverStatusForBookingStatus(bookingStatus);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   167   if (!driverId || !mapped) return {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   171       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   172       .update({ status: mapped, updated_at: new Date().toISOString() })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   173       .eq("driver_id", driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   176       return { warning: "DRIVER_LOCATION_STATUS_UPDATE_ERROR: " + r.error.message };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   180     return { warning: "DRIVER_LOCATION_STATUS_UPDATE_ERROR: " + (e?.message || "Unknown error...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   187  * because you have a DB trigger that credits driver wallet on status -> completed.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   188  * Calling finalize could double-credit driver earnings.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   191  * - apply platform cut via process_booking_wallet_cut(p_booking_id uuid)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   196   booking: any
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   198   const bookingId = booking?.id ? String(booking.id) : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   199   const serviceType = String(booking?.service_type ?? booking?.serviceType ?? "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   200   const vendorId = booking?.vendor_id ? String(booking.vendor_id) : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   204   // 1) Apply platform/company cut (driver wallet deduction)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   205   if (bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   207       const r: any = await supabase.rpc("process_booking_wallet_cut", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   208         p_booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   215     warnings.push("WALLET_CUT_SKIPPED_NO_BOOKING_ID");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   237     const bookingId = url.searchParams.get("booking_id") || url.searchParams.get("id");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   238     const bookingCode = url.searchParams.get("booking_code") || url.searchParams.get("code");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   240     const bk = await fetchBooking(supabase, bookingId ?? null, bookingCode ?? null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   243         "BOOKING_NOT_FOUND",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   244         bk.error || "Booking not found",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   246         { booking_id: bookingId ?? null, booking_code: bookingCode ?? null }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   250     const booking: any = bk.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   251     const cur = norm(booking.status) || "requested";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   253     const hasDriver = !!booking.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   257       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   258       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   259       current_status: cur,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   260       has_driver: hasDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   262       booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   273   const booking_id =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   274     rawBody?.booking_id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   275     rawBody?.bookingId ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   277     rawBody?.booking?.id ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   280   const booking_code =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   281     rawBody?.booking_code ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   282     rawBody?.bookingCode ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   284     rawBody?.booking?.booking_code ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   285     rawBody?.booking?.bookingCode ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   288   const status = rawBody?.status ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   292   if ((!booking_id || String(booking_id).trim() === "") && (!booking_code || String(booking_c...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   293     return jsonErr("BAD_REQUEST", "Missing booking identifier", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   295   if (!status) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   296     return jsonErr("BAD_REQUEST", "Missing target status", 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   299   const target = norm(status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   301     return jsonErr("INVALID_STATUS", "Invalid status. Allowed: " + ALLOWED.join(", "), 400);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   304   const bk = await fetchBooking(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   306     booking_id ? String(booking_id).trim() : null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   307     booking_code ? String(booking_code).trim() : null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   311     return jsonErr("BOOKING_NOT_FOUND", bk.error || "Booking not found", 404, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   312       booking_id: booking_id ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   313       booking_code: booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   317   const booking: any = bk.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   318   const cur = norm(booking.status) || "requested";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   320   const hasDriver = !!booking.driver_id;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   323   if ((cur === "completed" || cur === "cancelled") && cur !== target) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   325       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   326       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   327       current_status: cur,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   328       target_status: target,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   332   // Require driver for lifecycle statuses (except requested/cancelled)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   333   if (!hasDriver && target !== "requested" && target !== "cancelled") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   334     return jsonErr("NO_DRIVER", "Cannot set status without driver_id", 409, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   335       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   336       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   337       current_status: cur,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   338       target_status: target,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   339       has_driver: hasDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   341       current_status_raw: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   351       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   352       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   353       status: booking.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   354       booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   361       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   362       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   363       current_status: cur,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   364       target_status: target,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   365       has_driver: hasDriver,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   370   // Best-effort timestamps + note (falls back to status-only if columns missing)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   372   const patch: Record<string, any> = { status: target };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   374   if (target === "assigned") patch.assigned_at = nowIso;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   379   if (target === "cancelled") patch.cancelled_at = nowIso;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   382     patch.status_note = String(note).trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   385   let upd = await tryUpdateBooking(supabase, String(booking.id), patch);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   388     upd = await tryUpdateBooking(supabase, String(booking.id), { status: target });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   392     return jsonErr("DISPATCH_STATUS_DB_ERROR", upd.error || "Booking update failed", 500, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   393       booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   394       booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   395       current_status: cur,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   396       target_status: target,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   400   const updatedBooking = upd.data ?? booking;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   402   // Driver location sync (non-blocking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   403   const driverId =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   404     updatedBooking?.driver_id ? String(updatedBooking.driver_id) :
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   405     (booking?.driver_id ? String(booking.driver_id) : "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   407   const drv = await bestEffortUpdateDriverLocation(supabase, driverId, target);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   412     booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   413     booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   414     from_status: cur,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   415     to_status: target,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   417     source: "dispatch/status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   423     const w = await bestEffortWalletSyncOnComplete(supabase, updatedBooking);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   440     booking_id: String(booking.id),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   441     booking_code: booking.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   442     status: target,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\status\route.ts                                   444     booking: updatedBooking ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                      2 // Trip queue API - reads from bookings table in Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     21       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     25   const url = `${supabaseUrl}/rest/v1/bookings?select=*&order=created_at.desc`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     40       console.error("Supabase bookings error:", data);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     45           message: "Failed to load bookings from Supabase",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     48         { status: res.status }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     57       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\trips\route.ts                                     67       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               15 function json(status: number, obj: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               16   return NextResponse.json(obj, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               32 // If DRIVER_PING_SECRET is set, request must include header: x-jride-ping-secret: <secret>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               34   const secret = envAny(["DRIVER_PING_SECRET"]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               41   return json(200, { ok: true, route: "driver/location/ping" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               59     const driver_id = str(body.driver_id ?? body.driverId ?? body.driver_uuid ?? body.driverU...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               62     const status = str(body.status ?? body.driver_status ?? body.driverStatus);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               65     if (!driver_id) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               66       return json(400, { ok: false, code: "BAD_REQUEST", message: "driver_id is required" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               72     if (status) patch.status = status;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               84     // 1) Try UPSERT by driver_id (best when driver_id has unique constraint)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               85     const upsertPayload = { driver_id, ...patch };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               90         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               91         .upsert(upsertPayload, { onConflict: "driver_id" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                               98       return json(200, { ok: true, driver_id, updated_at: patch.updated_at, mode: "upsert(dri...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              101     // 2) Fallback: update existing row by driver_id, else insert with generated id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              103       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              104       .select("id, driver_id")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              105       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              111         .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              124       return json(200, { ok: true, driver_id, updated_at: patch.updated_at, mode: "update(id)...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              132     const insertPayload = { id, driver_id, ...patch };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              135       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\location\ping\route.ts                              151     return json(200, { ok: true, driver_id, updated_at: patch.updated_at, mode: "insert(id+dr...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                               6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                               7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              20   const v = n(process.env.DRIVER_PAYOUT_MIN);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              29     route: "/api/driver/payout-request",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              31     hint_get: "GET ?driver_id=UUID&limit=20",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              32     hint_post: "POST { driver_id, amount, note? }",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              34       driver_id: searchParams.get("driver_id"),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              38     min_payout_env: process.env.DRIVER_PAYOUT_MIN ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              48   const driver_id = s(body.driver_id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              50   if (!driver_id || driver_id.toUpperCase().includes("REPLACE_DRIVER_UUID") || driver_id.toLo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              51     return json(400, { ok: false, code: "BAD_DRIVER_ID", message: "Provide a real driver_id U...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              55   if (!driver_id) return json(400, { ok: false, code: "MISSING_DRIVER_ID" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              62     .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              64     .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              74     .from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              76       driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-request\route.ts                              78       status: "pending",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                              6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                              7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             20 // GET /api/driver/payout-requests?driver_id=UUID&status=all|pending|approved|paid|rejected&l...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             27     const driver_id = s(searchParams.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             28     const status = s(searchParams.get("status") || "all").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             31     if (!driver_id) return json(400, { ok: false, code: "MISSING_DRIVER_ID" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             34       .from("driver_payout_requests")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             35       .select("id,driver_id,amount,status,requested_at,processed_at,payout_method,payout_ref,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             36       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             40     if (status && status !== "all") q = q.eq("status", status);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\payout-requests\route.ts                             45     return json(200, { ok: true, driver_id, status, requests: Array.isArray(data) ? data : []...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                         1 // app/api/driver/ping/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        11 const PING_TOKEN = process.env.DRIVER_PING_TOKEN ?? "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        13 type Body = { driver_id: string; lat: number; lng: number };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        17     const auth = req.headers.get("x-driver-ping-token") ?? "";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        19       return NextResponse.json({ status: "error", message: "unauthorized" }, { status: 401 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        22     const { driver_id, lat, lng } = (await req.json()) as Body;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        23     if (!driver_id || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        24       return NextResponse.json({ status: "error", message: "driver_id, lat, lng required" }, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        27     const resp = await fetch(`${URL}/rest/v1/rpc/set_driver_location`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        34       body: JSON.stringify({ p_driver_id: driver_id, p_lat: lat, p_lng: lng }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        39       return NextResponse.json({ status: "error", message: err }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        42     return NextResponse.json({ status: "ok" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\ping\route.ts                                        44     return NextResponse.json({ status: "error", message: String(e?.message ?? e) }, { status:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                       6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                       7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      19 // READ-ONLY driver wallet snapshot
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      20 // GET /api/driver/wallet?driver_id=UUID&tx_limit=30
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      27     const driver_id = s(searchParams.get("driver_id"));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      30     if (!driver_id) return json(400, { ok: false, code: "MISSING_DRIVER_ID" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      34       .from("driver_wallet_balances_v1")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      35       .select("driver_id,balance")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      36       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      43       .from("driver_wallet_transactions")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      44       .select("id,driver_id,amount,balance_after,reason,booking_id,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      45       .eq("driver_id", driver_id)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver\wallet\route.ts                                      53       driver_id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                   16     .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                   17     .select("driver_id, lat, lng, status, town, updated_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                   18     .neq("status", "offline"); // adjust filter as needed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                   21     console.error("driver_locations admin fetch error", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                   24       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations\route.ts                                   28   return NextResponse.json({ ok: true, drivers: data ?? [] });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              16 // POST /api/driver_locations_test
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              23     const { driverId, lat, lng, status } = body || {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              25     if (!driverId || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              29           got: { driverId, lat, lng, status },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              31         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              35     const normalizedStatus =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              36       typeof status === "string" && status.trim().length
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              37         ? status
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              44       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              46       .eq("driver_id", driverId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              53     const { error: insErr } = await supabase.from("driver_locations").insert({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              54       driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              57       status: normalizedStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              71         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              75     return NextResponse.json({ ok: true }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              83       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              88 // GET /api/driver_locations_test
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              93       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                              94       .select("driver_id, lat, lng, status, updated_at");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                             105         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                             109     return NextResponse.json({ drivers: data }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver_locations_test\route.ts                             117       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                    6     const { driver_id, lat, lng, is_available = true } = await req.json();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                    7     if (!driver_id || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                    8       return NextResponse.json({ error: "driver_id, lat, lng required" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                   12       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                   14         { driver_id, lat, lng, is_available, last_seen: new Date().toISOString() },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                   15         { onConflict: "driver_id" }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                   18     if (error) return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                   19     return NextResponse.json({ ok: true }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\driver-heartbeat\route.ts                                   21     return NextResponse.json({ error: e?.message ?? "Unknown error" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                23         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                33         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                46       console.error("ETA API: Mapbox HTTP error:", response.status, text);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                49         { status: 502 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                58         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                71       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\eta\route.ts                                                77       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                       9     const { driverId, lat, lng, status } = body;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      11     if (!driverId || typeof lat !== "number" || typeof lng !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      15         { status: 400 },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      20       driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      23       status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      27       .from("driver_locations")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      30           driver_id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      33           status: status ?? "online",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      36         { onConflict: "driver_id" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      43         { status: 500 },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\live-location\route.ts                                      52       { status: 500 },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        14   context: { params: { bookingCode: string } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        20         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        24     const bookingCode = context.params.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        29     if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        31         { error: "Missing booking code" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        32         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        39         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        44       booking_code: bookingCode,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        51       return NextResponse.json({ error: error.message }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\rating\route.ts                        59       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                7   { params }: { params: { bookingCode: string } }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               10   const { bookingCode } = params;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               13     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               15     .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               20       { error: error?.message ?? "Booking not found" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               21       { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               25   // ✅ Type narrowing — from here onward TS knows this is a booking row
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               26   const booking = data as any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               28   const fare_breakdown = booking.fare_breakdown ?? {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               31     id: booking.id,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               32     booking_code: booking.booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               33     passenger_name: booking.passenger_name,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               34     service_type: booking.service_type,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               35     status: booking.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               36     customer_status: booking.customer_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               37     vendor_status: booking.vendor_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               39     base_fee: fare_breakdown.base_fee,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               40     extra_stop_fee: fare_breakdown.extra_stop_fee,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               41     company_cut: fare_breakdown.company_cut,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               42     driver_payout: Number(booking.driver_payout ?? 0),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               44     created_at: booking.created_at,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               45     updated_at: booking.updated_at,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                               46     vendor_driver_arrived_at: booking.vendor_driver_arrived_at,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\passenger-addresses\route.ts                                 6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\passenger-addresses\route.ts                                 7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\auth\login\route.ts                                  28 function bad(msg: string, status = 400) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\auth\login\route.ts                                  29   return NextResponse.json({ ok: false, error: msg }, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\auth\login\route.ts                                 104       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\auth\signup\route.ts                                 35 function bad(msg: string, status = 400) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\auth\signup\route.ts                                 36   return NextResponse.json({ ok: false, error: msg }, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\auth\signup\route.ts                                118       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                              39 async function p2dSnapshotTakeout(admin:any, bookingId:string, vendorId:string, body:any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                              41   if (!bookingId || !vendorId || !itemsIn.length) return { ok:false, inserted:0, subtotal:0, ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                              60       booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                              76   const up = await admin.from("bookings").update({ service_type:"takeout", takeout_items_subt...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             183 async function snapshotTakeoutOrNull(supabase: any, bookingId: string, body: any): Promise<{ ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             205       booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             221   const up = await supabase.from("bookings").update({ takeout_items_subtotal: subtotal }).eq(...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             281     out.status = 403;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             283     out.message = "Booking is restricted from 8PM to 5AM unless verified.";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             309           out.status = 402;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             316           out.status = 402;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             357       { status: 403 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             362   // Booking must include location and must be inside Ifugao (conservative bbox).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             373       { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             378       { ok: false, code: "GEO_OUTSIDE_IFUGAO", message: "Booking is only allowed inside Ifuga...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             379       { status: 403 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             387       { status: e.status || 403 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             391   const booking_code = isTakeout
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             394     booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             403     status: "requested",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             411     (payload as any).vendor_status = "preparing";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             419   const ins = await supabase.from("bookings").insert(payload).select("*").maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             422     delete payload2.status;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             424     const ins2 = await supabase.from("bookings").insert(payload2).select("*").maybeSingle();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             427       return NextResponse.json({ ok: false, code: "BOOKING_INSERT_FAILED", message: ins2.erro...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             430     let booking: any = ins2.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             432     // best-effort set status requested
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             433     await supabase.from("bookings").update({ status: "requested" }).eq("id", String(booking.i...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             435     /* PHASE2D_SKIP_ASSIGN_FOR_TAKEOUT */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             436     // Phase 6H2: CALL DISPATCH ASSIGN (single source of truth, includes busy lock)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             438     let assign: any = { ok: false, note: "Assignment skipped." };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             442         const resp = await fetch(`${baseUrl}/api/dispatch/assign`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             445           body: JSON.stringify({ booking_id: String(booking.id) }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             448         assign = j;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             450         assign = { ok: false, note: "Assign call failed: " + String(err?.message || err) };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             453       assign = { ok: true, skipped: true, reason: "takeout_booking" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             455 /* PHASE2D_SKIP_ASSIGN_FOR_TAKEOUT_END */// re-read booking for final status/driver_id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             456     const reread = await supabase.from("bookings").select("*").eq("id", String(booking.id)).m...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             457     if (!reread.error && reread.data) booking = reread.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             465         takeoutSnapshot = await snapshotTakeoutOrNull(supabase as any, String(booking.id), bo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             469     }return NextResponse.json({ ok: true, env: jrideEnvEcho(), booking_code, booking, assign,...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             472   let booking: any = ins.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             474   // Freeze items + compute subtotal + store on booking. Menu edits won't affect history.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             479       const bookingId = String((booking as any)?.id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             481       if (bookingId && vendorId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             483         const takeoutSnapshot = await p2dSnapshotTakeout(supabase as any, bookingId, vendorId...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             484         // best-effort (do not fail booking)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             485         (booking as any).takeoutSnapshot = takeoutSnapshot;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             498       takeoutSnapshot = await snapshotTakeoutOrNull(supabase as any, String(booking.id), body...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             502   }// Phase 6H2: CALL DISPATCH ASSIGN (single source of truth, includes busy lock)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             504   let assign: any = { ok: false, note: "Assignment skipped." };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             506     const resp = await fetch(`${baseUrl}/api/dispatch/assign`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             509       body: JSON.stringify({ booking_id: String(booking.id) }),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             512     assign = j;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             514     assign = { ok: false, note: "Assign call failed: " + String(err?.message || err) };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             517   // re-read booking for final status/driver_id
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             518   const reread = await supabase.from("bookings").select("*").eq("id", String(booking.id)).may...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             519   if (!reread.error && reread.data) booking = reread.data;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\book\route.ts                             521   return NextResponse.json({ ok: true, env: jrideEnvEcho(), booking_code, booking, assign, ta...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                            8   booking?: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           11 function json(status: number, body: Resp) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           12   return NextResponse.json(body, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           20     const bookingCode = String(url.searchParams.get("code") || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           21     if (!bookingCode) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           22       return json(400, { ok: false, code: "MISSING_CODE", message: "Missing booking code" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           30       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           32         "id, booking_code, status, driver_id, assigned_driver_id, created_at, updated_at, cre...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           34       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           41       return json(404, { ok: false, code: "NOT_FOUND", message: "Booking not found" });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\booking\route.ts                           44     return json(200, { ok: true, booking: b });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          55     status: "not_submitted" as "not_submitted" | "submitted" | "pending_admin" | "verified" |...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          56     raw_status: "" as string,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          70   function mapRawStatus(raw: any): "not_submitted" | "submitted" | "pending_admin" | "verifie...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          74     if (u === "approved_admin") return "verified";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          75     if (u === "pre_approved_dispatcher") return "pending_admin";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          77     if (u === "rejected") return "rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          78     if (u.indexOf("approved") >= 0) return "verified";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          79     if (u.indexOf("pre_approved") >= 0) return "pending_admin";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          81     if (u.indexOf("reject") >= 0) return "rejected";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                          87     const selectors = ["status,updated_at", "status,created_at", "status"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         104             const raw = String(row.status || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         105             out.raw_status = raw;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         106             out.status = mapRawStatus(raw);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         109             out.verified = (out.status === "verified");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         145     out.status = out.verified ? "verified" : "not_submitted";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         156       out.status = out.verified ? "verified" : "not_submitted";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         162   out.status = "not_submitted";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         265       verification_status: v.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         266       verification_raw_status: v.raw_status,wallet_ok: w.ok,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         273     { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         290         message: "Booking is restricted from 8PM to 5AM unless verified.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         297       verification_status: v.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         298       verification_raw_status: v.raw_status,},
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         299       { status: 403 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         316       { status: 402 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         333       verification_status: v.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         334       verification_raw_status: v.raw_status,wallet_ok: true,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\public\passenger\can-book\route.ts                         341     { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                         8     "[assign-nearest/latest] Missing SUPABASE_URL or SUPABASE_ANON_KEY env vars"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        15     { ok: true, hint: "POST to assign latest pending ride" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        16     { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        20 // POST = actually call Supabase RPC to assign the nearest driver
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        29         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        33     const rpcUrl = `${SUPABASE_URL}/rest/v1/rpc/assign_nearest_driver_v2`;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        58       console.error("[assign-nearest/latest] Supabase error:", rawText);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        62           error: "DB_ERROR_ASSIGN",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        63           status: supabaseResponse.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        66         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        76       { status: 200 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        79     console.error("[assign-nearest/latest] SERVER ERROR:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\latest\route.ts                        85       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               17     const bookingId = body.bookingId as string | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               19     if (!bookingId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               21         { error: "Missing bookingId in body." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               22         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               27       data: booking,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               28       error: bookingError,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               30       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               31       .select("id, status")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               32       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               35     if (bookingError) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               36       console.error("ASSIGN_API_BOOKING_ERROR", bookingError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               38         { error: "Failed to load booking.", details: bookingError.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               39         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               43     if (!booking) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               45         { error: "Booking not found." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               46         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               50     const status = (booking.status ?? "").toLowerCase();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               51     if (status === "completed" || status === "cancelled") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               53         { error: "Cannot assign driver for completed/cancelled trip." },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               54         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               59       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               61         status: "on_trip",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               64       .eq("id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               67       console.error("ASSIGN_API_UPDATE_ERROR", updateError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               69         { error: "Failed to update booking.", details: updateError.message },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               70         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               74     return NextResponse.json({ ok: true }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               76     console.error("ASSIGN_API_UNEXPECTED_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               79         error: "Unexpected error in assign-nearest handler.",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\assign-nearest\route.ts                               82       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\complete\route.ts                                     16       return NextResponse.json({ status: "error", message: "ride_id required" }, { status: 40...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\complete\route.ts                                     19     const resp = await fetch(`${URL}/rest/v1/rpc/complete_ride_and_free_driver`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\complete\route.ts                                     30     return NextResponse.json(data, { status: resp.ok ? 200 : 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\complete\route.ts                                     32     return NextResponse.json({ status: "error", message: String(e?.message ?? e) }, { status:...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\create\route.ts                                        9       return NextResponse.json({ error: "pickup_lat and pickup_lng required" }, { status: 400...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\create\route.ts                                       14       .insert({ pickup_lat, pickup_lng, town, vehicle_type, status: "pending" })
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\create\route.ts                                       18     if (error) return NextResponse.json({ error: error.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\create\route.ts                                       19     return NextResponse.json({ ok: true, rideId: data.id }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\create\route.ts                                       21     return NextResponse.json({ error: e?.message ?? "Unknown error" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         15     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         16     const fare: number | undefined = body?.fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         18     if (!bookingCode || typeof fare !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         21         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         26       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         28         proposed_fare: fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         29         status: "awaiting_passenger_confirmation",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         32       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         37       console.error("FARE_UPDATE_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         40         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         44     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         46     console.error("FARE_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                         49       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                11 async function triggerAutoReassign() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                21       console.error("AUTO_REASSIGN_SKIP: no base URL env found");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                25     const res = await fetch(`${baseUrl}/api/rides/assign-nearest/latest`, {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                31       console.error("AUTO_REASSIGN_HTTP_ERROR", res.status, await res.text());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                34     console.error("AUTO_REASSIGN_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                41     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                42     const response: "accepted" | "rejected" | undefined = body?.response;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                44     if (!bookingCode || !response) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                47         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                51     if (response !== "accepted" && response !== "rejected") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                54         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                59       passenger_fare_response: response,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                63     if (response === "accepted") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                64       // keep current driver, proceed as normal
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                65       updates.status = "driver_accepted";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                67       // passenger rejected the fare:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                68       // reset booking and free driver, ready for auto re-assign
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                69       updates.status = "pending";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                70       updates.assigned_driver_id = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                71       updates.proposed_fare = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                75       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                77       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                82       console.error("FARE_RESPONSE_UPDATE_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                85         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                89     if (response === "rejected") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                90       // fire-and-forget auto reassign – no need to await for response to user
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                91       triggerAutoReassign();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                94     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                96     console.error("FARE_RESPONSE_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                99       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         25   return { ok: res.ok, status: res.status, txt, table };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         31       { status: "error", message: "Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         32       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         37   const candidates = ["bookings", "rides"];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         48         return NextResponse.json({ status: "ok", table, data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         50         return NextResponse.json({ status: "ok", table, raw: r.txt });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         64         { status: "error", table, http_status: r.status, body: r.txt },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         65         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         73       status: "error",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         74       message: "No suitable rides table found (tried: bookings, rides).",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         75       last: lastErr ? { table: lastErr.table, http_status: lastErr.status, body: lastErr.txt ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\list\route.ts                                         77     { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\route.ts                                              36         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\route.ts                                              48       status: "pending",          // adjust to your enum if needed
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\route.ts                                              59       return NextResponse.json({ error: error.message }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\route.ts                                              62     return NextResponse.json({ id: data.id }, { status: 201 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\route.ts                                              64     return NextResponse.json({ error: e?.message ?? "Unknown error" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                   1 // app/api/rides/save-assign/route.ts
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  19         return NextResponse.json({ error: `Missing ${key}` }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  33       status: "new" as const,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  43       return NextResponse.json({ error: insertErr?.message ?? "Insert failed" }, { status: 50...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  46     // 2) Assign nearest (server-side RPC)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  50     const { data: assigned, error: rpcErr } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  51       .rpc("assign_nearest_driver_to_ride", {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  58       // We still return the created ride (unassigned) so UI can show it
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  61         assigned: null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  62         note: "RPC error; ride saved but not assigned",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  64       }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  67     // assigned returns table(ride_id, assigned_driver, status)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  68     const result = Array.isArray(assigned) && assigned.length ? assigned[0] : null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  72       assigned_driver: result?.assigned_driver ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  73       ride_status: result?.status ?? "new",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  74     }, { status: 200 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                  76     return NextResponse.json({ error: e.message ?? "Unexpected error" }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                        7 // allowed statuses we can move to from the dispatch console
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                        8 const ALLOWED_STATUSES = ["driver_accepted", "in_transit", "completed", "cancelled"] as const;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                        9 type AllowedStatus = (typeof ALLOWED_STATUSES)[number];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       20     const bookingCode: string | undefined = body?.bookingCode;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       21     const status: AllowedStatus | undefined = body?.status;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       23     if (!bookingCode || !status) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       26         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       30     if (!ALLOWED_STATUSES.includes(status)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       32         { ok: false, error: "INVALID_STATUS" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       33         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       38       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       40         status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       43       .eq("booking_code", bookingCode)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       48       console.error("UPDATE_STATUS_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       51         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       55     return NextResponse.json({ ok: true, booking: data });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       57     console.error("STATUS_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\status\route.ts                                       60       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\settle\route.ts                               18         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\settle\route.ts                               28         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\settle\route.ts                               45         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\settle\route.ts                               54       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            22         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            29       return NextResponse.json({ error: "Not authenticated" }, { status: 401 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            34       return NextResponse.json({ error: "Missing vendorId" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            48         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            54       return NextResponse.json({ error: "Vendor not found" }, { status: 404 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            70         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            89         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts            97         "id,booking_code,service_type,vendor_status,customer_status,total_service_fare,platfo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts           106         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts           113       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts           121         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts           129         "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,reviewed_by"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts           138         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts           154       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts          24         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts          30       return NextResponse.json({ error: "Not authenticated" }, { status: 401 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts          37         "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,reviewed_by"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts          45         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts          73           { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\list-requests\route.ts         100       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         19         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         26       return NextResponse.json({ error: "Not authenticated" }, { status: 401 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         35         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         43         "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,reviewed_by"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         52         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         60         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         64     if (request.status !== "pending") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         67         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         77         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         84       "Cash payout settlement approved from admin takeout dashboard";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts         90         booking_code: null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts        103         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts        111         status: "paid",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts        116       .eq("status", "pending")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts        124         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payout\settle-request\route.ts        135       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payouts\route.ts                       18         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payouts\route.ts                       31         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-payouts\route.ts                       40       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\menu\route.ts                                        6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\menu\route.ts                                        7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                19   const dist = num(row.distance_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                39         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                44       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                48         booking_code,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                50         status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                51         customer_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                52         vendor_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                56         distance_fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                60         driver_payout
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                69       return NextResponse.json({ error: error.message }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                85       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               101       return NextResponse.json({ ok: false, code: "VENDOR_ID_REQUIRED", message: "vendor_id i...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               104       return NextResponse.json({ ok: false, code: "ITEMS_REQUIRED", message: "items[] is requ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               112         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               118     const insertBooking: any = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               121       status: "requested",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               122       vendor_status: "preparing",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               129     const b = await admin.from("bookings").insert(insertBooking).select("*").single();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               130     if (b.error) return NextResponse.json({ ok: false, code: "DB_ERROR", message: b.error.mes...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               132     const booking = b.data as any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               133     const booking_id = String(booking?.id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               144       return NextResponse.json({ ok: false, code: "MENU_LOOKUP_FAILED", message: menuRes.erro...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               162       snapshotRows.push({ booking_id, menu_item_id: mid, name, price, quantity: qty, snapshot...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               167       return NextResponse.json({ ok: false, code: "NO_VALID_ITEMS", message: "No valid menu i...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               171     if (ins.error) return NextResponse.json({ ok: false, code: "SNAPSHOT_INSERT_FAILED", mess...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               173     const up = await admin.from("bookings").update({ takeout_items_subtotal: subtotal }).eq("...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               175       return NextResponse.json({ ok: true, booking_id, booking_code: booking?.booking_code ??...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               178     return NextResponse.json({ ok: true, booking_id, booking_code: booking?.booking_code ?? n...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                               180     return NextResponse.json({ ok: false, code: "UNEXPECTED", message: e?.message || "Unexpec...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      22         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      29       return NextResponse.json({ error: "Not authenticated" }, { status: 401 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      43         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      51         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      70         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      89         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                      97         "id,booking_code,service_type,vendor_status,customer_status,total_service_fare,platfo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     106         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     113       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     121         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     129         "id,vendor_id,requested_amount,status,note,created_at,reviewed_at,reviewed_by"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     138         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     143       (payoutRows ?? []).some((r: any) => r.status === "pending") ?? false;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                     158       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      19         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      26       return NextResponse.json({ error: "Not authenticated" }, { status: 401 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      40         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      48         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      65         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      74         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      81       .select("id,status")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      83       .eq("status", "pending")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                      90         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                     100         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                     110         status: "pending",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                     120         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\request\route.ts                     131       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              22         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              32         { status: 401 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              47         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              55         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              72         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              89         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                              99           "booking_code",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             101           "vendor_status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             102           "customer_status",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             103           "total_service_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             118         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             125       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             134         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             142         "id,status,requested_amount,note,created_at,reviewed_at,reviewed_by"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             152         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                             168       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      19         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      29         { status: 401 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      44         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      52         { status: 404 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      69         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      79         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      86       .select("id,status,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      88       .eq("status", "pending")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                      96         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                     103         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                     113         status: "pending",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                     123         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\request-payout\route.ts                     134       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                             11   booking_code: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                             36       return NextResponse.json({ error: "Missing vendorId" }, { status: 400 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                             46       return NextResponse.json({ error: pricingErr.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                             57     // If your original file had more logic (joining bookings, ratings, etc.),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                             66       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                              54         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                              82         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                              91       .select("booking_code,amount,kind,note,created_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                             100         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                             114       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                             125         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                             144         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-wallet\route.ts                             153       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor\payout-request\route.ts                               6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor\payout-request\route.ts                               7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor\payout-request\route.ts                              95         status: "pending",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-menu\route.ts                                         6 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-menu\route.ts                                         7   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     203 function json(status: number, payload: any) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     204   return NextResponse.json(payload, { status });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     231   booking_id?: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     295     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     305   const itemsByBooking: Record<string, SnapshotItem[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     306   const subtotalByBooking: Record<string, number> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     311       .select("booking_id,menu_item_id,name,price,quantity,snapshot_at")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     312       .in("booking_id", ids);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     316         const bid = String(r?.booking_id || "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     320           booking_id: bid,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     328         if (!itemsByBooking[bid]) itemsByBooking[bid] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     329         itemsByBooking[bid].push(item);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     330         subtotalByBooking[bid] = (subtotalByBooking[bid] || 0) + item.price * item.quantity;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     333       for (const k of Object.keys(itemsByBooking)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     334         itemsByBooking[k].sort((a, b2) => String(a.snapshot_at || "").localeCompare(String(b2...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     341     const snapItems = itemsByBooking[bid] || null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     345     const computed = subtotalByBooking[bid] ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     349       r?.items_subtotal ?? r?.subtotal ?? r?.total_bill ?? r?.totalBill ?? r?.fare ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     358       booking_code: r?.booking_code ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     360       vendor_status: r?.vendor_status ?? r?.vendorStatus ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     361       status: r?.status ?? null,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     446 const order_id = String(body?.order_id ?? body?.orderId ?? body?.booking_id ?? body?.bookingI...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     448   const vendor_status = String(body?.vendor_status ?? body?.vendorStatus ?? "preparing").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     450   // If order_id exists, treat as "update vendor_status" (NO SNAPSHOT HERE)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     451 // Phase 3A bridge: when vendor marks ready (driver_arrived), also move booking.status -> "as...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     452 // so it becomes dispatch-visible. Idempotent: only if status is still requested/empty.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     455       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     456       .select("id,status,vendor_status")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     463     const curStatus = String((cur.data as any)?.status || "").trim();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     464     const nextVendor = vendor_status;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     466     const patch: any = { vendor_status: nextVendor };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     469     // Only advance if booking hasn't progressed yet.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     470     const stillRequested = !curStatus || curStatus === "requested";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     472       nextVendor === "driver_arrived" ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     478       patch.status = "assigned";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     482       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     495       vendor_status: up.data?.vendor_status ?? nextVendor,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     496       status: up.data?.status ?? curStatus,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     497       bridgedToDispatch: !!patch.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     518   // Create booking row (schema-safe: auto-drop unknown columns and retry)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     519   async function insertBookingSchemaSafe(initial: Record<string, any>) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     524       const res = await admin!.from("bookings").insert(payload).select("*").single();
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     531       const m = msg.match(/Could not find the '([^']+)' column of 'bookings' in the schema ca...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     591     // bookings has 'town' column (no 'zone' column) â€” keep town only
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     602     vendor_status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     609     status: "requested",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     666   const ins = await insertBookingSchemaSafe(createPayload);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     678   const bookingId = String(ins.data?.id ?? "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     679   if (!bookingId) return json(500, { ok: false, error: "CREATE_FAILED", message: "Missing boo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     694     .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     696     .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     751     // 3) accept coords if caller provided them (future-proof)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     840       // Inline schema-safe update (drop unknown booking columns and retry)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     846           .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     848           .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     860           msg.match(/Could not find the '([^']+)' column of 'bookings' in the schema cache/i) ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     861           msg.match(/column\s+"([^"]+)"\s+of\s+relation\s+"bookings"\s+does\s+not\s+exist/i);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     914       .eq("booking_id", bookingId);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     929       // Ensure booking subtotal is set (repair only; do not re-snapshot)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     938         await admin!.from("bookings").update({ takeout_items_subtotal: subtotal }).eq("id", b...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                     953         booking_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                    1014       .from("bookings")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                    1016       .eq("id", bookingId)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                    1030     order_id: bookingId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                21     const driverId = body.driver_id as string | undefined;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                24     if (!driverId || !zoneId) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                26         { error: "driver_id and zone_id are required" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                27         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                33     // Upsert driver row: if exists, update zone/status; if not, create.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                34     const { error } = await supabase.from("drivers").upsert(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                36         id: driverId,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                38         driver_status: "online",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                44       console.error("assign-driver error:", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                47         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                56     console.error("assign-driver unexpected error:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\assign-driver\route.ts                                59       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\capacity\route.ts                                     25         "zone_id, zone_name, color_hex, capacity_limit, active_drivers, available_slots, status"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\capacity\route.ts                                     33         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\capacity\route.ts                                     42       { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    29         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    35     // Select drivers to move
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    36     const { data: drivers, error: selError } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    37       .from("drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    40       .eq("driver_status", "online")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    47         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    51     if (!drivers || drivers.length === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    53         { error: "No online drivers found in source zone" },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    54         { status: 400 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    58     const ids = drivers.map((d) => d.id);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    61       .from("drivers")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    69         { status: 500 }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\zones\rebalance\route.ts                                    80       { status: 500 }


PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "1.5","km","surcharge","pickup fee","convenience","matrix","farePhp","fare","pricing" |
>>   Select-Object Path, LineNumber, Line |
>>   Sort-Object Path, LineNumber

Path                                                                                                   LineNumber Line
----                                                                                                   ---------- ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\finance\summary\page.tsx                                   239     const totalKeys = ["total", "total_amount", "grand_total", "amount", "fare", "total_far...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                       348                       <div className="flex items-center gap-1.5">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   24     const distanceKm = meters / 1000;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   28       distanceKm < 1
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   29         ? Math.round(distanceKm * 1000) + " m"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\_components\LiveTripEtaCell.tsx                   30         : distanceKm.toFixed(1) + " km";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                              49   const [distanceKm, setDistanceKm] = useState<number | null>(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             343         setDistanceKm(result.distanceKm);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\BookingMapClient.tsx                             404             distanceKm={distanceKm}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     142                 <div className="text-slate-500">Fare</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                     143                 <div className="font-semibold">{s(selectedTrip.fare ?? selectedTrip.fare_am...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx                121               className="rounded-full p-1.5 text-slate-300 hover:bg-slate-800 hover:text-wh...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               37     let gross = 0;        // total passenger paid / fare gross
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               47       const fare = pickNum(t, ["fare_amount", "fare", "total_fare", "totalFare", "amount", ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx               52       gross += n(fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\EarningsSummaryPanel.tsx              106         Uses fields if present: fare_amount, platform_fee/service_fee, driver_cut/driver_ne...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1043                       ~{(s.distanceMeters / 1000).toFixed(2)} km away  · {" "}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1089                     : `${(selectedOverview.distToPickup / 1000).toFixed(2)} km`}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                     1097                     : `${(selectedOverview.distToDrop / 1000).toFixed(2)} km`}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        149         const km = distM / 1000;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\SmartAutoAssignSuggestions.tsx        154         const label = onlinePenalty ? `Nearest (non-online)  -  ${km.toFixed(2)} km` : `Nea...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            230           <div className="text-[10px] text-slate-500">Fare</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripControlWalletPanel.tsx            231           <div className="text-sm font-semibold">{money(trip?.fare_amount ?? trip?.fare ?? ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            12    * Average speed in km/h for ETA computation.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            13    * Default: 25 km/h (typical tricycle / mixed traffic).
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            15   avgSpeedKmh?: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            21   km: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            37   avgSpeedKmh: number
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            39   const R = 6371; // km
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            53   const km = R * c;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            55   if (!isFinite(km) || Number.isNaN(km)) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            56     return { minutes: null, km: null };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            59   const hours = km / (avgSpeedKmh || 25);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            64     km: parseFloat(km.toFixed(1)),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            74   avgSpeedKmh = 25,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            85       return { minutes: null, km: null };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            92       avgSpeedKmh
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                            94   }, [hasCoords, originLat, originLng, destLat, destLng, avgSpeedKmh]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                           116       {result.km !== null && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripEta.tsx                           118           ~{result.km} km (approx)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    34  * bookings has verified_fare, proposed_fare, total_errand_fare, and components:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    35  * base_fee, distance_fare, extra_stop_fee, waiting_fee
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    45 function computeFareFromBooking(trip: any): number | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    46   // TAKEOUT fare fields (read-only display; do NOT assume schema)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    47   const direct = asNum(trip?.fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    49   const totalFare = asNum(trip?.total_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    50   if (totalFare !== null) return totalFare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    62   const verified = asNum(trip?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    65   const proposed = asNum(trip?.proposed_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    68   const errandTotal = asNum(trip?.total_errand_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    72   const distFare = asNum(trip?.distance_fare) ?? 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                    76   const sum = baseFee + distFare + extraStop + waitingFee;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   116   const fare = useMemo(() => computeFareFromBooking(trip), [trip]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   119   const derivedFare = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   124     // fare Ã¢â€°Ë† vendorEarnings / 0.90
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   130     if (derivedFare === null) return null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   133     const cut = derivedFare - vb; // Ã¢â€°Ë† 10%
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   135   }, [trip, isTakeout, derivedFare]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   138   const fareDisplay = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   139     // If we have a real fare, use it. Else for TAKEOUT, use derivedFare.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   140     if (fare !== null) return fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   141     if (isTakeout && derivedFare !== null) return derivedFare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   143   }, [fare, isTakeout, derivedFare]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   255           <div className="text-slate-500">Fare</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                   256           <div className="font-semibold">{fmtMoney(fareDisplay)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                              158                   "px-3 py-1.5 font-semibold flex items-center justify-between",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\LiveTripsClient.tsx                              821                 <div className="font-semibold">Fare</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                          13   km: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         301               const km = route.distance / 1000; // meters -> km
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         302               tripEta = { minutes, km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         372               const km = route.distance / 1000;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\map\BookingMapClient.tsx                         373               pickupEta = { minutes, km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx                                           181                             className="rounded-lg border border-black/10 bg-white px-3 py-1...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx                                           189                             className="rounded-lg border border-black/10 bg-white px-3 py-1...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx                                           252           Tip: Send the "Copy link" URL to the vendor. They open it once and bookmark /vend...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    24 function haversineKm(aLat: number, aLng: number, bLat: number, bLng: number): number {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    25   const R = 6371; // km
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    44   // Mapbox matrix: coord0;coord1;...;pickup
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    52   const url = `https://api.mapbox.com/directions-matrix/v1/mapbox/driving/${allCoords}?sour...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                    58     console.error("MAPBOX_MATRIX_ERROR", res.status, await res.text());
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   150       km: haversineKm(booking.pickup_lat, booking.pickup_lng, d.lat, d.lng),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\auto-assign\route.ts                                   153     withDist.sort((a, b) => a.km - b.km);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  12  * Admin / Dispatcher fare override & verification endpoint.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  17  *   "verifiedFare": 75,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  19  *   "reason": "Corrected per fare matrix" // optional
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  27     const verifiedFare: number | undefined = body?.verifiedFare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  31     if (!bookingCode || typeof verifiedFare !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  41         verified_fare: verifiedFare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  51       console.error("FARE_OVERRIDE_UPDATE_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                                  60     console.error("FARE_OVERRIDE_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               22 function haversineKm(aLat:number,aLng:number,bLat:number,bLng:number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               88         const km = haversineKm(pLat, pLng, lat, lng);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               91           distance_km: Number(km.toFixed(2)),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                               96       .sort((a: any, b: any) => a.distance_km - b.distance_km)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          41   const vf = n(b?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts                          79       .select("id,booking_code,status,driver_id,driver_payout,verified_fare,company_cut")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                              54       .select("id,booking_code,status,service_type,vendor_status,driver_id,vendor_id,update...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             115     // 2) else max(verified_fare - company_cut, 0)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                             119       const vf = n(b?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                      14 function haversineKm(aLat: number, aLng: number, bLat: number, bLng: number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     110   let best: { driver_id: string; km: number } | null = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     127     const km = haversineKm(pickup_lat, pickup_lng, c.lat, c.lng);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     128     if (!best || km < best.km) best = { driver_id: dId, km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\assign\route.ts                                     137   let note = "Nearest ONLINE free driver selected (km=" + best.km.toFixed(3) + ").";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                  4 // Haversine distance in km between two lat/lng pairs
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                  6   const R = 6371; // Earth radius in km
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 75       const distKm = haversine(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 81       if (distKm < bestDistance) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                 82         bestDistance = distKm;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\auto-assign\route.ts                                111       distanceKm: bestDistance,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    65 function extractDistanceKm(row: any): number | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    66   const p = safeJsonParse(row?.passenger_fare_response);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    70     pickFirstNumber(p, ["distance_km", "distanceKm", "km", "distance"]) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    71     pickFirstNumber(p?.data, ["distance_km", "distanceKm", "km", "distance"]) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    81 function computeFare(row: any): number | null {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    82   const verified = asNum(row?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    85   const proposed = asNum(row?.proposed_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    88   const totalErrand = asNum(row?.total_errand_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    92   const distFare = asNum(row?.distance_fare) || 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                    96   const sum = base + distFare + wait + extraStop;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   130           "verified_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   131           "proposed_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   132           "total_errand_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   134           "distance_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   137           "passenger_fare_response",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   148       const distance_km = extractDistanceKm(r);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   149       const fare = computeFare(r);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   155         distance_km,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                   156         fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         45     const verified_fare = asNum(body.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         47     const distance_km = asNum(body.distance_km);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         49     // passenger_fare_response is stored as json/text in your schema; we write a minimal JS...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         50     // that includes distance_km so reporting can extract it safely.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         51     let passenger_fare_response: any = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         52     if (distance_km != null) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         53       passenger_fare_response = { distance_km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         59     if (verified_fare !== null) patch.verified_fare = verified_fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         60     if (passenger_fare_response !== null) patch.passenger_fare_response = passenger_fare_re...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                         69       .select("id, booking_code, town, status, from_label, to_label, verified_fare, passeng...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 28   const fare_breakdown = booking.fare_breakdown ?? {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 39     base_fee: fare_breakdown.base_fee,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 40     extra_stop_fee: fare_breakdown.extra_stop_fee,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\orders\[bookingCode]\route.ts                                 41     company_cut: fare_breakdown.company_cut,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           16     const fare: number | undefined = body?.fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           18     if (!bookingCode || typeof fare !== "number") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           28         proposed_fare: fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           37       console.error("FARE_UPDATE_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                           46     console.error("FARE_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  59       passenger_fare_response: response,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  67       // passenger rejected the fare:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  71       updates.proposed_fare = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  82       console.error("FARE_RESPONSE_UPDATE_ERROR", error);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                                  96     console.error("FARE_RESPONSE_ROUTE_ERROR", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                    47     const maxKm = body.max_km != null ? Number(body.max_km) : 5;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\save-assign\route.ts                                    53         p_max_km: maxKm,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts              93     // 4) Orders (takeout_pricing_10pct_view)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts              95       .from("takeout_pricing_10pct_view")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts              97         "id,booking_code,service_type,vendor_status,customer_status,total_service_fare,plat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\admin\vendor-details\[vendorId]\route.ts             103       console.error("❌ takeout_pricing_10pct_view error:", orderError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                  19   const dist = num(row.distance_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                                  56         distance_fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                        95       .from("takeout_pricing_10pct_view")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                        97         "id,booking_code,service_type,vendor_status,customer_status,total_service_fare,plat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\details\route.ts                       103       console.error("❌ takeout_pricing_10pct_view error:", orderError);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                                95       .from("takeout_pricing_10pct_view")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor\payout\route.ts                               103           "total_service_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                                9 type PricingRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               26   //   (pricingRows ?? []) as PricingRow[]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               28   //   as unknown as PricingRow[]
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               40     const { data: pricingRows, error: pricingErr } = await supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               41       .from("pricing")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               45     if (pricingErr) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               46       return NextResponse.json({ error: pricingErr.message }, { status: 500 });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               50     const pricing = (pricingRows ?? []) as unknown as PricingRow[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               52     if (pricing.length === 0) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\vendor-ratings\route.ts                               62     return NextResponse.json({ orders: pricing });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\vendor-orders\route.ts                                       349       r?.items_subtotal ?? r?.subtotal ?? r?.total_bill ?? r?.totalBill ?? r?.fare ?? null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          13     fare: '',
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          19   const [fareCalculation, setFareCalculation] = useState<{
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          20     baseFare: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          21     distanceFare: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          26     { id: '1', name: 'Juan Santos', vehicle: 'Tricycle #101', distance: '0.5 km' },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          27     { id: '3', name: 'Pedro Reyes', vehicle: 'Tricycle #303', distance: '1.2 km' },
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          28     { id: '5', name: 'Carlos Mendoza', vehicle: 'Tricycle #205', distance: '2.1 km' }
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          34     // Auto-calculate fare when both locations are filled
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          36       const baseFare = 15;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          37       const distanceFare = Math.floor(Math.random() * 20) + 10; // Simulate distance calcul...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          38       const total = baseFare + distanceFare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          40       setFareCalculation({ baseFare, distanceFare, total });
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          41       setFormData(prev => ({ ...prev, fare: total.toString() }));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          70         fare: '',
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                          74       setFareCalculation(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         162           {/* Fare Calculation */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         163           {fareCalculation && (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         165               <h4 className="text-sm font-medium text-blue-900 mb-2">Fare Calculation</h4>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         168                   <span className="text-blue-700">Base fare:</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         169                   <span className="font-medium">â‚±{fareCalculation.baseFare}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         172                   <span className="text-blue-700">Distance fare:</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         173                   <span className="font-medium">â‚±{fareCalculation.distanceFare}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         177                   <span className="text-blue-900">â‚±{fareCalculation.total}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         185               <label className="text-sm font-medium text-gray-700">Fare Amount</label>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         189                   const baseFare = 15;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         190                   const distanceFare = Math.floor(Math.random() * 20) + 10;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         191                   const total = baseFare + distanceFare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         192                   setFormData(prev => ({ ...prev, fare: total.toString() }));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         203                 value={formData.fare}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         204                 onChange={(e) => setFormData(prev => ({ ...prev, fare: e.target.value }))}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         288                   fare: '',
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\BookingForm.tsx                                         292                 setFareCalculation(null);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                32   distance_km: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                54   const [radiusKm, setRadiusKm] = useState(10);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                                89       p_max_radius_km: radiusKm,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               215                 <span className="block text-gray-600 mb-1">Radius (km)</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               219                   placeholder="Search distance in km"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               220                   value={radiusKm}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               221                   onChange={(e) => setRadiusKm(Number(e.target.value))}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                               253                 <div>Dist: {nearest.distance_km.toFixed(2)} km • Updated: {new Date(nearest...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 27   verified_fare?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 28   passenger_fare_response?: any;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 33   distance_km?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                 34   fare?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                190   const hasFare = Number.isFinite(Number(b.fare ?? b.verified_fare));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                191   const hasDist = Number.isFinite(Number(b.distance_km));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                192   return hasFrom && hasTo && hasFare && hasDist;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                261   const [ackMap, setAckMap] = useState<Record<string, AckState>>({});
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                409   function startOfWeekMonday() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                420     if (rangeMode === "week") return { from: startOfWeekMonday(), to: endOfToday() };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                436   const [fixFare, setFixFare] = useState("");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                508     setAckMap((m) => ({ ...m, [key]: next }));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                527         setAckMap((m) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                538         setAckMap((m) => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                578       const dist = Number.isFinite(Number(b.distance_km)) ? to2(b.distance_km) : "N/A";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                579       const fare = Number.isFinite(Number(b.fare ?? b.verified_fare)) ? to2(b.fare ?? b.ver...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                587         Distance_km: dist,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                588         Fare_php: fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                603     "Distance_km",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                604     "Fare_php",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                625     const SUMMARY_COLS = ["Municipality","Trips","Total_km","Total_fare_php","Avg_km","Avg_...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                641         let totalKm = 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                642         let totalFare = 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                647           const km = Number(b.distance_km);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                648           if (Number.isFinite(km)) totalKm += km;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                650           const fare = Number(b.fare ?? b.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                651           if (Number.isFinite(fare)) totalFare += fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                654         const avgKm = trips > 0 ? totalKm / trips : 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                655         const avgFare = trips > 0 ? totalFare / trips : 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                660           Total_km: sum2(totalKm),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                661           Total_fare_php: sum2(totalFare),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                662           Avg_km: sum2(avgKm),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                663           Avg_fare_php: sum2(avgFare),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                723     setFixDist(Number.isFinite(Number(b.distance_km)) ? String(b.distance_km) : "");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                724     setFixFare(Number.isFinite(Number(b.fare ?? b.verified_fare)) ? String(b.fare ?? b.veri...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                743     if (Number.isFinite(d)) payload.distance_km = d;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                745     const f = Number(fixFare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                                746     if (Number.isFinite(f)) payload.verified_fare = f;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1258                     const ack = ackMap[key] || { state: "idle" };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1519                   <div className="text-xs text-slate-600">Distance (km)</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1523                   <div className="text-xs text-slate-600">Verified fare (PHP)</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                               1524                   <input className="w-full rounded border px-2 py-2 text-sm" value={fixFare...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               12   distance_km: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx                                               13   fare: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                          4 import { platformDeduction } from "../../../lib/fare";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                         10   // total fare passed in the URL, e.g. /driver/post-trip?total=85
C:\Users\jwes9\Desktop\jride-clean-fresh\app\driver\post-trip\DriverPostTripClient.tsx                         29           <span className="text-gray-500">Total fare collected:</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\errand\page.tsx                                                   14           This is a pilot stub page. Next step: create errand request + pricing + assignment.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            15   farePhp?: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            16   distanceKm?: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            38 function fareLabel(n?: number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            44 function km(n?: number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            46   return n.toFixed(1) + " km";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            60   if (typeof t.distanceKm === "number") lines.push("Distance: " + km(t.distanceKm));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                            61   if (typeof t.farePhp === "number") lines.push("Fare: " + fareLabel(t.farePhp));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                           237                   <div className="text-xs opacity-60">Fare</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                           238                   <div className="font-semibold">{fareLabel(trip.farePhp)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\[ref]\page.tsx                                           242                   <div className="font-semibold">{typeof trip.distanceKm === "number" ? km(...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                  16   farePhp?: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                  17   distanceKm?: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                  63 function fareLabel(n?: number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                  69 function km(n?: number) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                  71   return n.toFixed(1) + " km";
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 144   if (typeof t.distanceKm === "number") lines.push("Distance: " + km(t.distanceKm));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 145   if (typeof t.farePhp === "number") lines.push("Fare: " + fareLabel(t.farePhp));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 243 function computeFareFromComponents(r: any): number | undefined {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 245   const dist = safeNum(pickFirst(r, ["distance_fare"])) ?? 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 252     typeof pickFirst(r, ["distance_fare"]) !== "undefined" ||
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 296     const farePhp =
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 297       safeNum(pickFirst(r, ["verified_fare"])) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 298       safeNum(pickFirst(r, ["passenger_fare_response"])) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 299       safeNum(pickFirst(r, ["proposed_fare"])) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 300       safeNum(pickFirst(r, ["fare", "total_fare", "total"])) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 301       computeFareFromComponents(r);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 303     const distanceKm = safeNum(pickFirst(r, ["distance_km", "distanceKm"]));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 325       farePhp,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 326       distanceKm,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 967                     {typeof selectedTrip.farePhp === "number" ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 969                         <div className="text-xs opacity-60">Fare</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 970                         <div className="font-semibold">{fareLabel(selectedTrip.farePhp)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 974                     {typeof selectedTrip.distanceKm === "number" ? (
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                                 977                         <div className="font-semibold">{km(selectedTrip.distanceKm)}</div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 112               <span>Fair Pricing</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\landing\page.tsx                                                 193             Bookmark: <strong>app.jride.net</strong> (App) â€¢ <strong>dispatch.jride.net</...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                     14   distance_fare: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    154               className="rounded-md border border-slate-300 bg-white px-3 py-1.5 text-xs fo...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    177             Fare breakdown
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    185               <span>Distance fare</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx                                    186               <span>{formatPeso(booking.distance_fare)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                         5 function computeTriplycFare(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        14   // Basic stub pricing logic:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        15   // - Base fare ₱20
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        33 export default function ConfirmFareClient() {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        41   const fare = computeTriplycFare(origin, destination, passengers);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        45       <h1 className="font-semibold text-lg mb-2">Confirm Fare</h1>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        54         Total: ₱{fare.total} {fare.currency}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        57         Per-head est: ₱{fare.perHead} {fare.currency}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\confirm-fare\ConfirmFareClient.tsx                        61         (stub) ConfirmFareClient is rendering.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\passenger-count\page.tsx                                  24       <button className="px-4 py-2 rounded bg-green-600 text-white" onClick={()=>router.pus...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                    793   const [pickMode, setPickMode] = React.useState<"pickup" | "dropoff">("pickup");
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1310             if (pickMode === "pickup") {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   1363   }, [showMapPicker, pickMode, pickupLat, pickupLng, dropLat, dropLng]);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2193               Fare is proposed by drivers. You can accept to proceed or reject to request a...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2350                 onClick={() => setPickMode("pickup")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2360                 onClick={() => setPickMode("dropoff")}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2367                 Mode: <b>{pickMode === "pickup" ? "Pickup" : "Dropoff"}</b> (tap map to set)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2375                     Tap the map to set {pickMode}. Markers: green pickup, red dropoff.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\ride\page.tsx                                                   2386                             ? (Math.round(routeInfo.distance_m / 10) / 100) + " km, " + Mat...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                         37   total_service_fare: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        142           total_service_fare: Number(o.total_service_fare ?? 0),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\admin\payouts\[vendorId]\page.tsx                        479                     ₱{o.total_service_fare.toFixed(2)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                              8 type FareBreakdown = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             10   distance_fare: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             35   distance_fare?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                             44   fare_breakdown?: FareBreakdown | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            162     const fb = order?.fare_breakdown;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            169     const distance_fare = Number(order?.distance_fare ?? 0);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            175     const delivery_fee = distance_fare + waiting_fee + extra_stop_fee;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            182       distance_fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            351                   className="inline-flex items-center px-3 py-1.5 rounded-full text-xs font...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            360                   className="inline-flex items-center px-3 py-1.5 rounded-full text-xs font...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            369                   className="inline-flex items-center px-3 py-1.5 rounded-full text-xs font...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx                            463             Fare breakdown
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                      5 type FareBreakdown = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                     18   fare_breakdown?: Partial<FareBreakdown> | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    160   const fare: FareBreakdown = useMemo(() => {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    161     const fb = order?.fare_breakdown ?? {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    164         (fb as FareBreakdown).items_total ?? (order as any)?.items_total
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    167         (fb as FareBreakdown).delivery_fee ?? (order as any)?.delivery_fee
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    170         (fb as FareBreakdown).platform_fee ?? (order as any)?.platform_fee
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    173         (fb as FareBreakdown).other_fees ?? (order as any)?.other_fees
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    176         (fb as FareBreakdown).grand_total ?? (order as any)?.grand_total
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    322         {/* Fare breakdown */}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    325             Fare breakdown
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    330               <span className="font-medium">{formatMoney(fare.items_total)}</span>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    335                 {formatMoney(fare.delivery_fee)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    341                 {formatMoney(fare.platform_fee)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    347                 {formatMoney(fare.other_fees)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\receipt\page.tsx                    356                   {formatMoney(fare.grand_total)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                        5 type FareBreakdown = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\track\page.tsx                       22   fare_breakdown?: FareBreakdown | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx                                           16   distance_fare?: number | string | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                    30   total_service_fare: number;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   129           total_service_fare: Number(o.total_service_fare ?? 0),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\payout\page.tsx                                   463                     ₱{o.total_service_fare.toFixed(2)}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                  339                   className="rounded-full border border-slate-200 bg-white px-3 py-1.5 text...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx                                  347                   className="rounded-full bg-slate-900 px-3 py-1.5 text-[11px] font-medium ...


PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "/api/rides/fare","/api/rides/fare-response","proposed_fare","verified_fare","fare-override","confirm-fare" |
>>   Select-Object -First 30 Path, LineNumber, Line

Path                                                                                        LineNumber Line
----                                                                                        ---------- ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx         34  * bookings has verified_fare, proposed_fare, total_errand_fare, and components:
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx         62   const verified = asNum(trip?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx         65   const proposed = asNum(trip?.proposed_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts                       41         verified_fare: verifiedFare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts               41   const vf = n(b?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts               79       .select("id,booking_code,status,driver_id,driver_payout,verified_fare,company_cut")
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                   54       .select("id,booking_code,status,service_type,vendor_status,driver_id,vendor_id,updated_at,driver...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                  115     // 2) else max(verified_fare - company_cut, 0)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts                  119       const vf = n(b?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                         82   const verified = asNum(row?.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                         85   const proposed = asNum(row?.proposed_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                        130           "verified_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                        131           "proposed_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                              45     const verified_fare = asNum(body.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                              59     if (verified_fare !== null) patch.verified_fare = verified_fare;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                              69       .select("id, booking_code, town, status, from_label, to_label, verified_fare, passenger_fare_res...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts                                28         proposed_fare: fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts                       71       updates.proposed_fare = null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                      27   verified_fare?: number | null;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                     190   const hasFare = Number.isFinite(Number(b.fare ?? b.verified_fare));
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                     579       const fare = Number.isFinite(Number(b.fare ?? b.verified_fare)) ? to2(b.fare ?? b.verified_fare)...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                     650           const fare = Number(b.fare ?? b.verified_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                     724     setFixFare(Number.isFinite(Number(b.fare ?? b.verified_fare)) ? String(b.fare ?? b.verified_fare) ...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx                                     746     if (Number.isFinite(f)) payload.verified_fare = f;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                      297       safeNum(pickFirst(r, ["verified_fare"])) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx                                      299       safeNum(pickFirst(r, ["proposed_fare"])) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\passenger-count\page.tsx                       24       <button className="px-4 py-2 rounded bg-green-600 text-white" onClick={()=>router.push(`/request...


PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "1.5","pickup fee","surcharge","convenience fee","distance_fare","pickup_eta","distance_km" |
>>   Select-Object -First 30 Path, LineNumber, Line

Path                                                                                               LineNumber Line
----                                                                                               ---------- ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx                                   348                       <div className="flex items-center gap-1.5">
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx                 117                     <td className="px-2 py-2">{s(t.pickup_eta ?? t.pickupEta ?? "-")}</td>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx            121               className="rounded-full p-1.5 text-slate-300 hover:bg-slate-800 hover:text-white"
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                  478         num(tRaw.pickup_eta_seconds) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                  479         (num(tRaw.pickup_eta_minutes) != null
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx                  480           ? ((num(tRaw.pickup_eta_minutes) as number) * 60)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ProblemTripAlertSounds.tsx         52   const PICKUP_ETA_WARNING = 5 * 60; // 5 min
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ProblemTripAlertSounds.tsx         57     typeof pickupEta === "number" && pickupEta > PICKUP_ETA_WARNING;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\StuckTripWatcher.tsx               32   const PICKUP_ETA_STUCK = 10 * 60; // 10 minutes
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\StuckTripWatcher.tsx               37     typeof pickupEta === "number" && pickupEta > PICKUP_ETA_STUCK;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                35  * base_fee, distance_fare, extra_stop_fee, waiting_fee
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx                72   const distFare = asNum(trip?.distance_fare) ?? 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx                          158                   "px-3 py-1.5 font-semibold flex items-center justify-between",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx                                       181                             className="rounded-lg border border-black/10 bg-white px-3 py-1.5 t...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx                                       189                             className="rounded-lg border border-black/10 bg-white px-3 py-1.5 t...
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                           91           distance_km: Number(km.toFixed(2)),
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts                           96       .sort((a: any, b: any) => a.distance_km - b.distance_km)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                70     pickFirstNumber(p, ["distance_km", "distanceKm", "km", "distance"]) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                71     pickFirstNumber(p?.data, ["distance_km", "distanceKm", "km", "distance"]) ??
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                                92   const distFare = asNum(row?.distance_fare) || 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                               134           "distance_fare",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                               148       const distance_km = extractDistanceKm(r);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts                               155         distance_km,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                     47     const distance_km = asNum(body.distance_km);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                     50     // that includes distance_km so reporting can extract it safely.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                     52     if (distance_km != null) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts                                     53       passenger_fare_response = { distance_km };
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                              19   const dist = num(row.distance_fare);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts                              56         distance_fare,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx                            32   distance_km: number;


PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-Content "PATH_FROM_RESULTS" | Select-Object -Skip 0 -First 220
Get-Content : Cannot find path 'C:\Users\jwes9\Desktop\jride-clean-fresh\PATH_FROM_RESULTS' because it does not exist.
At line:1 char:1
+ Get-Content "PATH_FROM_RESULTS" | Select-Object -Skip 0 -First 220
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\Users\jwes9\...TH_FROM_RESULTS:String) [Get-Content], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand

PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "Driver","offer","proposed_fare","/api/rides/fare","fare-response","Accept","Reject" |
>>   Select-Object -First 40 Path, LineNumber, Line

Path                                                                    LineNumber Line
----                                                                    ---------- ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts          4 // It fetches the latest active booking + driver locations from Supabase
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts          5 // and returns an object that page.tsx + DriverListPanel expect.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         24 type DriverRow = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         25   driver_id: string;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         33 type DriverTownGroup = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         35   drivers: DriverRow[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         38 type DriverStats = {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         43   towns: DriverTownGroup[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         48   driverStats: DriverStats;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         53  * with aggregated driver stats & per-town lists.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         55  * This shape matches what /admin/livetripss/page.tsx + DriverListPanel
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         56  * are expecting: { booking, driverStats }.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         58 export async function getActiveBookingWithDriverLocations(): Promise<LiveTripResult> {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         86   // ---- 2) Driver locations & stats ----
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         87   let driverRows: DriverRow[] = [];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         90     const driverRes = await fetch(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         91       `${SUPABASE_URL}/rest/v1/driver_locations` +
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         92         `?select=driver_id,lat,lng,status,town,updated_at`,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts         99     if (driverRes.ok) {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        100       driverRows = (await driverRes.json()) as DriverRow[];
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        103         "[dispatchActions] Failed to load driver_locations:",
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        104         driverRes.status,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        105         await safeText(driverRes)
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        109     console.error("[dispatchActions] Error fetching driver_locations:", err);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        112   const driverStats = buildDriverStats(driverRows);
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        116     driverStats,
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        120 /** Build totals + per-town groups from raw driver_locations rows */
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        121 function buildDriverStats(rows: DriverRow[]): DriverStats {
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        127   const grouped: Record<string, DriverRow[]> = {};
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        135   const towns: DriverTownGroup[] = Object.entries(grouped).map(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        136     ([town, drivers]) => ({
C:\Users\jwes9\Desktop\jride-clean-fresh\app\actions\dispatchActions.ts        138       drivers: drivers.sort(
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx              9   has_driver?: boolean;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx             99   const ready = !!inspect?.has_driver && allowed.length > 0;
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx            116             ? "Driver assigned and lifecycle can proceed."
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx            117             : "No driver assigned or blocked state. Most lifecycle steps will fail until a driver is assigned."}
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx            149             <div>has_driver: <span className="font-mono">{String(!!inspect?.has_driver)}</span></div>
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\actions\page.tsx            182               Guardrail: not ready (driver missing or blocked). Assign driver first.
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx               35   // Accept ISO-ish values, keep permissive
C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\audit\page.tsx              130   const driverName = String(t.driver_name || "");


PS C:\Users\jwes9\Desktop\jride-clean-fresh> # Fare-related hits (save)
PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "/api/rides/fare", "/api/rides/fare-response", "proposed_fare", "verified_fare", "fare-override", "confirm-fare" |
>>   Select-Object Path, LineNumber, Line |
>>   Sort-Object Path, LineNumber |
>>   Set-Content -Encoding utf8 .\_scan_fare_hits.txt
PS C:\Users\jwes9\Desktop\jride-clean-fresh>
PS C:\Users\jwes9\Desktop\jride-clean-fresh> # 1.5km / pickup fee hits (save)
PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-ChildItem .\app -Recurse -File -Include *.tsx,*.ts |
>>   Select-String -SimpleMatch -Pattern "1.5", "pickup fee", "surcharge", "convenience fee", "distance_fare", "pickup_eta", "distance_km" |
>>   Select-Object Path, LineNumber, Line |
>>   Sort-Object Path, LineNumber |
>>   Set-Content -Encoding utf8 .\_scan_pickupfee_hits.txt
PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-Content .\_scan_fare_hits.txt -TotalCount 80
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=34; Line= * bookings has verified_fare, proposed_fare, total_errand_fare, and components:}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=62; Line=  const verified = asNum(trip?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=65; Line=  const proposed = asNum(trip?.proposed_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts; LineNumber=41; Line=        verified_fare: verifiedFare,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts; LineNumber=41; Line=  const vf = n(b?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts; LineNumber=79; Line=      .select("id,booking_code,status,driver_id,driver_payout,verified_fare,company_cut")}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts; LineNumber=54; Line=      .select("id,booking_code,status,service_type,vendor_status,driver_id,vendor_id,updated_at,driver_payout,verified_fare,company_cut")}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts; LineNumber=115; Line=    // 2) else max(verified_fare - company_cut, 0)}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts; LineNumber=119; Line=      const vf = n(b?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=82; Line=  const verified = asNum(row?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=85; Line=  const proposed = asNum(row?.proposed_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=130; Line=          "verified_fare",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=131; Line=          "proposed_fare",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=45; Line=    const verified_fare = asNum(body.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=59; Line=    if (verified_fare !== null) patch.verified_fare = verified_fare;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=69; Line=      .select("id, booking_code, town, status, from_label, to_label, verified_fare, passenger_fare_response, updated_at")}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts; LineNumber=28; Line=        proposed_fare: fare,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts; LineNumber=71; Line=      updates.proposed_fare = null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=27; Line=  verified_fare?: number | null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=190; Line=  const hasFare = Number.isFinite(Number(b.fare ?? b.verified_fare));}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=579; Line=      const fare = Number.isFinite(Number(b.fare ?? b.verified_fare)) ? to2(b.fare ?? b.verified_fare) : "N/A";}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=650; Line=          const fare = Number(b.fare ?? b.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=724; Line=    setFixFare(Number.isFinite(Number(b.fare ?? b.verified_fare)) ? String(b.fare ?? b.verified_fare) : "");}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=746; Line=    if (Number.isFinite(f)) payload.verified_fare = f;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=297; Line=      safeNum(pickFirst(r, ["verified_fare"])) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=299; Line=      safeNum(pickFirst(r, ["proposed_fare"])) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\passenger-count\page.tsx; LineNumber=24; Line=      <button className="px-4 py-2 rounded bg-green-600 text-white" onClick={()=>router.push(`/request/confirm-fare?count=${count}`)}>}
PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-Content .\_scan_pickupfee_hits.txt -TotalCount 80
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livedrivers\page.tsx; LineNumber=348; Line=                      <div className="flex items-center gap-1.5">}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\AdminOpsPanel.tsx; LineNumber=117; Line=                    <td className="px-2 py-2">{s(t.pickup_eta ?? t.pickupEta ?? "-")}</td>}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\DriverDetailsModal.tsx; LineNumber=121; Line=              className="rounded-full p-1.5 text-slate-300 hover:bg-slate-800 hover:text-white"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx; LineNumber=478; Line=        num(tRaw.pickup_eta_seconds) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx; LineNumber=479; Line=        (num(tRaw.pickup_eta_minutes) != null}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\LiveTripsMap.tsx; LineNumber=480; Line=          ? ((num(tRaw.pickup_eta_minutes) as number) * 60)}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ProblemTripAlertSounds.tsx; LineNumber=52; Line=  const PICKUP_ETA_WARNING = 5 * 60; // 5 min}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\ProblemTripAlertSounds.tsx; LineNumber=57; Line=    typeof pickupEta === "number" && pickupEta > PICKUP_ETA_WARNING;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\StuckTripWatcher.tsx; LineNumber=32; Line=  const PICKUP_ETA_STUCK = 10 * 60; // 10 minutes}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\StuckTripWatcher.tsx; LineNumber=37; Line=    typeof pickupEta === "number" && pickupEta > PICKUP_ETA_STUCK;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=35; Line= * base_fee, distance_fare, extra_stop_fee, waiting_fee}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=72; Line=  const distFare = asNum(trip?.distance_fare) ?? 0;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\DriverListPanel.tsx; LineNumber=158; Line=                  "px-3 py-1.5 font-semibold flex items-center justify-between",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx; LineNumber=181; Line=                            className="rounded-lg border border-black/10 bg-white px-3 py-1.5 text-xs hover:bg-black/5"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\vendors\page.tsx; LineNumber=189; Line=                            className="rounded-lg border border-black/10 bg-white px-3 py-1.5 text-xs hover:bg-black/5"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts; LineNumber=91; Line=          distance_km: Number(km.toFixed(2)),}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reassign\suggest\route.ts; LineNumber=96; Line=      .sort((a: any, b: any) => a.distance_km - b.distance_km)}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=70; Line=    pickFirstNumber(p, ["distance_km", "distanceKm", "km", "distance"]) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=71; Line=    pickFirstNumber(p?.data, ["distance_km", "distanceKm", "km", "distance"]) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=92; Line=  const distFare = asNum(row?.distance_fare) || 0;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=134; Line=          "distance_fare",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=148; Line=      const distance_km = extractDistanceKm(r);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=155; Line=        distance_km,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=47; Line=    const distance_km = asNum(body.distance_km);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=50; Line=    // that includes distance_km so reporting can extract it safely.}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=52; Line=    if (distance_km != null) {}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=53; Line=      passenger_fare_response = { distance_km };}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts; LineNumber=19; Line=  const dist = num(row.distance_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\takeout\orders-list\route.ts; LineNumber=56; Line=        distance_fare,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx; LineNumber=32; Line=  distance_km: number;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\DispatchPageComponent.tsx; LineNumber=253; Line=                <div>Dist: {nearest.distance_km.toFixed(2)} km • Updated: {new Date(nearest.updated_at).toLocaleTimeString()}</div>}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=33; Line=  distance_km?: number | null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=191; Line=  const hasDist = Number.isFinite(Number(b.distance_km));}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=578; Line=      const dist = Number.isFinite(Number(b.distance_km)) ? to2(b.distance_km) : "N/A";}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=587; Line=        Distance_km: dist,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=603; Line=    "Distance_km",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=647; Line=          const km = Number(b.distance_km);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=723; Line=    setFixDist(Number.isFinite(Number(b.distance_km)) ? String(b.distance_km) : "");}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=743; Line=    if (Number.isFinite(d)) payload.distance_km = d;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatcher\page.tsx; LineNumber=12; Line=  distance_km: number | null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=245; Line=  const dist = safeNum(pickFirst(r, ["distance_fare"])) ?? 0;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=252; Line=    typeof pickFirst(r, ["distance_fare"]) !== "undefined" ||}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=303; Line=    const distanceKm = safeNum(pickFirst(r, ["distance_km", "distanceKm"]));}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx; LineNumber=14; Line=  distance_fare: number;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx; LineNumber=154; Line=              className="rounded-md border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\orders\[bookingCode]\page.tsx; LineNumber=186; Line=              <span>{formatPeso(booking.distance_fare)}</span>}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=10; Line=  distance_fare: number;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=35; Line=  distance_fare?: number | null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=169; Line=    const distance_fare = Number(order?.distance_fare ?? 0);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=175; Line=    const delivery_fee = distance_fare + waiting_fee + extra_stop_fee;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=182; Line=      distance_fare,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=351; Line=                  className="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-slate-900 text-white"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=360; Line=                  className="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\[bookingCode]\page.tsx; LineNumber=369; Line=                  className="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\orders\page.tsx; LineNumber=16; Line=  distance_fare?: number | string | null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx; LineNumber=339; Line=                  className="rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-medium text-slate-700 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-60"}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\takeout\vendor\ratings\page.tsx; LineNumber=347; Line=                  className="rounded-full bg-slate-900 px-3 py-1.5 text-[11px] font-medium text-white shadow-sm hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-60"}
PS C:\Users\jwes9\Desktop\jride-clean-fresh>
PS C:\Users\jwes9\Desktop\jride-clean-fresh> # Or interactive paging:
PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-Content .\_scan_fare_hits.txt | Out-Host -Paging
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=34; Line= * bookings has verified_fare, proposed_fare, total_errand_fare, and components:}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=62; Line=  const verified = asNum(trip?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\admin\livetrips\components\TripWalletPanel.tsx; LineNumber=65; Line=  const proposed = asNum(trip?.proposed_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\fare-override\route.ts; LineNumber=41; Line=        verified_fare: verifiedFare,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts; LineNumber=41; Line=  const vf = n(b?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\fix\route.ts; LineNumber=79; Line=      .select("id,booking_code,status,driver_id,driver_payout,verified_fare,company_cut")}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts; LineNumber=54; Line=      .select("id,booking_code,status,service_type,vendor_status,driver_id,vendor_id,updated_at,driver_payout,verified_fare,company_cut")}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts; LineNumber=115; Line=    // 2) else max(verified_fare - company_cut, 0)}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\admin\reconcile-wallets\route.ts; LineNumber=119; Line=      const vf = n(b?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=82; Line=  const verified = asNum(row?.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=85; Line=  const proposed = asNum(row?.proposed_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=130; Line=          "verified_fare",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\bookings\route.ts; LineNumber=131; Line=          "proposed_fare",}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=45; Line=    const verified_fare = asNum(body.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=59; Line=    if (verified_fare !== null) patch.verified_fare = verified_fare;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\dispatch\lgu\route.ts; LineNumber=69; Line=      .select("id, booking_code, town, status, from_label, to_label, verified_fare, passenger_fare_response, updated_at")}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts; LineNumber=28; Line=        proposed_fare: fare,}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare-response\route.ts; LineNumber=71; Line=      updates.proposed_fare = null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=27; Line=  verified_fare?: number | null;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=190; Line=  const hasFare = Number.isFinite(Number(b.fare ?? b.verified_fare));}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=579; Line=      const fare = Number.isFinite(Number(b.fare ?? b.verified_fare)) ? to2(b.fare ?? b.verified_fare) : "N/A";}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=650; Line=          const fare = Number(b.fare ?? b.verified_fare);}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=724; Line=    setFixFare(Number.isFinite(Number(b.fare ?? b.verified_fare)) ? String(b.fare ?? b.verified_fare) : "");}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\dispatch\page.tsx; LineNumber=746; Line=    if (Number.isFinite(f)) payload.verified_fare = f;}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=297; Line=      safeNum(pickFirst(r, ["verified_fare"])) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\history\page.tsx; LineNumber=299; Line=      safeNum(pickFirst(r, ["proposed_fare"])) ??}
@{Path=C:\Users\jwes9\Desktop\jride-clean-fresh\app\request\passenger-count\page.tsx; LineNumber=24; Line=      <button className="px-4 py-2 rounded bg-green-600 text-white" onClick={()=>router.push(`/request/confirm-fare?count=${count}`)}>}
PS C:\Users\jwes9\Desktop\jride-clean-fresh> # Example: show 120 lines around a hit
PS C:\Users\jwes9\Desktop\jride-clean-fresh> $path = "C:\Users\jwes9\Desktop\jride-clean-fresh\app\api\rides\fare\route.ts"
PS C:\Users\jwes9\Desktop\jride-clean-fresh> $line = 120
PS C:\Users\jwes9\Desktop\jride-clean-fresh> $start = [Math]::Max(0, $line - 60)
PS C:\Users\jwes9\Desktop\jride-clean-fresh> Get-Content $path | Select-Object -Skip $start -First 120
PS C:\Users\jwes9\Desktop\jride-clean-fresh>